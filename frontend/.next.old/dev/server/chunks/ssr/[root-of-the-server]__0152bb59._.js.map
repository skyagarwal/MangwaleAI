{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 94, "column": 0}, "map": {"version":3,"sources":["file:///app/src/lib/websocket/chat-client.ts"],"sourcesContent":["// WebSocket Client for Real-time Chat\n\nimport { io, Socket } from 'socket.io-client'\nimport type { ChatMessage, Session } from '@/types/chat'\n\n// Auto-detect WebSocket URL based on current origin\nconst getWsUrl = () => {\n  if (typeof window === 'undefined') {\n    // Server-side: use localhost with correct port (3201 external, 3200 internal)\n    return process.env.NEXT_PUBLIC_WS_URL || 'http://localhost:3201'\n  }\n  \n  // Client-side: use same origin as the page\n  const { protocol, hostname } = window.location\n  \n  // If accessing via chat.mangwale.ai (HTTPS), use same domain with /ws proxy\n  if (hostname === 'chat.mangwale.ai') {\n    return `${protocol}//${hostname}` // https://chat.mangwale.ai (needs nginx/caddy proxy to :3201)\n  }\n  \n  // For localhost/dev, use the env var or default to orchestrator port 3201\n  if (hostname === 'localhost' || hostname === '127.0.0.1') {\n    return process.env.NEXT_PUBLIC_WS_URL || 'http://localhost:3201'\n  }\n  \n  // For other cases (like Tailscale IP), use same protocol and orchestrator port 3201\n  return process.env.NEXT_PUBLIC_WS_URL || `${protocol}//${hostname}:3201`\n}\n\ninterface ChatEventHandlers {\n  onMessage?: (message: ChatMessage) => void\n  onSessionUpdate?: (session: Session) => void\n  onTyping?: (isTyping: boolean) => void\n  onError?: (error: Error) => void\n  onConnect?: () => void\n  onDisconnect?: () => void\n}\n\ninterface SendMessagePayload {\n  message: string\n  sessionId: string\n  module?: string\n}\n\ninterface OptionClickPayload {\n  sessionId: string\n  optionId: string\n  payload?: unknown\n}\n\nclass ChatWebSocketClient {\n  private socket: Socket | null = null\n  private handlers: ChatEventHandlers = {}\n  private reconnectAttempts = 0\n  private maxReconnectAttempts = 5\n\n  constructor() {\n    this.connect()\n  }\n\n  private connect() {\n    if (this.socket?.connected) {\n      return\n    }\n\n    const wsUrl = getWsUrl()\n    console.log(`üîå Connecting to WebSocket: ${wsUrl}`)\n\n    this.socket = io(wsUrl, {\n      transports: ['websocket', 'polling'], // Try websocket first, fall back to polling\n      reconnection: true,\n      reconnectionAttempts: this.maxReconnectAttempts,\n      reconnectionDelay: 1000,\n      reconnectionDelayMax: 5000,\n      timeout: 10000,\n    })\n\n    this.setupEventListeners()\n  }\n\n  private setupEventListeners() {\n    if (!this.socket) return\n\n    this.socket.on('connect', () => {\n      console.log('‚úÖ WebSocket connected')\n      this.reconnectAttempts = 0\n      this.handlers.onConnect?.()\n    })\n\n    this.socket.on('disconnect', () => {\n      console.log('‚ùå WebSocket disconnected')\n      this.handlers.onDisconnect?.()\n    })\n\n    this.socket.on('message', (message: ChatMessage) => {\n      this.handlers.onMessage?.(message)\n    })\n\n    this.socket.on('session:update', (session: Session) => {\n      this.handlers.onSessionUpdate?.(session)\n    })\n\n    this.socket.on('session:joined', (data: { sessionId: string; history: ChatMessage[] }) => {\n      console.log('üì• Session joined:', data.sessionId, 'History:', data.history.length)\n      // Emit history messages to handler\n      data.history.forEach(msg => this.handlers.onMessage?.(msg))\n    })\n\n    this.socket.on('typing', (isTyping: boolean) => {\n      this.handlers.onTyping?.(isTyping)\n    })\n\n    this.socket.on('error', (error: Error) => {\n      console.error('‚ùå WebSocket error:', error)\n      this.handlers.onError?.(error)\n    })\n\n    this.socket.on('connect_error', (error: Error) => {\n      console.error('‚ùå WebSocket connection error:', error)\n      this.handlers.onError?.(error)\n    })\n\n    this.socket.on('reconnect_attempt', (attemptNumber: number) => {\n      this.reconnectAttempts = attemptNumber\n      console.log(`üîÑ Reconnection attempt ${attemptNumber}/${this.maxReconnectAttempts}`)\n    })\n\n    this.socket.on('reconnect_failed', () => {\n      console.error('‚ùå WebSocket reconnection failed')\n      this.handlers.onError?.(new Error('Failed to reconnect to WebSocket'))\n    })\n  }\n\n  // Register event handlers\n  on(handlers: ChatEventHandlers) {\n    this.handlers = { ...this.handlers, ...handlers }\n  }\n\n  // Join a session room\n  joinSession(sessionId: string, authData?: {\n    userId?: number\n    phone?: string\n    email?: string\n    token?: string\n    name?: string\n  }) {\n    if (!this.socket?.connected) {\n      console.warn('‚ö†Ô∏è Socket not connected, attempting to connect...')\n      this.connect()\n    }\n    console.log('üì± Joining session:', sessionId, authData ? '(authenticated)' : '(guest)')\n    this.socket?.emit('session:join', { \n      sessionId,\n      ...authData \n    })\n  }\n\n  // Leave a session room\n  leaveSession(sessionId: string) {\n    console.log('üëã Leaving session:', sessionId)\n    this.socket?.emit('session:leave', { sessionId })\n  }\n\n  // Send a message\n  sendMessage(payload: SendMessagePayload) {\n    if (!this.socket?.connected) {\n      throw new Error('WebSocket not connected')\n    }\n    console.log('üì§ Sending message:', payload)\n    this.socket.emit('message:send', payload)\n  }\n\n  // Send typing indicator\n  sendTyping(sessionId: string, isTyping: boolean) {\n    this.socket?.emit('typing', { sessionId, isTyping })\n  }\n\n  // Handle option click\n  handleOptionClick(payload: OptionClickPayload) {\n    if (!this.socket?.connected) {\n      throw new Error('WebSocket not connected')\n    }\n    console.log('üñ±Ô∏è Handling option click:', payload)\n    this.socket.emit('option:click', payload)\n  }\n\n  // Update location\n  updateLocation(sessionId: string, lat: number, lng: number) {\n    console.log('üìç Updating location:', { sessionId, lat, lng })\n    this.socket?.emit('location:update', { sessionId, lat, lng })\n  }\n\n  // Check connection status\n  isConnected(): boolean {\n    return this.socket?.connected || false\n  }\n\n  // Disconnect\n  disconnect() {\n    this.socket?.disconnect()\n    this.socket = null\n  }\n\n  // Reconnect manually\n  reconnect() {\n    this.disconnect()\n    this.connect()\n  }\n}\n\n// Singleton instance\nlet chatWSClient: ChatWebSocketClient | null = null\n\nexport const getChatWSClient = (): ChatWebSocketClient => {\n  if (!chatWSClient) {\n    chatWSClient = new ChatWebSocketClient()\n  }\n  return chatWSClient\n}\n\nexport const disconnectChatWS = () => {\n  chatWSClient?.disconnect()\n  chatWSClient = null\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 276, "column": 0}, "map": {"version":3,"sources":["file:///app/src/lib/utils/helpers.ts"],"sourcesContent":["import { type ClassValue, clsx } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n\nexport function formatCurrency(amount: number, currency = \"INR\"): string {\n  return new Intl.NumberFormat(\"en-IN\", {\n    style: \"currency\",\n    currency,\n    minimumFractionDigits: 0,\n  }).format(amount)\n}\n\nexport function formatDistance(meters: number): string {\n  if (meters < 1000) {\n    return `${Math.round(meters)}m`\n  }\n  return `${(meters / 1000).toFixed(1)}km`\n}\n\nexport function formatTime(date: Date | string): string {\n  const d = typeof date === \"string\" ? new Date(date) : date\n  return d.toLocaleTimeString(\"en-IN\", {\n    hour: \"2-digit\",\n    minute: \"2-digit\",\n  })\n}\n\nexport function formatDate(date: Date | string): string {\n  const d = typeof date === \"string\" ? new Date(date) : date\n  return d.toLocaleDateString(\"en-IN\", {\n    day: \"numeric\",\n    month: \"short\",\n    year: \"numeric\",\n  })\n}\n\nexport function debounce<T extends (...args: any[]) => any>(\n  func: T,\n  wait: number\n): (...args: Parameters<T>) => void {\n  let timeout: NodeJS.Timeout | null = null\n  return (...args: Parameters<T>) => {\n    if (timeout) clearTimeout(timeout)\n    timeout = setTimeout(() => func(...args), wait)\n  }\n}\n\nexport const generateId = (): string => {\n  return `${Date.now()}-${Math.random().toString(36).substring(2, 9)}`\n}\n\n// Parse numbered options from AI message\nexport const parseButtonsFromText = (text: string): { cleanText: string; buttons: Array<{ id: string; label: string; value: string }> } => {\n  // Match patterns like \"1Ô∏è‚É£ Option text\" or \"1. Option text\" or \"[BUTTON:Label:value]\"\n  const emojiPattern = /(\\d)Ô∏è‚É£\\s*([^\\n]+)/g\n  const numberPattern = /^(\\d+)\\.\\s*([^\\n]+)/gm\n  const buttonPattern = /\\[BUTTON:([^:]+):([^\\]]+)\\]/g\n  \n  const buttons: Array<{ id: string; label: string; value: string }> = []\n  let cleanText = text\n  \n  // Check for special button syntax [BUTTON:label:value]\n  let match\n  while ((match = buttonPattern.exec(text)) !== null) {\n    const label = match[1].trim()\n    const value = match[2].trim()\n    buttons.push({\n      id: `btn-${buttons.length}`,\n      label: label,\n      value: value\n    })\n  }\n  \n  // Remove button markers from text\n  cleanText = cleanText.replace(buttonPattern, '').trim()\n  \n  // Check for emoji-numbered options (1Ô∏è‚É£, 2Ô∏è‚É£)\n  if (buttons.length === 0) {\n    while ((match = emojiPattern.exec(text)) !== null) {\n      const number = match[1]\n      const label = match[2].trim().replace(/[üì±üìòüçîüõíüè®üé¨üîßüì¶üöó‚ù§Ô∏è]/g, '').trim()\n      buttons.push({\n        id: `option-${number}`,\n        label: label,\n        value: number\n      })\n    }\n  }\n  \n  // Check for regular numbered options (1., 2.)\n  if (buttons.length === 0) {\n    while ((match = numberPattern.exec(text)) !== null) {\n      const number = match[1]\n      const label = match[2].trim().replace(/[üì±üìòüçîüõíüè®üé¨üîßüì¶üöó‚ù§Ô∏è]/g, '').trim()\n      buttons.push({\n        id: `option-${number}`,\n        label: label,\n        value: number\n      })\n    }\n  }\n  \n  // If we found buttons, clean the text\n  if (buttons.length > 0) {\n    // Remove the button lines but keep the header\n    cleanText = text\n      .replace(/(\\d)Ô∏è‚É£\\s*[^\\n]+/g, '')\n      .replace(/^\\d+\\.\\s*[^\\n]+$/gm, '')\n      .replace(/Reply with \\d+ or \\d+:?/gi, '')\n      .replace(/Please choose.*:/gi, '')\n      .replace(/\\n{3,}/g, '\\n\\n')\n      .trim()\n  }\n  \n  return { cleanText, buttons }\n}\n\n// Parse product/restaurant cards from AI message\nexport const parseCardsFromText = (text: string): { cleanText: string; cards: Array<{ id: string; name: string; image: string; rating?: number; deliveryTime?: string; price?: string; description?: string; action: { label: string; value: string } }> } => {\n  const cards: Array<{ id: string; name: string; image: string; rating?: number; deliveryTime?: string; price?: string; description?: string; action: { label: string; value: string } }> = []\n  let cleanText = text\n\n  // Pattern for card format:\n  // üçï Pizza Palace\n  // ‚≠ê 4.5 stars | üöö 25-30 mins\n  // Order Now ‚Üí order:pizza-palace\n  const cardPattern = /([üçïüçîüçúüç±ü•òüåÆüçõü•óüçùüçñü•ôüåØ])\\s*([^\\n]+)\\n‚≠ê\\s*([\\d.]+)\\s*stars?\\s*\\|\\s*üöö\\s*([^\\n]+)\\n(?:üí∞\\s*([^\\n]+)\\n)?(?:([^\\n]+)\\n)?Order Now\\s*‚Üí\\s*([^\\n]+)/gi\n\n  let match\n  while ((match = cardPattern.exec(text)) !== null) {\n    const emoji = match[1]\n    const name = match[2].trim()\n    const rating = parseFloat(match[3])\n    const deliveryTime = match[4].trim()\n    const price = match[5]?.trim()\n    const description = match[6]?.trim()\n    const actionValue = match[7].trim()\n\n    cards.push({\n      id: `card-${cards.length + 1}`,\n      name,\n      image: emoji, // Use emoji as fallback, backend should provide real image URL\n      rating,\n      deliveryTime,\n      price,\n      description,\n      action: {\n        label: 'Order Now',\n        value: actionValue\n      }\n    })\n  }\n\n  // If we found cards, remove them from text\n  if (cards.length > 0) {\n    cleanText = text.replace(cardPattern, '').replace(/\\n{3,}/g, '\\n\\n').trim()\n  }\n\n  return { cleanText, cards }\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 439, "column": 0}, "map": {"version":3,"sources":["file:///app/src/components/chat/ProductCard.tsx"],"sourcesContent":["import { Star } from 'lucide-react'\nimport Image from 'next/image'\nimport { useState } from 'react'\nimport type { ProductCard as ProductCardType } from '@/types/chat'\n\ninterface ProductCardProps {\n  card: ProductCardType\n  onAction: (value: string) => void\n}\n\nexport function ProductCard({ card, onAction }: ProductCardProps) {\n  const [imageError, setImageError] = useState(false)\n\n  const renderStars = (rating: number) => {\n    return (\n      <div className=\"flex items-center gap-1\">\n        {[...Array(5)].map((_, i) => (\n          <Star\n            key={i}\n            className={`w-4 h-4 ${\n              i < Math.floor(rating)\n                ? 'fill-yellow-400 text-yellow-400'\n                : 'fill-gray-200 text-gray-200'\n            }`}\n          />\n        ))}\n        <span className=\"text-sm font-medium text-gray-700 ml-1\">{rating}</span>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"bg-gradient-to-br from-white to-gray-50 rounded-2xl shadow-lg hover:shadow-xl p-5 max-w-sm border-2 border-gray-100 hover:border-[#059211] transition-all duration-200\">\n      <div className=\"flex gap-4\">\n        {/* Left side - Content */}\n        <div className=\"flex-1\">\n          <h3 className=\"font-bold text-lg text-gray-900 mb-2\">{card.name}</h3>\n          \n          {card.rating && (\n            <div className=\"mb-2\">{renderStars(card.rating)}</div>\n          )}\n          \n          {card.deliveryTime && (\n            <p className=\"text-sm font-medium text-gray-600 mb-3\">\n              üöö {card.deliveryTime}\n            </p>\n          )}\n\n          {card.price && (\n            <p className=\"text-xl font-bold text-[#059211] mb-3\">{card.price}</p>\n          )}\n\n          {card.description && (\n            <p className=\"text-sm text-gray-600 mb-4 line-clamp-2\">\n              {card.description}\n            </p>\n          )}\n\n          <button\n            onClick={() => onAction(card.action.value)}\n            className=\"w-full bg-gradient-to-r from-[#059211] to-[#047a0e] hover:shadow-xl text-white font-bold py-3 px-6 rounded-full transition-all duration-200 shadow-lg flex items-center justify-center gap-2 transform hover:scale-105\"\n          >\n            {card.action.label}\n            <span>‚Üí</span>\n          </button>\n        </div>\n\n        {/* Right side - Image */}\n        {card.image && (\n          <div className=\"w-28 h-28 flex-shrink-0\">\n            <div className=\"w-full h-full rounded-2xl overflow-hidden bg-gradient-to-br from-gray-100 to-gray-200 shadow-md\">\n              {imageError ? (\n                <div className=\"w-full h-full flex items-center justify-center text-5xl\">\n                  üçï\n                </div>\n              ) : (\n                <Image\n                  src={card.image}\n                  alt={card.name}\n                  width={112}\n                  height={112}\n                  className=\"w-full h-full object-cover\"\n                  onError={() => setImageError(true)}\n                  unoptimized\n                />\n              )}\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  )\n}\n"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;;;;;AAQO,SAAS,YAAY,EAAE,IAAI,EAAE,QAAQ,EAAoB;IAC9D,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,iNAAQ,EAAC;IAE7C,MAAM,cAAc,CAAC;QACnB,qBACE,8OAAC;YAAI,WAAU;;gBACZ;uBAAI,MAAM;iBAAG,CAAC,GAAG,CAAC,CAAC,GAAG,kBACrB,8OAAC,0MAAI;wBAEH,WAAW,CAAC,QAAQ,EAClB,IAAI,KAAK,KAAK,CAAC,UACX,oCACA,+BACJ;uBALG;;;;;8BAQT,8OAAC;oBAAK,WAAU;8BAA0C;;;;;;;;;;;;IAGhE;IAEA,qBACE,8OAAC;QAAI,WAAU;kBACb,cAAA,8OAAC;YAAI,WAAU;;8BAEb,8OAAC;oBAAI,WAAU;;sCACb,8OAAC;4BAAG,WAAU;sCAAwC,KAAK,IAAI;;;;;;wBAE9D,KAAK,MAAM,kBACV,8OAAC;4BAAI,WAAU;sCAAQ,YAAY,KAAK,MAAM;;;;;;wBAG/C,KAAK,YAAY,kBAChB,8OAAC;4BAAE,WAAU;;gCAAyC;gCAChD,KAAK,YAAY;;;;;;;wBAIxB,KAAK,KAAK,kBACT,8OAAC;4BAAE,WAAU;sCAAyC,KAAK,KAAK;;;;;;wBAGjE,KAAK,WAAW,kBACf,8OAAC;4BAAE,WAAU;sCACV,KAAK,WAAW;;;;;;sCAIrB,8OAAC;4BACC,SAAS,IAAM,SAAS,KAAK,MAAM,CAAC,KAAK;4BACzC,WAAU;;gCAET,KAAK,MAAM,CAAC,KAAK;8CAClB,8OAAC;8CAAK;;;;;;;;;;;;;;;;;;gBAKT,KAAK,KAAK,kBACT,8OAAC;oBAAI,WAAU;8BACb,cAAA,8OAAC;wBAAI,WAAU;kCACZ,2BACC,8OAAC;4BAAI,WAAU;sCAA0D;;;;;iDAIzE,8OAAC,wIAAK;4BACJ,KAAK,KAAK,KAAK;4BACf,KAAK,KAAK,IAAI;4BACd,OAAO;4BACP,QAAQ;4BACR,WAAU;4BACV,SAAS,IAAM,cAAc;4BAC7B,WAAW;;;;;;;;;;;;;;;;;;;;;;;;;;;AAS7B","debugId":null}},
    {"offset": {"line": 624, "column": 0}, "map": {"version":3,"sources":["file:///app/src/lib/api.ts"],"sourcesContent":["import axios, { AxiosInstance, AxiosError } from 'axios';\n\nconst API_URL = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:4001/api';\n\n// Create axios instance\nconst apiClient: AxiosInstance = axios.create({\n  baseURL: API_URL,\n  timeout: 30000,\n  headers: {\n    'Content-Type': 'application/json',\n  },\n});\n\n// Request interceptor - add auth token\napiClient.interceptors.request.use(\n  (config) => {\n    if (typeof window !== 'undefined') {\n      const authStorage = localStorage.getItem('auth-storage');\n      if (authStorage) {\n        try {\n          const { state } = JSON.parse(authStorage);\n          const token = state?.token;\n          if (token && config.headers) {\n            config.headers.Authorization = `Bearer ${token}`;\n          }\n        } catch (error) {\n          console.error('Failed to parse auth token:', error);\n        }\n      }\n    }\n    return config;\n  },\n  (error) => {\n    return Promise.reject(error);\n  }\n);\n\n// Response interceptor - handle errors\napiClient.interceptors.response.use(\n  (response) => response,\n  (error: AxiosError) => {\n    if (error.response?.status === 401) {\n      // Unauthorized - clear token and redirect to login\n      if (typeof window !== 'undefined') {\n        localStorage.removeItem('auth-storage');\n        window.location.href = '/login';\n      }\n    }\n    return Promise.reject(error);\n  }\n);\n\n// API methods\nexport const api = {\n  // Auth\n  auth: {\n    sendOtp: (phone: string) =>\n      apiClient.post('/v1/auth/send-otp', { phone }),\n    \n    verifyOtp: (phone: string, otp: string) =>\n      apiClient.post('/v1/auth/verify-otp', { phone, otp }),\n    \n    updateUserInfo: (data: { phone: string; f_name: string; l_name: string; email: string }) =>\n      apiClient.post('/v1/auth/update-info', data),\n    \n    getProfile: () =>\n      apiClient.get('/v1/auth/profile'),\n    \n    updateProfile: (data: any) =>\n      apiClient.put('/v1/auth/profile', data),\n    \n    logout: () =>\n      apiClient.post('/v1/auth/logout'),\n  },\n\n  // Orders\n  orders: {\n    list: (params?: any) =>\n      apiClient.get('/v1/orders', { params }),\n    \n    get: (id: string | number) =>\n      apiClient.get(`/v1/orders/${id}`),\n    \n    create: (data: any) =>\n      apiClient.post('/v1/orders', data),\n    \n    track: (id: string | number) =>\n      apiClient.get(`/v1/orders/${id}/track`),\n    \n    cancel: (id: string | number, reason?: string) =>\n      apiClient.put(`/v1/orders/${id}/cancel`, { reason }),\n  },\n\n  // Addresses\n  addresses: {\n    list: () =>\n      apiClient.get('/v1/addresses'),\n    \n    get: (id: string | number) =>\n      apiClient.get(`/v1/addresses/${id}`),\n    \n    create: (data: any) =>\n      apiClient.post('/v1/addresses', data),\n    \n    update: (id: string | number, data: any) =>\n      apiClient.put(`/v1/addresses/${id}`, data),\n    \n    delete: (id: string | number) =>\n      apiClient.delete(`/v1/addresses/${id}`),\n  },\n\n  // Payments\n  payments: {\n    methods: () =>\n      apiClient.get('/v1/payments/methods'),\n    \n    initiate: (data: any) =>\n      apiClient.post('/v1/payments/initiate', data),\n    \n    verify: (data: any) =>\n      apiClient.post('/v1/payments/verify', data),\n  },\n\n  // Parcel Module\n  parcel: {\n    getVehicles: () =>\n      apiClient.get('/v1/parcel/vehicles'),\n    \n    calculateDistance: (data: any) =>\n      apiClient.post('/v1/parcel/calculate-distance', data),\n    \n    getCharges: (params?: any) =>\n      apiClient.get('/v1/parcel/vehicle-charges', { params }),\n    \n    createOrder: (data: any) =>\n      apiClient.post('/v1/parcel/orders', data),\n    \n    trackOrder: (orderId: string) =>\n      apiClient.get(`/v1/parcel/orders/${orderId}/track`),\n  },\n\n  // Health\n  health: () =>\n    apiClient.get('/health'),\n};\n\nexport default apiClient;\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,MAAM,UAAU,gFAAmC;AAEnD,wBAAwB;AACxB,MAAM,YAA2B,gJAAK,CAAC,MAAM,CAAC;IAC5C,SAAS;IACT,SAAS;IACT,SAAS;QACP,gBAAgB;IAClB;AACF;AAEA,uCAAuC;AACvC,UAAU,YAAY,CAAC,OAAO,CAAC,GAAG,CAChC,CAAC;IACC;;IAcA,OAAO;AACT,GACA,CAAC;IACC,OAAO,QAAQ,MAAM,CAAC;AACxB;AAGF,uCAAuC;AACvC,UAAU,YAAY,CAAC,QAAQ,CAAC,GAAG,CACjC,CAAC,WAAa,UACd,CAAC;IACC,IAAI,MAAM,QAAQ,EAAE,WAAW,KAAK;QAClC,mDAAmD;QACnD;;IAIF;IACA,OAAO,QAAQ,MAAM,CAAC;AACxB;AAIK,MAAM,MAAM;IACjB,OAAO;IACP,MAAM;QACJ,SAAS,CAAC,QACR,UAAU,IAAI,CAAC,qBAAqB;gBAAE;YAAM;QAE9C,WAAW,CAAC,OAAe,MACzB,UAAU,IAAI,CAAC,uBAAuB;gBAAE;gBAAO;YAAI;QAErD,gBAAgB,CAAC,OACf,UAAU,IAAI,CAAC,wBAAwB;QAEzC,YAAY,IACV,UAAU,GAAG,CAAC;QAEhB,eAAe,CAAC,OACd,UAAU,GAAG,CAAC,oBAAoB;QAEpC,QAAQ,IACN,UAAU,IAAI,CAAC;IACnB;IAEA,SAAS;IACT,QAAQ;QACN,MAAM,CAAC,SACL,UAAU,GAAG,CAAC,cAAc;gBAAE;YAAO;QAEvC,KAAK,CAAC,KACJ,UAAU,GAAG,CAAC,CAAC,WAAW,EAAE,IAAI;QAElC,QAAQ,CAAC,OACP,UAAU,IAAI,CAAC,cAAc;QAE/B,OAAO,CAAC,KACN,UAAU,GAAG,CAAC,CAAC,WAAW,EAAE,GAAG,MAAM,CAAC;QAExC,QAAQ,CAAC,IAAqB,SAC5B,UAAU,GAAG,CAAC,CAAC,WAAW,EAAE,GAAG,OAAO,CAAC,EAAE;gBAAE;YAAO;IACtD;IAEA,YAAY;IACZ,WAAW;QACT,MAAM,IACJ,UAAU,GAAG,CAAC;QAEhB,KAAK,CAAC,KACJ,UAAU,GAAG,CAAC,CAAC,cAAc,EAAE,IAAI;QAErC,QAAQ,CAAC,OACP,UAAU,IAAI,CAAC,iBAAiB;QAElC,QAAQ,CAAC,IAAqB,OAC5B,UAAU,GAAG,CAAC,CAAC,cAAc,EAAE,IAAI,EAAE;QAEvC,QAAQ,CAAC,KACP,UAAU,MAAM,CAAC,CAAC,cAAc,EAAE,IAAI;IAC1C;IAEA,WAAW;IACX,UAAU;QACR,SAAS,IACP,UAAU,GAAG,CAAC;QAEhB,UAAU,CAAC,OACT,UAAU,IAAI,CAAC,yBAAyB;QAE1C,QAAQ,CAAC,OACP,UAAU,IAAI,CAAC,uBAAuB;IAC1C;IAEA,gBAAgB;IAChB,QAAQ;QACN,aAAa,IACX,UAAU,GAAG,CAAC;QAEhB,mBAAmB,CAAC,OAClB,UAAU,IAAI,CAAC,iCAAiC;QAElD,YAAY,CAAC,SACX,UAAU,GAAG,CAAC,8BAA8B;gBAAE;YAAO;QAEvD,aAAa,CAAC,OACZ,UAAU,IAAI,CAAC,qBAAqB;QAEtC,YAAY,CAAC,UACX,UAAU,GAAG,CAAC,CAAC,kBAAkB,EAAE,QAAQ,MAAM,CAAC;IACtD;IAEA,SAAS;IACT,QAAQ,IACN,UAAU,GAAG,CAAC;AAClB;uCAEe","debugId":null}},
    {"offset": {"line": 717, "column": 0}, "map": {"version":3,"sources":["file:///app/src/store/authStore.ts"],"sourcesContent":["import { create } from 'zustand';\nimport { persist, createJSONStorage } from 'zustand/middleware';\n\ninterface User {\n  id: number;\n  f_name: string;\n  l_name?: string;\n  phone: string;\n  email?: string;\n  image?: string;\n}\n\ninterface AuthState {\n  user: User | null;\n  token: string | null;\n  isAuthenticated: boolean;\n  _hasHydrated: boolean;\n  setAuth: (user: User, token: string) => void;\n  clearAuth: () => void;\n  updateUser: (user: Partial<User>) => void;\n  setHasHydrated: (hasHydrated: boolean) => void;\n}\n\nexport const useAuthStore = create<AuthState>()(\n  persist(\n    (set) => ({\n      user: null,\n      token: null,\n      isAuthenticated: false,\n      _hasHydrated: false,\n\n      setAuth: (user, token) => {\n        set({ user, token, isAuthenticated: true });\n      },\n\n      clearAuth: () => {\n        set({ user: null, token: null, isAuthenticated: false });\n      },\n\n      updateUser: (userData) =>\n        set((state) => ({\n          user: state.user ? { ...state.user, ...userData } : null,\n        })),\n\n      setHasHydrated: (hasHydrated) => {\n        set({ _hasHydrated: hasHydrated });\n      },\n    }),\n    {\n      name: 'auth-storage',\n      storage: createJSONStorage(() => localStorage),\n      onRehydrateStorage: () => (state) => {\n        state?.setHasHydrated(true);\n      },\n    }\n  )\n);\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAsBO,MAAM,eAAe,IAAA,kJAAM,IAChC,IAAA,wJAAO,EACL,CAAC,MAAQ,CAAC;QACR,MAAM;QACN,OAAO;QACP,iBAAiB;QACjB,cAAc;QAEd,SAAS,CAAC,MAAM;YACd,IAAI;gBAAE;gBAAM;gBAAO,iBAAiB;YAAK;QAC3C;QAEA,WAAW;YACT,IAAI;gBAAE,MAAM;gBAAM,OAAO;gBAAM,iBAAiB;YAAM;QACxD;QAEA,YAAY,CAAC,WACX,IAAI,CAAC,QAAU,CAAC;oBACd,MAAM,MAAM,IAAI,GAAG;wBAAE,GAAG,MAAM,IAAI;wBAAE,GAAG,QAAQ;oBAAC,IAAI;gBACtD,CAAC;QAEH,gBAAgB,CAAC;YACf,IAAI;gBAAE,cAAc;YAAY;QAClC;IACF,CAAC,GACD;IACE,MAAM;IACN,SAAS,IAAA,kKAAiB,EAAC,IAAM;IACjC,oBAAoB,IAAM,CAAC;YACzB,OAAO,eAAe;QACxB;AACF","debugId":null}},
    {"offset": {"line": 766, "column": 0}, "map": {"version":3,"sources":["file:///app/src/components/chat/InlineLogin.tsx"],"sourcesContent":["'use client'\n\nimport { useState } from 'react'\nimport { X, Phone, Lock, User, Mail } from 'lucide-react'\nimport { api } from '@/lib/api'\nimport { useAuthStore } from '@/store/authStore'\n\ninterface InlineLoginProps {\n  onClose: () => void\n  onSuccess: () => void\n}\n\nexport function InlineLogin({ onClose, onSuccess }: InlineLoginProps) {\n  const [step, setStep] = useState<'phone' | 'otp' | 'register'>('phone')\n  const [phone, setPhone] = useState('')\n  const [otp, setOtp] = useState('')\n  const [firstName, setFirstName] = useState('')\n  const [lastName, setLastName] = useState('')\n  const [email, setEmail] = useState('')\n  const [loading, setLoading] = useState(false)\n  const [error, setError] = useState('')\n\n  const { setAuth } = useAuthStore()\n\n  const handleSendOtp = async () => {\n    if (phone.length !== 10) {\n      setError('Please enter a valid 10-digit phone number')\n      return\n    }\n\n    setLoading(true)\n    setError('')\n\n    try {\n      // Backend will normalize phone number\n      await api.auth.sendOtp(phone)\n      setStep('otp')\n    } catch (err: any) {\n      setError(err.response?.data?.message || 'Failed to send OTP. Please try again.')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const handleVerifyOtp = async () => {\n    if (otp.length !== 6) {\n      setError('Please enter a valid 6-digit OTP')\n      return\n    }\n\n    setLoading(true)\n    setError('')\n\n    try {\n      // Backend will normalize phone number\n      const response = await api.auth.verifyOtp(phone, otp)\n      const { token, user } = response.data\n\n      // Check if user needs to complete registration\n      if (user.is_personal_info === 0) {\n        setStep('register')\n      } else {\n        // Login successful - save to store\n        setAuth(user, token)\n        onSuccess()\n      }\n    } catch (err: any) {\n      setError(err.response?.data?.message || 'Invalid OTP. Please try again.')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const handleRegister = async () => {\n    if (!firstName || !email) {\n      setError('Please fill in all required fields')\n      return\n    }\n\n    setLoading(true)\n    setError('')\n\n    try {\n      // Call update-info endpoint - backend will normalize phone\n      const response = await api.auth.updateUserInfo({\n        phone: phone,\n        f_name: firstName,\n        l_name: lastName || '',\n        email\n      })\n\n      const { token, user } = response.data\n      setAuth(user, token)\n      onSuccess()\n    } catch (err: any) {\n      setError(err.response?.data?.message || 'Failed to complete registration. Please try again.')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  return (\n    <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\">\n      <div className=\"bg-white rounded-2xl shadow-2xl max-w-md w-full p-6 relative\">\n        {/* Close Button */}\n        <button\n          onClick={onClose}\n          className=\"absolute top-4 right-4 text-gray-400 hover:text-gray-600\"\n        >\n          <X className=\"w-6 h-6\" />\n        </button>\n\n        {/* Header */}\n        <div className=\"text-center mb-6\">\n          <h2 className=\"text-2xl font-bold text-gray-900\">\n            {step === 'phone' && 'Login to Continue'}\n            {step === 'otp' && 'Verify OTP'}\n            {step === 'register' && 'Complete Your Profile'}\n          </h2>\n          <p className=\"text-gray-500 mt-2\">\n            {step === 'phone' && 'Enter your phone number to get started'}\n            {step === 'otp' && `We sent a code to ${phone}`}\n            {step === 'register' && 'Just a few more details'}\n          </p>\n        </div>\n\n        {/* Error Message */}\n        {error && (\n          <div className=\"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-4\">\n            {error}\n          </div>\n        )}\n\n        {/* Phone Step */}\n        {step === 'phone' && (\n          <div className=\"space-y-4\">\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                Phone Number\n              </label>\n              <div className=\"relative\">\n                <Phone className=\"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400\" />\n                <input\n                  type=\"tel\"\n                  value={phone}\n                  onChange={(e) => setPhone(e.target.value.replace(/\\D/g, '').slice(0, 10))}\n                  placeholder=\"10-digit mobile number\"\n                  className=\"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                  maxLength={10}\n                />\n              </div>\n            </div>\n\n            <button\n              onClick={handleSendOtp}\n              disabled={loading || phone.length !== 10}\n              className=\"w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors\"\n            >\n              {loading ? 'Sending...' : 'Send OTP'}\n            </button>\n          </div>\n        )}\n\n        {/* OTP Step */}\n        {step === 'otp' && (\n          <div className=\"space-y-4\">\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                Enter OTP\n              </label>\n              <div className=\"relative\">\n                <Lock className=\"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400\" />\n                <input\n                  type=\"text\"\n                  value={otp}\n                  onChange={(e) => setOtp(e.target.value.replace(/\\D/g, '').slice(0, 6))}\n                  placeholder=\"6-digit OTP\"\n                  className=\"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-center text-2xl tracking-widest\"\n                  maxLength={6}\n                />\n              </div>\n            </div>\n\n            <button\n              onClick={handleVerifyOtp}\n              disabled={loading || otp.length !== 6}\n              className=\"w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors\"\n            >\n              {loading ? 'Verifying...' : 'Verify OTP'}\n            </button>\n\n            <button\n              onClick={() => setStep('phone')}\n              className=\"w-full text-gray-600 py-2 text-sm hover:text-gray-800\"\n            >\n              Change phone number\n            </button>\n          </div>\n        )}\n\n        {/* Registration Step */}\n        {step === 'register' && (\n          <div className=\"space-y-4\">\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                First Name <span className=\"text-red-500\">*</span>\n              </label>\n              <div className=\"relative\">\n                <User className=\"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400\" />\n                <input\n                  type=\"text\"\n                  value={firstName}\n                  onChange={(e) => setFirstName(e.target.value)}\n                  placeholder=\"Enter your first name\"\n                  className=\"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                />\n              </div>\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                Last Name\n              </label>\n              <div className=\"relative\">\n                <User className=\"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400\" />\n                <input\n                  type=\"text\"\n                  value={lastName}\n                  onChange={(e) => setLastName(e.target.value)}\n                  placeholder=\"Enter your last name (optional)\"\n                  className=\"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                />\n              </div>\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                Email <span className=\"text-red-500\">*</span>\n              </label>\n              <div className=\"relative\">\n                <Mail className=\"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400\" />\n                <input\n                  type=\"email\"\n                  value={email}\n                  onChange={(e) => setEmail(e.target.value)}\n                  placeholder=\"your@email.com\"\n                  className=\"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                />\n              </div>\n            </div>\n\n            <button\n              onClick={handleRegister}\n              disabled={loading || !firstName || !email}\n              className=\"w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors\"\n            >\n              {loading ? 'Completing...' : 'Complete Registration'}\n            </button>\n          </div>\n        )}\n      </div>\n    </div>\n  )\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AALA;;;;;;AAYO,SAAS,YAAY,EAAE,OAAO,EAAE,SAAS,EAAoB;IAClE,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,iNAAQ,EAA+B;IAC/D,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,iNAAQ,EAAC;IACnC,MAAM,CAAC,KAAK,OAAO,GAAG,IAAA,iNAAQ,EAAC;IAC/B,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,iNAAQ,EAAC;IAC3C,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,iNAAQ,EAAC;IACzC,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,iNAAQ,EAAC;IACnC,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,iNAAQ,EAAC;IACvC,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,iNAAQ,EAAC;IAEnC,MAAM,EAAE,OAAO,EAAE,GAAG,IAAA,yIAAY;IAEhC,MAAM,gBAAgB;QACpB,IAAI,MAAM,MAAM,KAAK,IAAI;YACvB,SAAS;YACT;QACF;QAEA,WAAW;QACX,SAAS;QAET,IAAI;YACF,sCAAsC;YACtC,MAAM,wHAAG,CAAC,IAAI,CAAC,OAAO,CAAC;YACvB,QAAQ;QACV,EAAE,OAAO,KAAU;YACjB,SAAS,IAAI,QAAQ,EAAE,MAAM,WAAW;QAC1C,SAAU;YACR,WAAW;QACb;IACF;IAEA,MAAM,kBAAkB;QACtB,IAAI,IAAI,MAAM,KAAK,GAAG;YACpB,SAAS;YACT;QACF;QAEA,WAAW;QACX,SAAS;QAET,IAAI;YACF,sCAAsC;YACtC,MAAM,WAAW,MAAM,wHAAG,CAAC,IAAI,CAAC,SAAS,CAAC,OAAO;YACjD,MAAM,EAAE,KAAK,EAAE,IAAI,EAAE,GAAG,SAAS,IAAI;YAErC,+CAA+C;YAC/C,IAAI,KAAK,gBAAgB,KAAK,GAAG;gBAC/B,QAAQ;YACV,OAAO;gBACL,mCAAmC;gBACnC,QAAQ,MAAM;gBACd;YACF;QACF,EAAE,OAAO,KAAU;YACjB,SAAS,IAAI,QAAQ,EAAE,MAAM,WAAW;QAC1C,SAAU;YACR,WAAW;QACb;IACF;IAEA,MAAM,iBAAiB;QACrB,IAAI,CAAC,aAAa,CAAC,OAAO;YACxB,SAAS;YACT;QACF;QAEA,WAAW;QACX,SAAS;QAET,IAAI;YACF,2DAA2D;YAC3D,MAAM,WAAW,MAAM,wHAAG,CAAC,IAAI,CAAC,cAAc,CAAC;gBAC7C,OAAO;gBACP,QAAQ;gBACR,QAAQ,YAAY;gBACpB;YACF;YAEA,MAAM,EAAE,KAAK,EAAE,IAAI,EAAE,GAAG,SAAS,IAAI;YACrC,QAAQ,MAAM;YACd;QACF,EAAE,OAAO,KAAU;YACjB,SAAS,IAAI,QAAQ,EAAE,MAAM,WAAW;QAC1C,SAAU;YACR,WAAW;QACb;IACF;IAEA,qBACE,8OAAC;QAAI,WAAU;kBACb,cAAA,8OAAC;YAAI,WAAU;;8BAEb,8OAAC;oBACC,SAAS;oBACT,WAAU;8BAEV,cAAA,8OAAC,iMAAC;wBAAC,WAAU;;;;;;;;;;;8BAIf,8OAAC;oBAAI,WAAU;;sCACb,8OAAC;4BAAG,WAAU;;gCACX,SAAS,WAAW;gCACpB,SAAS,SAAS;gCAClB,SAAS,cAAc;;;;;;;sCAE1B,8OAAC;4BAAE,WAAU;;gCACV,SAAS,WAAW;gCACpB,SAAS,SAAS,CAAC,kBAAkB,EAAE,OAAO;gCAC9C,SAAS,cAAc;;;;;;;;;;;;;gBAK3B,uBACC,8OAAC;oBAAI,WAAU;8BACZ;;;;;;gBAKJ,SAAS,yBACR,8OAAC;oBAAI,WAAU;;sCACb,8OAAC;;8CACC,8OAAC;oCAAM,WAAU;8CAA+C;;;;;;8CAGhE,8OAAC;oCAAI,WAAU;;sDACb,8OAAC,6MAAK;4CAAC,WAAU;;;;;;sDACjB,8OAAC;4CACC,MAAK;4CACL,OAAO;4CACP,UAAU,CAAC,IAAM,SAAS,EAAE,MAAM,CAAC,KAAK,CAAC,OAAO,CAAC,OAAO,IAAI,KAAK,CAAC,GAAG;4CACrE,aAAY;4CACZ,WAAU;4CACV,WAAW;;;;;;;;;;;;;;;;;;sCAKjB,8OAAC;4BACC,SAAS;4BACT,UAAU,WAAW,MAAM,MAAM,KAAK;4BACtC,WAAU;sCAET,UAAU,eAAe;;;;;;;;;;;;gBAM/B,SAAS,uBACR,8OAAC;oBAAI,WAAU;;sCACb,8OAAC;;8CACC,8OAAC;oCAAM,WAAU;8CAA+C;;;;;;8CAGhE,8OAAC;oCAAI,WAAU;;sDACb,8OAAC,0MAAI;4CAAC,WAAU;;;;;;sDAChB,8OAAC;4CACC,MAAK;4CACL,OAAO;4CACP,UAAU,CAAC,IAAM,OAAO,EAAE,MAAM,CAAC,KAAK,CAAC,OAAO,CAAC,OAAO,IAAI,KAAK,CAAC,GAAG;4CACnE,aAAY;4CACZ,WAAU;4CACV,WAAW;;;;;;;;;;;;;;;;;;sCAKjB,8OAAC;4BACC,SAAS;4BACT,UAAU,WAAW,IAAI,MAAM,KAAK;4BACpC,WAAU;sCAET,UAAU,iBAAiB;;;;;;sCAG9B,8OAAC;4BACC,SAAS,IAAM,QAAQ;4BACvB,WAAU;sCACX;;;;;;;;;;;;gBAOJ,SAAS,4BACR,8OAAC;oBAAI,WAAU;;sCACb,8OAAC;;8CACC,8OAAC;oCAAM,WAAU;;wCAA+C;sDACnD,8OAAC;4CAAK,WAAU;sDAAe;;;;;;;;;;;;8CAE5C,8OAAC;oCAAI,WAAU;;sDACb,8OAAC,0MAAI;4CAAC,WAAU;;;;;;sDAChB,8OAAC;4CACC,MAAK;4CACL,OAAO;4CACP,UAAU,CAAC,IAAM,aAAa,EAAE,MAAM,CAAC,KAAK;4CAC5C,aAAY;4CACZ,WAAU;;;;;;;;;;;;;;;;;;sCAKhB,8OAAC;;8CACC,8OAAC;oCAAM,WAAU;8CAA+C;;;;;;8CAGhE,8OAAC;oCAAI,WAAU;;sDACb,8OAAC,0MAAI;4CAAC,WAAU;;;;;;sDAChB,8OAAC;4CACC,MAAK;4CACL,OAAO;4CACP,UAAU,CAAC,IAAM,YAAY,EAAE,MAAM,CAAC,KAAK;4CAC3C,aAAY;4CACZ,WAAU;;;;;;;;;;;;;;;;;;sCAKhB,8OAAC;;8CACC,8OAAC;oCAAM,WAAU;;wCAA+C;sDACxD,8OAAC;4CAAK,WAAU;sDAAe;;;;;;;;;;;;8CAEvC,8OAAC;oCAAI,WAAU;;sDACb,8OAAC,0MAAI;4CAAC,WAAU;;;;;;sDAChB,8OAAC;4CACC,MAAK;4CACL,OAAO;4CACP,UAAU,CAAC,IAAM,SAAS,EAAE,MAAM,CAAC,KAAK;4CACxC,aAAY;4CACZ,WAAU;;;;;;;;;;;;;;;;;;sCAKhB,8OAAC;4BACC,SAAS;4BACT,UAAU,WAAW,CAAC,aAAa,CAAC;4BACpC,WAAU;sCAET,UAAU,kBAAkB;;;;;;;;;;;;;;;;;;;;;;;AAO3C","debugId":null}},
    {"offset": {"line": 1241, "column": 0}, "map": {"version":3,"sources":["file:///app/src/app/%28public%29/chat/page.tsx"],"sourcesContent":["'use client'\n\nimport { useState, useEffect, useRef } from 'react'\nimport { Send, Mic, MapPin, ArrowLeft, Map, User, RotateCcw } from 'lucide-react'\nimport Link from 'next/link'\nimport { useSearchParams, useRouter } from 'next/navigation'\nimport Script from 'next/script'\nimport { getChatWSClient } from '@/lib/websocket/chat-client'\nimport { parseButtonsFromText, parseCardsFromText } from '@/lib/utils/helpers'\nimport { ProductCard } from '@/components/chat/ProductCard'\nimport { InlineLogin } from '@/components/chat/InlineLogin'\nimport dynamic from 'next/dynamic'\nimport type { ChatMessage } from '@/types/chat'\nimport { useAuthStore } from '@/store/authStore'\n\n// Use Google Maps based location picker for better UX\n// Backend still uses OSRM for distance calculations (cost-effective)\nconst LocationPicker = dynamic(\n  () => import('@/components/map/LocationPicker'),\n  { ssr: false }\n)\n\nconst modules = [\n  { id: 'food', name: 'Food', emoji: 'üçî' },\n  { id: 'ecom', name: 'Shopping', emoji: 'üõí' },\n  { id: 'rooms', name: 'Hotels', emoji: 'üè®' },\n  { id: 'movies', name: 'Movies', emoji: 'üé¨' },\n  { id: 'services', name: 'Services', emoji: 'üîß' },\n  { id: 'parcel', name: 'Parcel', emoji: 'üì¶' },\n  { id: 'ride', name: 'Ride', emoji: 'üöó' },\n  { id: 'health', name: 'Health', emoji: '‚ù§Ô∏è' },\n]\n\nexport default function ChatPage() {\n  const searchParams = useSearchParams()\n  const router = useRouter()\n  const moduleParam = searchParams.get('module')\n  const { isAuthenticated, user, _hasHydrated } = useAuthStore()\n  \n  const [messages, setMessages] = useState<ChatMessage[]>([\n    {\n      id: '1',\n      role: 'assistant',\n      content: 'Hi! üëã Welcome to Mangwale. I\\'m here to help you with deliveries, food, shopping, and more. Feel free to ask me anything about Nashik or just chat!\\n\\nYou can browse without logging in, but you\\'ll need to login when placing orders. How can I help you today?',\n      timestamp: 0,\n    }\n  ])\n  const [input, setInput] = useState('')\n  const [isTyping, setIsTyping] = useState(false)\n  const [selectedModule, setSelectedModule] = useState<string | null>(moduleParam)\n  const [isGettingLocation, setIsGettingLocation] = useState(false)\n  const [showLocationPicker, setShowLocationPicker] = useState(false)\n  const [showLoginModal, setShowLoginModal] = useState(false)\n  const [showProfile, setShowProfile] = useState(false)\n  const [userProfile, setUserProfile] = useState<{\n    name?: string\n    phone?: string\n  } | null>(null)\n  \n  // Generate or retrieve persistent session ID from localStorage\n  const [sessionIdState] = useState(() => {\n    if (typeof window !== 'undefined') {\n      const stored = localStorage.getItem('mangwale-chat-session-id')\n      if (stored) {\n        console.log('üîÑ Reusing existing session:', stored)\n        return stored\n      }\n    }\n    const newSessionId = `web-${Date.now()}`\n    if (typeof window !== 'undefined') {\n      localStorage.setItem('mangwale-chat-session-id', newSessionId)\n      console.log('üÜï Created new session:', newSessionId)\n    }\n    return newSessionId\n  })\n  \n  const [isConnected, setIsConnected] = useState(false)\n  \n  const messagesEndRef = useRef<HTMLDivElement>(null)\n  const inputRef = useRef<HTMLInputElement>(null)\n  const wsClientRef = useRef<ReturnType<typeof getChatWSClient> | null>(null)\n  const profileRef = useRef<HTMLDivElement>(null)\n\n  // Load user profile from localStorage\n  useEffect(() => {\n    if (typeof window !== 'undefined') {\n      // Profile now comes from auth store, no need for separate localStorage\n      // Keeping this for backward compatibility during migration\n      const storedProfile = localStorage.getItem('mangwale-user-profile')\n      if (storedProfile && !user) {\n        try {\n          const profile = JSON.parse(storedProfile)\n          setUserProfile(profile)\n        } catch (e) {\n          console.error('Failed to parse user profile:', e)\n        }\n      } else if (user) {\n        // Sync auth store user to userProfile state\n        setUserProfile({\n          name: user.f_name + (user.l_name ? ` ${user.l_name}` : ''),\n          phone: user.phone,\n        })\n      }\n    }\n  }, [user])\n\n  // Close profile dropdown when clicking outside\n  useEffect(() => {\n    const handleClickOutside = (event: MouseEvent) => {\n      if (profileRef.current && !profileRef.current.contains(event.target as Node)) {\n        setShowProfile(false)\n      }\n    }\n\n    if (showProfile) {\n      document.addEventListener('mousedown', handleClickOutside)\n    }\n\n    return () => {\n      document.removeEventListener('mousedown', handleClickOutside)\n    }\n  }, [showProfile])\n\n  // REMOVE MANDATORY AUTH CHECK - Let users chat first, login when prompted naturally\n  // The LLM can engage users, build rapport, then suggest login for orders/tracking\n  // useEffect(() => {\n  //   if (_hasHydrated && !isAuthenticated) {\n  //     router.push('/login')\n  //   }\n  // }, [_hasHydrated, isAuthenticated, router])\n\n  // AUTO-REQUEST LOCATION after login (delivery app needs current location)\n  // Only run once when user first logs in\n  useEffect(() => {\n    if (typeof window === 'undefined') return; // Skip on server\n    \n    if (isAuthenticated && user && !showLocationPicker && !localStorage.getItem('user-location-captured')) {\n      // Check if we have location in session\n      const hasLocation = localStorage.getItem('mangwale-user-location')\n      if (!hasLocation) {\n        console.log('üìç User authenticated but no location - auto-prompting for location')\n        // Auto-open location picker after 2 seconds (only once)\n        const timer = setTimeout(() => {\n          setShowLocationPicker(true)\n        }, 2000)\n        \n        return () => clearTimeout(timer)\n      }\n    }\n  }, [isAuthenticated, user, showLocationPicker]) // Added showLocationPicker to deps to prevent re-triggers\n\n  const scrollToBottom = () => {\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' })\n  }\n\n  useEffect(() => {\n    scrollToBottom()\n  }, [messages])\n\n  // Initialize WebSocket connection\n  useEffect(() => {\n    // Wait for auth store to hydrate from localStorage before connecting\n    if (!_hasHydrated) {\n      console.log('‚è≥ Waiting for auth store to hydrate...')\n      return\n    }\n    \n    console.log('üîå Initializing WebSocket connection...')\n    const wsClient = getChatWSClient()\n    wsClientRef.current = wsClient\n\n    // Set up event handlers\n    wsClient.on({\n      onConnect: () => {\n        console.log('‚úÖ WebSocket connected')\n        setIsConnected(true)\n        // Join session room with auth data if available\n        const authData = isAuthenticated && user ? {\n          userId: user.id,\n          phone: user.phone,\n          email: user.email,\n          token: useAuthStore.getState().token || undefined,\n          name: user.f_name + (user.l_name ? ` ${user.l_name}` : ''),\n        } : undefined\n        \n        console.log('üì± Joining session with auth:', authData ? 'authenticated' : 'guest')\n        wsClient.joinSession(sessionIdState, authData)\n      },\n      onDisconnect: () => {\n        console.log('‚ùå WebSocket disconnected')\n        setIsConnected(false)\n      },\n      onMessage: (message: ChatMessage) => {\n        console.log('üì® Received message:', message)\n        \n        // Parse buttons and cards from message content\n        const { cleanText: textAfterButtons, buttons } = parseButtonsFromText(message.content)\n        const { cleanText: finalText, cards } = parseCardsFromText(textAfterButtons)\n        \n        const enrichedMessage: ChatMessage = {\n          ...message,\n          content: finalText,\n          buttons: buttons.length > 0 ? buttons : undefined,\n          cards: cards.length > 0 ? cards : undefined,\n        }\n        \n        setMessages(prev => [...prev, enrichedMessage])\n        setIsTyping(false)\n      },\n      onTyping: (isTyping: boolean) => {\n        console.log('‚å®Ô∏è Typing indicator:', isTyping)\n        setIsTyping(isTyping)\n      },\n      onError: (error: Error) => {\n        console.error('WebSocket error:', error)\n        setMessages(prev => [...prev, {\n          id: `error-${Date.now()}`,\n          role: 'assistant',\n          content: 'Sorry, I encountered an error. Please try again.',\n          timestamp: Date.now(),\n        }])\n        setIsTyping(false)\n      },\n    })\n\n    return () => {\n      console.log('üîå Cleaning up WebSocket connection')\n      wsClient.leaveSession(sessionIdState)\n    }\n  }, [sessionIdState, isAuthenticated, user, _hasHydrated])\n\n  const handleSend = async (textInput?: string) => {\n    const messageText = textInput || input.trim()\n    if (!messageText) return\n\n    if (!isConnected) {\n      console.error('‚ùå WebSocket not connected')\n      setMessages(prev => [...prev, {\n        id: `error-${Date.now()}`,\n        role: 'assistant',\n        content: 'Connection lost. Please refresh the page.',\n        timestamp: Date.now(),\n      }])\n      return\n    }\n\n    try {\n      console.log('üöÄ Sending message via WebSocket:', messageText)\n      \n      // Add user message\n      setMessages(prev => [...prev, {\n        id: `msg-${prev.length}-${Date.now()}`,\n        role: 'user',\n        content: messageText,\n        timestamp: Date.now(),\n      }])\n      \n      if (!textInput) setInput('')\n      setIsTyping(true)\n\n      // Send via WebSocket\n      wsClientRef.current?.sendMessage({\n        message: messageText,\n        sessionId: sessionIdState,\n        module: selectedModule || undefined,\n      })\n      \n      console.log('‚úÖ Message sent via WebSocket')\n    } catch (error) {\n      console.error('Failed to send message:', error)\n      setIsTyping(false)\n      setMessages(prev => [...prev, {\n        id: `error-${prev.length}`,\n        role: 'assistant',\n        content: 'Sorry, I encountered an error. Please try again.',\n        timestamp: Date.now(),\n      }])\n    }\n  }\n\n  const handleSendClick = () => {\n    void handleSend()\n  }\n\n  const handleKeyPress = (e: React.KeyboardEvent) => {\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault()\n      handleSend()\n    }\n  }\n\n  const handleModuleSelect = (moduleId: string) => {\n    setSelectedModule(moduleId)\n    const selectedModuleData = modules.find(m => m.id === moduleId)\n    \n    setMessages(prev => [\n      ...prev,\n      {\n        id: `module-${prev.length}-${Date.now()}`,\n        role: 'assistant',\n        content: `Great! I'm now your ${selectedModuleData?.name} assistant. What would you like to do?`,\n        timestamp: Date.now(),\n      }\n    ])\n  }\n\n  const handleShareLocation = async () => {\n    if (!navigator.geolocation) {\n      setMessages(prev => [...prev, {\n        id: `error-${Date.now()}`,\n        role: 'assistant',\n        content: '‚ùå Geolocation is not supported by your browser.',\n        timestamp: Date.now(),\n      }])\n      return\n    }\n\n    setIsGettingLocation(true)\n    \n    setMessages(prev => [...prev, {\n      id: `sys-${Date.now()}`,\n      role: 'assistant',\n      content: 'üìç Requesting your location... Please allow location access.',\n      timestamp: Date.now(),\n    }])\n\n    navigator.geolocation.getCurrentPosition(\n      async (position) => {\n        const { latitude, longitude } = position.coords\n        \n        // Send location to backend via WebSocket for session tracking\n        if (wsClientRef.current) {\n          wsClientRef.current.updateLocation(sessionIdState, latitude, longitude)\n          \n          // Send as text message for the conversation flow\n          // This will add the message to chat and send to backend\n          const locationText = `üìç My current location is: ${latitude.toFixed(6)}, ${longitude.toFixed(6)}`\n          await handleSend(locationText)\n        }\n        \n        setIsGettingLocation(false)\n      },\n      (error) => {\n        let errorMsg = '‚ùå Unable to get your location. '\n        \n        switch (error.code) {\n          case error.PERMISSION_DENIED:\n            errorMsg += 'Please enable location permissions in your browser settings.'\n            break\n          case error.POSITION_UNAVAILABLE:\n            errorMsg += 'Location information is unavailable.'\n            break\n          case error.TIMEOUT:\n            errorMsg += 'Location request timed out.'\n            break\n          default:\n            errorMsg += 'An unknown error occurred.'\n        }\n        \n        setMessages(prev => [...prev, {\n          id: `error-${Date.now()}`,\n          role: 'assistant',\n          content: errorMsg,\n          timestamp: Date.now(),\n        }])\n        \n        setIsGettingLocation(false)\n      },\n      {\n        enableHighAccuracy: true,\n        timeout: 10000,\n        maximumAge: 0\n      }\n    )\n  }\n\n  const handleLocationConfirm = async (location: {\n    lat: number\n    lng: number\n    address: string\n    road?: string\n    house?: string\n    floor?: string\n    contact_person_name: string\n    contact_person_number: string\n    address_type: string\n  }) => {\n    setShowLocationPicker(false)\n    \n    // Update user profile in auth store and localStorage\n    const profile = {\n      name: location.contact_person_name,\n      phone: location.contact_person_number\n    }\n    \n    // Update auth store if user is authenticated\n    if (user) {\n      const { updateUser } = useAuthStore.getState()\n      updateUser({\n        f_name: location.contact_person_name.split(' ')[0],\n        l_name: location.contact_person_name.split(' ').slice(1).join(' ') || undefined,\n        phone: location.contact_person_number,\n      })\n    }\n    \n    // Also save to localStorage for backward compatibility\n    localStorage.setItem('mangwale-user-profile', JSON.stringify(profile))\n    setUserProfile(profile)\n    \n    // Save location data for delivery app\n    const locationData = {\n      lat: location.lat,\n      lng: location.lng,\n      address: location.address,\n      timestamp: Date.now()\n    }\n    localStorage.setItem('mangwale-user-location', JSON.stringify(locationData))\n    localStorage.setItem('user-location-captured', 'true')\n    \n    // Send location to backend via WebSocket\n    if (wsClientRef.current) {\n      wsClientRef.current.updateLocation(sessionIdState, location.lat, location.lng)\n    }\n    \n    // Format the complete address message for display\n    let fullAddress = `${location.address}\\n`\n    fullAddress += `Contact: ${location.contact_person_name} (${location.contact_person_number})\\n`\n    fullAddress += `Type: ${location.address_type}`\n    \n    if (location.house) {\n      fullAddress += `\\nHouse/Flat: ${location.house}`\n    }\n    if (location.floor) {\n      fullAddress += `, Floor: ${location.floor}`\n    }\n    if (location.road) {\n      fullAddress += `\\nRoad: ${location.road}`\n    }\n    \n    // Add location shared message with formatted details\n    const displayMessage = `üìç Location shared:\\n${fullAddress}\\n\\nCoordinates: ${location.lat.toFixed(6)}, ${location.lng.toFixed(6)}`\n    \n    // Send to backend - handleSend will add the message to chat\n    await handleSend(displayMessage)\n  }\n\n  const currentModule = selectedModule ? modules.find(m => m.id === selectedModule) : null\n\n  return (\n    <>\n      {/* Load Google Maps Script */}\n      <Script\n        src={`https://maps.googleapis.com/maps/api/js?key=${process.env.NEXT_PUBLIC_GOOGLE_MAPS_API_KEY || ''}&libraries=places`}\n        strategy=\"lazyOnload\"\n        onLoad={() => console.log('‚úÖ Google Maps API loaded')}\n      />\n\n      <div className=\"flex flex-col h-screen bg-[#fffff6] overflow-hidden\">\n      {/* Header - Mobile Responsive with Profile */}\n      <div className=\"bg-gradient-to-r from-[#059211] to-[#047a0e] text-white px-3 sm:px-4 py-3 sm:py-4 shadow-lg\">\n        <div className=\"container mx-auto flex items-center justify-between\">\n          <div className=\"flex items-center gap-2 sm:gap-3 flex-1 min-w-0\">\n            <Link href=\"/\" className=\"hover:bg-white/10 p-1.5 sm:p-2 rounded-lg transition-colors flex-shrink-0\">\n              <ArrowLeft className=\"w-4 h-4 sm:w-5 sm:h-5\" />\n            </Link>\n            <h1 className=\"text-base sm:text-xl font-bold truncate\">\n              {currentModule \n                ? `${currentModule.emoji} ${currentModule.name}`\n                : 'üí¨ Mangwale AI'\n              }\n            </h1>\n          </div>\n          <div className=\"flex items-center gap-2 sm:gap-3 flex-shrink-0\">\n            {/* Connection Status */}\n            <div className=\"flex items-center gap-1.5\">\n              <div className={`w-2 h-2 rounded-full ${isConnected ? 'bg-green-300 animate-pulse' : 'bg-red-400'}`} />\n              <span className=\"text-xs sm:text-sm font-medium hidden sm:inline\">{isConnected ? 'Connected' : 'Disconnected'}</span>\n              <span className=\"text-xs font-medium sm:hidden\">{isConnected ? '‚óè' : '‚óã'}</span>\n            </div>\n\n            {/* Clear/Reset Chat Button */}\n            <button\n              onClick={() => {\n                if (confirm('Clear chat and start over?')) {\n                  localStorage.removeItem('mangwale-chat-session-id')\n                  window.location.reload()\n                }\n              }}\n              className=\"hover:bg-white/10 p-1.5 sm:p-2 rounded-full transition-colors flex-shrink-0\"\n              title=\"Clear chat and start over\"\n            >\n              <RotateCcw className=\"w-4 h-4 sm:w-5 sm:h-5\" />\n            </button>\n            \n            {/* User Profile Button */}\n            <div ref={profileRef} className=\"relative\">\n              <button\n                onClick={() => setShowProfile(!showProfile)}\n                className=\"hover:bg-white/10 p-1.5 sm:p-2 rounded-full transition-colors flex-shrink-0\"\n                title=\"Your Profile\"\n              >\n                {userProfile ? (\n                  <div className=\"w-7 h-7 sm:w-8 sm:h-8 bg-white text-green-600 rounded-full flex items-center justify-center font-bold text-sm\">\n                    {userProfile.name ? userProfile.name[0].toUpperCase() : userProfile.phone ? userProfile.phone[0] : 'U'}\n                  </div>\n                ) : (\n                  <User className=\"w-5 h-5 sm:w-6 sm:h-6\" />\n                )}\n              </button>\n              \n              {/* Profile Dropdown */}\n              {showProfile && (\n                <div className=\"absolute right-0 top-12 bg-white text-gray-900 rounded-lg shadow-2xl z-50 w-64 border-2 border-gray-200 overflow-hidden\">\n                  {userProfile ? (\n                    <>\n                      <div className=\"bg-gradient-to-br from-green-50 to-green-100 px-4 py-4 border-b-2 border-green-200\">\n                        <div className=\"flex items-center gap-3\">\n                          <div className=\"w-12 h-12 bg-green-600 text-white rounded-full flex items-center justify-center font-bold text-xl\">\n                            {userProfile.name ? userProfile.name[0].toUpperCase() : userProfile.phone ? userProfile.phone[0] : 'U'}\n                          </div>\n                          <div className=\"flex-1 min-w-0\">\n                            {userProfile.name && (\n                              <h3 className=\"font-bold text-base text-gray-900 truncate\">{userProfile.name}</h3>\n                            )}\n                            {userProfile.phone && (\n                              <p className=\"text-sm text-gray-600\">{userProfile.phone}</p>\n                            )}\n                          </div>\n                        </div>\n                      </div>\n                      <div className=\"px-4 py-3\">\n                        <button\n                          onClick={() => {\n                            // Clear ALL auth data\n                            useAuthStore.getState().clearAuth()\n                            localStorage.removeItem('mangwale-user-profile')\n                            localStorage.removeItem('mangwale-chat-session-id')\n                            localStorage.removeItem('mangwale-user-location')\n                            localStorage.removeItem('user-location-captured')\n                            setUserProfile(null)\n                            setShowProfile(false)\n                            // Disconnect WebSocket before reload\n                            wsClientRef.current?.disconnect()\n                            window.location.reload()\n                          }}\n                          className=\"w-full px-4 py-2 text-sm font-semibold text-red-600 hover:bg-red-50 rounded-lg transition-colors\"\n                        >\n                          Sign Out\n                        </button>\n                      </div>\n                    </>\n                  ) : (\n                    <div className=\"px-4 py-4 text-center text-gray-600\">\n                      <User className=\"w-12 h-12 mx-auto mb-2 text-gray-400\" />\n                      <p className=\"text-sm\">No profile information</p>\n                      <p className=\"text-xs text-gray-500 mt-1\">Continue chatting to save your profile</p>\n                    </div>\n                  )}\n                </div>\n              )}\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Module Selection - Mobile Responsive */}\n      {!selectedModule && (\n        <div className=\"bg-white border-b border-gray-200 px-3 sm:px-4 py-3 sm:py-4 shadow-sm\">\n          <div className=\"container mx-auto\">\n            <p className=\"text-xs sm:text-sm text-gray-700 font-semibold mb-2 sm:mb-3\">Choose a service:</p>\n            <div className=\"flex gap-2 sm:gap-3 overflow-x-auto pb-2 scrollbar-hide\">\n              {modules.map((mod) => (\n                <button\n                  key={mod.id}\n                  onClick={() => handleModuleSelect(mod.id)}\n                  className=\"flex items-center gap-1.5 sm:gap-2 px-3 sm:px-5 py-2 sm:py-3 bg-gradient-to-br from-gray-50 to-gray-100 hover:from-[#059211] hover:to-[#047a0e] hover:text-white border-2 border-gray-200 hover:border-[#059211] rounded-full text-xs sm:text-sm font-semibold transition-all duration-200 whitespace-nowrap shadow-sm hover:shadow-md transform hover:scale-105 active:scale-95\"\n                >\n                  <span className=\"text-base sm:text-xl\">{mod.emoji}</span>\n                  <span>{mod.name}</span>\n                </button>\n              ))}\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Messages Area - Mobile Responsive */}\n      <div className=\"flex-1 overflow-y-auto px-2 sm:px-4 py-3 sm:py-6\">\n        <div className=\"container mx-auto max-w-3xl\">\n          {messages.map((message) => (\n            <div\n              key={message.id}\n              className={`flex mb-3 sm:mb-4 ${\n                message.role === 'user' ? 'justify-end' : 'justify-start'\n              }`}\n            >\n              <div className={`max-w-[85%] sm:max-w-[80%] ${message.role === 'user' ? 'flex justify-end' : ''}`}>\n                <div\n                  className={`rounded-2xl px-3 sm:px-5 py-2 sm:py-3 ${\n                    message.role === 'user'\n                      ? 'bg-gradient-to-r from-[#059211] to-[#047a0e] text-white rounded-br-sm shadow-lg'\n                      : 'bg-gradient-to-br from-white to-gray-50 text-gray-900 rounded-bl-sm shadow-md border border-gray-200'\n                  }`}\n                >\n                  <p className=\"text-sm sm:text-base leading-relaxed whitespace-pre-wrap break-words\">{message.content}</p>\n                  {message.timestamp > 0 && (\n                    <p className={`text-xs mt-1 sm:mt-1.5 ${\n                      message.role === 'user' ? 'text-green-100' : 'text-gray-400'\n                    }`}>\n                      {new Date(message.timestamp).toLocaleTimeString([], { \n                        hour: '2-digit', \n                        minute: '2-digit' \n                      })}\n                    </p>\n                  )}\n                </div>\n\n                {/* Render buttons for AI messages - Mobile Responsive */}\n                {message.role === 'assistant' && message.buttons && message.buttons.length > 0 && (\n                  <div className=\"flex flex-wrap gap-1.5 sm:gap-2 mt-2 sm:mt-3\">\n                    {message.buttons.map((button) => (\n                      <button\n                        key={button.id}\n                        onClick={() => {\n                          // Special button: trigger login modal\n                          if (button.value === '__LOGIN__' || button.value === '__AUTHENTICATE__') {\n                            setShowLoginModal(true)\n                          } else {\n                            handleSend(button.value)\n                          }\n                        }}\n                        className=\"px-3 sm:px-5 py-1.5 sm:py-2.5 bg-gradient-to-r from-green-50 to-emerald-50 hover:from-[#059211] hover:to-[#047a0e] border-2 border-[#059211] text-[#059211] hover:text-white rounded-full text-xs sm:text-sm font-semibold transition-all duration-200 shadow-md hover:shadow-lg transform hover:scale-105 active:scale-95\"\n                      >\n                        {button.label}\n                      </button>\n                    ))}\n                  </div>\n                )}\n\n                {/* Render product/restaurant cards for AI messages */}\n                {message.role === 'assistant' && message.cards && message.cards.length > 0 && (\n                  <div className=\"flex flex-col gap-3 mt-3\">\n                    {message.cards.map((card) => (\n                      <ProductCard\n                        key={card.id}\n                        card={card}\n                        onAction={(value) => handleSend(value)}\n                      />\n                    ))}\n                  </div>\n                )}\n              </div>\n            </div>\n          ))}\n\n          {isTyping && (\n            <div className=\"flex justify-start mb-4\">\n              <div className=\"bg-gradient-to-br from-white to-gray-50 rounded-2xl px-5 py-4 shadow-lg border border-gray-200\">\n                <div className=\"flex gap-1.5\">\n                  <div className=\"w-2.5 h-2.5 bg-[#059211] rounded-full animate-bounce\" style={{ animationDelay: '0ms' }} />\n                  <div className=\"w-2.5 h-2.5 bg-[#059211] rounded-full animate-bounce\" style={{ animationDelay: '150ms' }} />\n                  <div className=\"w-2.5 h-2.5 bg-[#059211] rounded-full animate-bounce\" style={{ animationDelay: '300ms' }} />\n                </div>\n              </div>\n            </div>\n          )}\n\n          <div ref={messagesEndRef} />\n        </div>\n      </div>\n\n      {/* Input Area - Mobile Responsive */}\n      <div className=\"bg-white border-t-2 border-gray-200 px-2 sm:px-4 py-2 sm:py-4 shadow-lg safe-area-bottom\">\n        <div className=\"container mx-auto max-w-3xl\">\n          <div className=\"flex items-end gap-1.5 sm:gap-3\">\n            {/* Quick Location Button */}\n            <button \n              onClick={handleShareLocation}\n              disabled={isGettingLocation}\n              className=\"p-2 sm:p-3 bg-gray-100 text-gray-600 hover:bg-[#059211] hover:text-white rounded-full transition-all duration-200 shadow-md disabled:opacity-50 disabled:cursor-not-allowed flex-shrink-0\"\n              title=\"Share my current location\"\n            >\n              <MapPin className={`w-4 h-4 sm:w-5 sm:h-5 ${isGettingLocation ? 'animate-pulse' : ''}`} />\n            </button>\n            \n            {/* Map Picker Button */}\n            <button \n              onClick={() => setShowLocationPicker(true)}\n              className=\"p-2 sm:p-3 bg-gray-100 text-gray-600 hover:bg-[#059211] hover:text-white rounded-full transition-all duration-200 shadow-md flex-shrink-0\"\n              title=\"Choose location on map\"\n            >\n              <Map className=\"w-4 h-4 sm:w-5 sm:h-5\" />\n            </button>\n            \n            {/* Input Field */}\n            <div className=\"flex-1 bg-gray-100 rounded-3xl px-3 sm:px-5 py-2 sm:py-3 flex items-center gap-2 sm:gap-3 shadow-inner border border-gray-200\">\n              <input\n                ref={inputRef}\n                type=\"text\"\n                value={input}\n                onChange={(e) => setInput(e.target.value)}\n                onKeyPress={handleKeyPress}\n                placeholder=\"Ask me anything...\"\n                className=\"flex-1 bg-transparent outline-none text-gray-900 placeholder-gray-400 text-sm sm:text-base\"\n              />\n              <button className=\"text-gray-500 hover:text-[#059211] transition-colors flex-shrink-0\">\n                <Mic className=\"w-4 h-4 sm:w-5 sm:h-5\" />\n              </button>\n            </div>\n\n            {/* Send Button */}\n            <button\n              onClick={handleSendClick}\n              disabled={!input.trim() || isTyping}\n              className=\"p-3 sm:p-4 bg-gradient-to-r from-[#059211] to-[#047a0e] text-white rounded-full hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 shadow-lg transform hover:scale-110 active:scale-95 flex-shrink-0\"\n            >\n              <Send className=\"w-4 h-4 sm:w-5 sm:h-5\" />\n            </button>\n          </div>\n        </div>\n      </div>\n\n      {/* Location Picker Modal */}\n      {showLocationPicker && (\n        <LocationPicker\n          onLocationConfirm={handleLocationConfirm}\n          onCancel={() => setShowLocationPicker(false)}\n        />\n      )}\n\n      {/* Inline Login Modal - Appears when user needs to authenticate */}\n      {showLoginModal && (\n        <InlineLogin\n          onClose={() => setShowLoginModal(false)}\n          onSuccess={() => {\n            setShowLoginModal(false)\n            // Optionally prompt for location after login\n            setTimeout(() => setShowLocationPicker(true), 1000)\n          }}\n        />\n      )}\n    </div>\n    </>\n  )\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}