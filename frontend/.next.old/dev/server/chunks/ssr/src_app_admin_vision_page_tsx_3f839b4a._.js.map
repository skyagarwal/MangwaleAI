{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///app/src/app/admin/vision/page.tsx"],"sourcesContent":["'use client';\n\nimport { useState } from 'react';\nimport { Upload, CheckCircle2, XCircle, AlertCircle, Camera } from 'lucide-react';\nimport Image from 'next/image';\n\ninterface PPEResult {\n  isCompliant: boolean;\n  helmet: {\n    detected: boolean;\n    confidence: number;\n    bbox?: any;\n  };\n  uniform: {\n    detected: boolean;\n    color: string;\n    confidence: number;\n    hasLogo: boolean;\n    bbox?: any;\n  };\n  bag: {\n    detected: boolean;\n    confidence: number;\n    bbox?: any;\n  };\n  violations: string[];\n  rawDetections?: any[];\n}\n\ninterface VisionResult {\n  faceRecognition?: {\n    identified: boolean;\n    employeeId?: string;\n    name?: string;\n    confidence?: number;\n  };\n  ppeCompliance: PPEResult;\n  overallCompliance: boolean;\n  violations: string[];\n  timestamp: string;\n}\n\nexport default function RiderCompliancePage() {\n  const [selectedImage, setSelectedImage] = useState<File | null>(null);\n  const [previewUrl, setPreviewUrl] = useState<string>('');\n  const [loading, setLoading] = useState(false);\n  const [result, setResult] = useState<VisionResult | null>(null);\n  const [error, setError] = useState<string>('');\n\n  const handleImageSelect = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (file) {\n      setSelectedImage(file);\n      setPreviewUrl(URL.createObjectURL(file));\n      setResult(null);\n      setError('');\n    }\n  };\n\n  const handleCheck = async () => {\n    if (!selectedImage) return;\n\n    setLoading(true);\n    setError('');\n\n    try {\n      const formData = new FormData();\n      formData.append('image', selectedImage);\n\n      const response = await fetch('/api/vision/check-rider', {\n        method: 'POST',\n        body: formData,\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.message || 'Failed to analyze image');\n      }\n\n      const data = await response.json();\n      setResult(data.data);\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Failed to analyze image');\n      console.error('Vision check error:', err);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const ComplianceCard = ({ \n    title, \n    detected, \n    confidence, \n    icon: Icon \n  }: { \n    title: string; \n    detected: boolean; \n    confidence: number; \n    icon: React.ElementType;\n  }) => (\n    <div className={`p-4 rounded-lg border-2 ${\n      detected \n        ? 'bg-green-50 border-green-300' \n        : 'bg-red-50 border-red-300'\n    }`}>\n      <div className=\"flex items-center justify-between\">\n        <div className=\"flex items-center gap-3\">\n          <Icon className={detected ? 'text-green-600' : 'text-red-600'} size={24} />\n          <div>\n            <h3 className=\"font-semibold text-gray-900\">{title}</h3>\n            <p className=\"text-sm text-gray-600\">\n              {detected ? 'Detected' : 'Not Detected'}\n            </p>\n          </div>\n        </div>\n        {detected ? (\n          <CheckCircle2 className=\"text-green-600\" size={32} />\n        ) : (\n          <XCircle className=\"text-red-600\" size={32} />\n        )}\n      </div>\n      {detected && (\n        <div className=\"mt-2 text-sm text-gray-600\">\n          Confidence: {(confidence * 100).toFixed(1)}%\n        </div>\n      )}\n    </div>\n  );\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-gray-900\">Rider Compliance Checker</h1>\n          <p className=\"text-gray-600 mt-1\">\n            Upload a rider photo to check helmet, uniform, and bag compliance\n          </p>\n        </div>\n        <Camera className=\"text-blue-600\" size={48} />\n      </div>\n\n      <div className=\"grid lg:grid-cols-2 gap-6\">\n        {/* Upload Section */}\n        <div className=\"space-y-4\">\n          <div className=\"bg-white rounded-lg shadow p-6\">\n            <h2 className=\"text-lg font-semibold mb-4\">Upload Rider Image</h2>\n            \n            {/* Image Preview */}\n            {previewUrl ? (\n              <div className=\"relative aspect-video bg-gray-100 rounded-lg overflow-hidden mb-4\">\n                <Image\n                  src={previewUrl}\n                  alt=\"Preview\"\n                  fill\n                  className=\"object-contain\"\n                />\n              </div>\n            ) : (\n              <div className=\"aspect-video bg-gray-100 rounded-lg flex items-center justify-center mb-4\">\n                <div className=\"text-center\">\n                  <Upload className=\"mx-auto text-gray-400\" size={48} />\n                  <p className=\"text-gray-500 mt-2\">No image selected</p>\n                </div>\n              </div>\n            )}\n\n            {/* File Input */}\n            <div className=\"space-y-4\">\n              <label className=\"block\">\n                <span className=\"sr-only\">Choose rider image</span>\n                <input\n                  type=\"file\"\n                  accept=\"image/*\"\n                  onChange={handleImageSelect}\n                  className=\"block w-full text-sm text-gray-500\n                    file:mr-4 file:py-2 file:px-4\n                    file:rounded-lg file:border-0\n                    file:text-sm file:font-semibold\n                    file:bg-blue-50 file:text-blue-700\n                    hover:file:bg-blue-100\n                    cursor-pointer\"\n                />\n              </label>\n\n              <button\n                onClick={handleCheck}\n                disabled={!selectedImage || loading}\n                className=\"w-full py-3 px-4 bg-blue-600 text-white rounded-lg font-semibold\n                  hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed\n                  transition-colors duration-200\"\n              >\n                {loading ? 'Analyzing...' : 'Check Compliance'}\n              </button>\n            </div>\n\n            {error && (\n              <div className=\"mt-4 p-4 bg-red-50 border border-red-200 rounded-lg flex items-start gap-3\">\n                <AlertCircle className=\"text-red-600 flex-shrink-0 mt-0.5\" size={20} />\n                <div>\n                  <p className=\"font-semibold text-red-900\">Error</p>\n                  <p className=\"text-sm text-red-700\">{error}</p>\n                </div>\n              </div>\n            )}\n          </div>\n        </div>\n\n        {/* Results Section */}\n        <div className=\"space-y-4\">\n          <div className=\"bg-white rounded-lg shadow p-6\">\n            <h2 className=\"text-lg font-semibold mb-4\">Compliance Results</h2>\n\n            {!result ? (\n              <div className=\"text-center py-12 text-gray-500\">\n                <AlertCircle className=\"mx-auto mb-3 text-gray-400\" size={48} />\n                <p>Upload and analyze an image to see results</p>\n              </div>\n            ) : (\n              <div className=\"space-y-4\">\n                {/* Overall Status */}\n                <div className={`p-4 rounded-lg ${\n                  result.overallCompliance \n                    ? 'bg-green-100 border-2 border-green-400' \n                    : 'bg-red-100 border-2 border-red-400'\n                }`}>\n                  <div className=\"flex items-center gap-3\">\n                    {result.overallCompliance ? (\n                      <CheckCircle2 className=\"text-green-700\" size={32} />\n                    ) : (\n                      <XCircle className=\"text-red-700\" size={32} />\n                    )}\n                    <div>\n                      <h3 className=\"font-bold text-lg\">\n                        {result.overallCompliance ? 'Compliant' : 'Non-Compliant'}\n                      </h3>\n                      <p className=\"text-sm opacity-80\">\n                        {new Date(result.timestamp).toLocaleString()}\n                      </p>\n                    </div>\n                  </div>\n                </div>\n\n                {/* Face Recognition */}\n                {result.faceRecognition && (\n                  <div className={`p-4 rounded-lg border-2 ${\n                    result.faceRecognition.identified\n                      ? 'bg-blue-50 border-blue-300'\n                      : 'bg-yellow-50 border-yellow-300'\n                  }`}>\n                    <div className=\"flex items-center gap-3\">\n                      <Camera className={\n                        result.faceRecognition.identified ? 'text-blue-600' : 'text-yellow-600'\n                      } size={24} />\n                      <div>\n                        <h3 className=\"font-semibold\">Face Recognition</h3>\n                        {result.faceRecognition.identified ? (\n                          <p className=\"text-sm\">\n                            {result.faceRecognition.name} ({result.faceRecognition.employeeId})\n                            <br />\n                            Confidence: {((result.faceRecognition.confidence || 0) * 100).toFixed(1)}%\n                          </p>\n                        ) : (\n                          <p className=\"text-sm\">Rider not identified</p>\n                        )}\n                      </div>\n                    </div>\n                  </div>\n                )}\n\n                {/* PPE Components */}\n                <ComplianceCard\n                  title=\"Helmet\"\n                  detected={result.ppeCompliance.helmet.detected}\n                  confidence={result.ppeCompliance.helmet.confidence}\n                  icon={CheckCircle2}\n                />\n\n                <ComplianceCard\n                  title=\"Uniform\"\n                  detected={result.ppeCompliance.uniform.detected}\n                  confidence={result.ppeCompliance.uniform.confidence}\n                  icon={CheckCircle2}\n                />\n\n                <ComplianceCard\n                  title=\"Bag\"\n                  detected={result.ppeCompliance.bag.detected}\n                  confidence={result.ppeCompliance.bag.confidence}\n                  icon={CheckCircle2}\n                />\n\n                {/* Violations */}\n                {result.violations.length > 0 && (\n                  <div className=\"p-4 bg-red-50 border-2 border-red-300 rounded-lg\">\n                    <h3 className=\"font-semibold text-red-900 mb-2\">Violations</h3>\n                    <ul className=\"list-disc list-inside space-y-1\">\n                      {result.violations.map((violation, idx) => (\n                        <li key={idx} className=\"text-sm text-red-700\">\n                          {violation}\n                        </li>\n                      ))}\n                    </ul>\n                  </div>\n                )}\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}