generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-3.0.x", "linux-musl-openssl-3.0.x", "linux-musl", "debian-openssl-1.1.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                 Int       @id @default(autoincrement())
  phpUserId          Int?      @unique @map("php_user_id")
  phone              String    @unique @db.VarChar(50)
  email              String?   @db.VarChar(255)
  firstName          String?   @map("first_name") @db.VarChar(100)
  lastName           String?   @map("last_name") @db.VarChar(100)
  preferredLanguage  String?   @default("en") @map("preferred_language") @db.VarChar(10)
  preferences        Json?     @default("{}")
  interests          Json?     @default("[]")
  totalGamesPlayed   Int?      @default(0) @map("total_games_played")
  totalRewardsEarned Decimal?  @default(0) @map("total_rewards_earned") @db.Decimal(10, 2)
  loyaltyPoints      Int?      @default(0) @map("loyalty_points")
  createdAt          DateTime? @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt          DateTime? @default(now()) @updatedAt @map("updated_at") @db.Timestamp(6)
  lastActiveAt       DateTime? @map("last_active_at") @db.Timestamp(6)

  @@index([phone], map: "idx_users_phone")
  @@index([phpUserId], map: "idx_users_php_id")
  @@map("users")
}

model Flow {
  id             String    @id
  name           String?   @db.VarChar(255)
  description    String?
  module         String?   @default("general") @db.VarChar(255)
  trigger        String?   @db.VarChar(255)
  version        String?   @default("1.0.0") @db.VarChar(50)
  states         Json?
  initialState   String?   @map("initialState") @db.VarChar(255)
  finalStates    Json?     @map("finalStates")
  contextSchema  Json?     @map("contextSchema")
  metadata       Json?
  enabled        Boolean?  @default(true)
  systemCritical Boolean?  @default(false) @map("system_critical")
  status         String?   @default("active") @db.VarChar(50)
  createdAt      DateTime? @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt      DateTime? @default(now()) @updatedAt @map("updated_at") @db.Timestamp(6)

  @@map("flows")
}

model FlowRun {
  id           String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  flowId       String    @map("flow_id")
  sessionId    String    @map("session_id")
  phoneNumber  String    @map("phone_number")
  currentState String    @map("current_state")
  context      Json      @default("{}")
  status       String    @default("active")
  error        String?
  startedAt    DateTime  @default(now()) @map("started_at") @db.Timestamptz(6)
  completedAt  DateTime? @map("completed_at") @db.Timestamptz(6)
  updatedAt    DateTime  @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  @@index([flowId], map: "idx_flow_runs_flow")
  @@index([phoneNumber], map: "idx_flow_runs_phone")
  @@index([sessionId], map: "idx_flow_runs_session")
  @@index([status], map: "idx_flow_runs_status")
  @@map("flow_runs")
}

model LlmModelUsage {
  id           String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  modelId      String   @map("model_id")
  modelName    String?  @map("model_name")
  provider     String
  userId       String?  @map("user_id")
  sessionId    String?  @map("session_id")
  inputTokens  Int      @map("input_tokens")
  outputTokens Int      @map("output_tokens")
  totalTokens  Int      @map("total_tokens")
  latencyMs    Int      @map("latency_ms")
  cost         Decimal  @db.Decimal(10, 6)
  purpose      String?
  channel      String?
  status       String
  errorMessage String?  @map("error_message")
  metadata     Json?
  createdAt    DateTime @default(now()) @map("created_at") @db.Timestamptz(6)

  @@index([createdAt], map: "idx_llm_usage_created")
  @@index([modelId], map: "idx_llm_usage_model")
  @@index([provider], map: "idx_llm_usage_provider")
  @@index([status], map: "idx_llm_usage_status")
  @@index([userId], map: "idx_llm_usage_user")
  @@map("llm_model_usage")
}

model auth_group {
  id                     Int                      @id @default(autoincrement())
  name                   String                   @unique @db.VarChar(150)
  auth_group_permissions auth_group_permissions[]
  htx_user_groups        htx_user_groups[]

  @@index([name], map: "auth_group_name_a6ea08ec_like")
}

/// This model has constraints using non-default deferring rules and requires additional setup for migrations. Visit https://pris.ly/d/constraint-deferring for more info.
model auth_group_permissions {
  id              Int             @id @default(autoincrement())
  group_id        Int
  permission_id   Int
  auth_permission auth_permission @relation(fields: [permission_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "auth_group_permissio_permission_id_84c5c92e_fk_auth_perm")
  auth_group      auth_group      @relation(fields: [group_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "auth_group_permissions_group_id_b120cbf9_fk_auth_group_id")

  @@unique([group_id, permission_id], map: "auth_group_permissions_group_id_permission_id_0cd325b0_uniq")
  @@index([group_id], map: "auth_group_permissions_group_id_b120cbf9")
  @@index([permission_id], map: "auth_group_permissions_permission_id_84c5c92e")
}

/// This model has constraints using non-default deferring rules and requires additional setup for migrations. Visit https://pris.ly/d/constraint-deferring for more info.
model auth_permission {
  id                        Int                         @id @default(autoincrement())
  name                      String                      @db.VarChar(255)
  content_type_id           Int
  codename                  String                      @db.VarChar(100)
  auth_group_permissions    auth_group_permissions[]
  django_content_type       django_content_type         @relation(fields: [content_type_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "auth_permission_content_type_id_2f476e4b_fk_django_co")
  htx_user_user_permissions htx_user_user_permissions[]

  @@unique([content_type_id, codename], map: "auth_permission_content_type_id_codename_01ab375a_uniq")
  @@index([content_type_id], map: "auth_permission_content_type_id_2f476e4b")
}

/// This model has constraints using non-default deferring rules and requires additional setup for migrations. Visit https://pris.ly/d/constraint-deferring for more info.
model authtoken_token {
  key      String   @id @db.VarChar(40)
  created  DateTime @db.Timestamptz(6)
  user_id  Int      @unique
  htx_user htx_user @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "authtoken_token_user_id_35299eff_fk_htx_user_id")

  @@index([key], map: "authtoken_token_key_10f0b77e_like")
}

model ConversationLog {
  id                       String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  sessionId                String    @map("session_id")
  phoneNumber              String?   @map("phone_number")
  userMessage              String?   @map("user_message")
  botResponse              String?   @map("bot_response")
  intent                   String?
  confidence               Decimal?  @db.Decimal(4, 3)
  entities                 Json?     @default("{}")
  createdAt                DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  userId                   Int?      @map("user_id")
  channel                  String?   @default("web") @db.VarChar(50)
  messageType              String?   @default("text") @map("message_type") @db.VarChar(20)
  nluIntent                String?   @map("nlu_intent") @db.VarChar(100)
  nluConfidence            Decimal?  @map("nlu_confidence") @db.Decimal(5, 4)
  nluAlternateIntents      Json?     @map("nlu_alternate_intents")
  nluEntities              Json?     @map("nlu_entities")
  nluLanguage              String?   @map("nlu_language") @db.VarChar(10)
  nluTone                  String?   @map("nlu_tone") @db.VarChar(50)
  nluProvider              String?   @map("nlu_provider") @db.VarChar(50)
  nluProcessingTimeMs      Int?      @map("nlu_processing_time_ms")
  routedTo                 String?   @map("routed_to") @db.VarChar(100)
  routingReason            String?   @map("routing_reason")
  flowId                   String?   @map("flow_id") @db.VarChar(100)
  agentId                  String?   @map("agent_id") @db.VarChar(100)
  responseType             String?   @map("response_type") @db.VarChar(50)
  responseSuccess          Boolean?  @default(true) @map("response_success")
  responseTimeMs           Int?      @map("response_time_ms")
  conversationContext      Json?     @map("conversation_context")
  turnNumber               Int?      @map("turn_number")
  isTrainingCandidate      Boolean?  @default(false) @map("is_training_candidate")
  trainingConfidenceBucket String?   @map("training_confidence_bucket") @db.VarChar(20)

  @@map("conversation_logs")
}

/// This model has constraints using non-default deferring rules and requires additional setup for migrations. Visit https://pris.ly/d/constraint-deferring for more info.
model core_asyncmigrationstatus {
  id         Int      @id @default(autoincrement())
  meta       Json?
  name       String
  status     String?  @db.VarChar(100)
  created_at DateTime @db.Timestamptz(6)
  updated_at DateTime @db.Timestamptz(6)
  project_id Int?
  project    project? @relation(fields: [project_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "core_asyncmigrationstatus_project_id_c78fbf75_fk_project_id")

  @@index([project_id], map: "core_asyncmigrationstatus_project_id_c78fbf75")
}

model core_deletedrow {
  id              Int      @id @default(autoincrement())
  model           String   @db.VarChar(1024)
  row_id          Int?
  data            Json?
  reason          String?
  created_at      DateTime @db.Timestamptz(6)
  updated_at      DateTime @db.Timestamptz(6)
  organization_id Int?
  project_id      Int?
  user_id         Int?
}

/// This model has constraints using non-default deferring rules and requires additional setup for migrations. Visit https://pris.ly/d/constraint-deferring for more info.
model data_export_convertedformat {
  id                 Int                @id @default(autoincrement())
  file               String?            @db.VarChar(100)
  status             String             @db.VarChar(64)
  export_type        String             @db.VarChar(64)
  export_id          Int
  created_at         DateTime?          @db.Timestamptz(6)
  created_by_id      Int?
  finished_at        DateTime?          @db.Timestamptz(6)
  organization_id    Int?
  project_id         Int?
  updated_at         DateTime?          @db.Timestamptz(6)
  traceback          String?
  htx_user           htx_user?          @relation(fields: [created_by_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "data_export_converte_created_by_id_a765f2cd_fk_htx_user_")
  data_export_export data_export_export @relation(fields: [export_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "data_export_converte_export_id_3305f028_fk_data_expo")
  organization       organization?      @relation(fields: [organization_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "data_export_converte_organization_id_d0e9d7c8_fk_organizat")
  project            project?           @relation(fields: [project_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "data_export_convertedformat_project_id_3cda1a1c_fk_project_id")

  @@index([created_by_id], map: "data_export_convertedformat_created_by_id_a765f2cd")
  @@index([export_id], map: "data_export_convertedformat_export_id_3305f028")
  @@index([organization_id], map: "data_export_convertedformat_organization_id_d0e9d7c8")
  @@index([project_id], map: "data_export_convertedformat_project_id_3cda1a1c")
}

/// This model has constraints using non-default deferring rules and requires additional setup for migrations. Visit https://pris.ly/d/constraint-deferring for more info.
model data_export_export {
  id                          Int                           @id @default(autoincrement())
  created_at                  DateTime                      @db.Timestamptz(6)
  file                        String?                       @db.VarChar(100)
  md5                         String                        @db.VarChar(128)
  finished_at                 DateTime?                     @db.Timestamptz(6)
  status                      String                        @db.VarChar(64)
  counters                    Json
  created_by_id               Int?
  project_id                  Int
  title                       String                        @db.VarChar(2048)
  data_export_convertedformat data_export_convertedformat[]
  htx_user                    htx_user?                     @relation(fields: [created_by_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "data_export_export_created_by_id_ae0b7af3_fk_htx_user_id")
  project                     project                       @relation(fields: [project_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "data_export_export_project_id_dc05487f_fk_project_id")

  @@index([created_by_id], map: "data_export_export_created_by_id_ae0b7af3")
  @@index([project_id], map: "data_export_export_project_id_dc05487f")
}

/// This model has constraints using non-default deferring rules and requires additional setup for migrations. Visit https://pris.ly/d/constraint-deferring for more info.
model data_import_fileupload {
  id         Int      @id @default(autoincrement())
  file       String   @db.VarChar(100)
  project_id Int
  user_id    Int
  project    project  @relation(fields: [project_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "data_import_fileupload_project_id_1f511810_fk_project_id")
  htx_user   htx_user @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "data_import_fileupload_user_id_a3e1f065_fk_htx_user_id")
  task       task[]

  @@index([project_id], map: "data_import_fileupload_project_id_1f511810")
  @@index([user_id], map: "data_import_fileupload_user_id_a3e1f065")
}

/// This model has constraints using non-default deferring rules and requires additional setup for migrations. Visit https://pris.ly/d/constraint-deferring for more info.
model data_manager_filter {
  id                               Int                                @id @default(autoincrement())
  column                           String                             @db.VarChar(1024)
  type                             String                             @db.VarChar(1024)
  operator                         String                             @db.VarChar(1024)
  value                            Json?
  index                            Int?
  parent_id                        Int?
  data_manager_filter              data_manager_filter?               @relation("data_manager_filterTodata_manager_filter", fields: [parent_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "data_manager_filter_parent_id_b5dd2a37_fk_data_mana")
  other_data_manager_filter        data_manager_filter[]              @relation("data_manager_filterTodata_manager_filter")
  data_manager_filtergroup_filters data_manager_filtergroup_filters[]

  @@index([parent_id], map: "data_manager_filter_parent_id_b5dd2a37")
}

model data_manager_filtergroup {
  id                               Int                                @id @default(autoincrement())
  conjunction                      String                             @db.VarChar(1024)
  data_manager_filtergroup_filters data_manager_filtergroup_filters[]
  data_manager_view                data_manager_view[]
}

/// This model has constraints using non-default deferring rules and requires additional setup for migrations. Visit https://pris.ly/d/constraint-deferring for more info.
model data_manager_filtergroup_filters {
  id                       Int                      @id @default(autoincrement())
  filtergroup_id           Int
  filter_id                Int
  data_manager_filter      data_manager_filter      @relation(fields: [filter_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "data_manager_filterg_filter_id_954bc394_fk_data_mana")
  data_manager_filtergroup data_manager_filtergroup @relation(fields: [filtergroup_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "data_manager_filterg_filtergroup_id_85d9bb16_fk_data_mana")

  @@unique([filtergroup_id, filter_id], map: "data_manager_filtergroup_filtergroup_id_filter_id_196c3e22_uniq")
  @@index([filter_id], map: "data_manager_filtergroup_filters_filter_id_954bc394")
  @@index([filtergroup_id], map: "data_manager_filtergroup_filters_filtergroup_id_85d9bb16")
}

/// This model has constraints using non-default deferring rules and requires additional setup for migrations. Visit https://pris.ly/d/constraint-deferring for more info.
model data_manager_view {
  id                       Int                       @id @default(autoincrement())
  data                     Json?
  project_id               Int
  ordering                 Json?
  filter_group_id          Int?
  selected_items           Json?
  user_id                  Int?
  order                    Int?
  data_manager_filtergroup data_manager_filtergroup? @relation(fields: [filter_group_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "data_manager_view_filter_group_id_39a9ec2b_fk_data_mana")
  project                  project                   @relation(fields: [project_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "data_manager_view_project_id_59f5a002_fk_project_id")
  htx_user                 htx_user?                 @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "data_manager_view_user_id_e71e14cd_fk_htx_user_id")

  @@index([project_id, order], map: "data_manage_project_69b96e_idx")
  @@index([filter_group_id], map: "data_manager_view_filter_group_id_39a9ec2b")
  @@index([project_id], map: "data_manager_view_project_id_59f5a002")
  @@index([user_id], map: "data_manager_view_user_id_e71e14cd")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model has constraints using non-default deferring rules and requires additional setup for migrations. Visit https://pris.ly/d/constraint-deferring for more info.
model django_admin_log {
  id                  Int                  @id @default(autoincrement())
  action_time         DateTime             @db.Timestamptz(6)
  object_id           String?
  object_repr         String               @db.VarChar(200)
  action_flag         Int                  @db.SmallInt
  change_message      String
  content_type_id     Int?
  user_id             Int
  django_content_type django_content_type? @relation(fields: [content_type_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "django_admin_log_content_type_id_c4bce8eb_fk_django_co")
  htx_user            htx_user             @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "django_admin_log_user_id_c564eba6_fk_htx_user_id")

  @@index([content_type_id], map: "django_admin_log_content_type_id_c4bce8eb")
  @@index([user_id], map: "django_admin_log_user_id_c564eba6")
}

model django_content_type {
  id               Int                @id @default(autoincrement())
  app_label        String             @db.VarChar(100)
  model            String             @db.VarChar(100)
  auth_permission  auth_permission[]
  django_admin_log django_admin_log[]

  @@unique([app_label, model], map: "django_content_type_app_label_model_76bd3d3b_uniq")
}

model django_migrations {
  id      Int      @id @default(autoincrement())
  app     String   @db.VarChar(255)
  name    String   @db.VarChar(255)
  applied DateTime @db.Timestamptz(6)
}

model django_session {
  session_key  String   @id @db.VarChar(40)
  session_data String
  expire_date  DateTime @db.Timestamptz(6)

  @@index([expire_date], map: "django_session_expire_date_a5c62663")
  @@index([session_key], map: "django_session_session_key_c0390e0f_like")
}

/// This model has constraints using non-default deferring rules and requires additional setup for migrations. Visit https://pris.ly/d/constraint-deferring for more info.
model htx_user {
  id                                                                 Int                                          @id @default(autoincrement())
  password                                                           String                                       @db.VarChar(128)
  last_login                                                         DateTime?                                    @db.Timestamptz(6)
  is_superuser                                                       Boolean
  username                                                           String                                       @db.VarChar(256)
  email                                                              String                                       @unique @db.VarChar(254)
  first_name                                                         String                                       @db.VarChar(256)
  last_name                                                          String                                       @db.VarChar(256)
  is_staff                                                           Boolean
  is_active                                                          Boolean
  date_joined                                                        DateTime                                     @db.Timestamptz(6)
  last_activity                                                      DateTime                                     @db.Timestamptz(6)
  activity_at                                                        DateTime                                     @db.Timestamptz(6)
  phone                                                              String                                       @db.VarChar(256)
  avatar                                                             String                                       @db.VarChar(100)
  active_organization_id                                             Int?
  allow_newsletters                                                  Boolean?
  custom_hotkeys                                                     Json?
  authtoken_token                                                    authtoken_token?
  data_export_convertedformat                                        data_export_convertedformat[]
  data_export_export                                                 data_export_export[]
  data_import_fileupload                                             data_import_fileupload[]
  data_manager_view                                                  data_manager_view[]
  django_admin_log                                                   django_admin_log[]
  organization_htx_user_active_organization_idToorganization         organization?                                @relation("htx_user_active_organization_idToorganization", fields: [active_organization_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "htx_user_active_organization_id_2e1bb565_fk_organization_id")
  htx_user_groups                                                    htx_user_groups[]
  htx_user_user_permissions                                          htx_user_user_permissions[]
  labels_manager_label_labels_manager_label_approved_by_idTohtx_user labels_manager_label[]                       @relation("labels_manager_label_approved_by_idTohtx_user")
  labels_manager_label_labels_manager_label_created_by_idTohtx_user  labels_manager_label[]                       @relation("labels_manager_label_created_by_idTohtx_user")
  ml_model_providers_modelproviderconnection                         ml_model_providers_modelproviderconnection[]
  ml_models_modelinterface                                           ml_models_modelinterface[]
  ml_models_modelrun                                                 ml_models_modelrun[]
  ml_models_thirdpartymodelversion                                   ml_models_thirdpartymodelversion[]
  organization_organization_created_by_idTohtx_user                  organization?                                @relation("organization_created_by_idTohtx_user")
  organizations_organizationmember                                   organizations_organizationmember[]
  project                                                            project[]
  projects_labelstreamhistory                                        projects_labelstreamhistory[]
  projects_projectmember                                             projects_projectmember[]
  task                                                               task[]
  task_comment_authors                                               task_comment_authors[]
  task_completion_task_completion_completed_by_idTohtx_user          task_completion[]                            @relation("task_completion_completed_by_idTohtx_user")
  task_completion_task_completion_last_created_by_idTohtx_user       task_completion[]                            @relation("task_completion_last_created_by_idTohtx_user")
  task_completion_task_completion_updated_by_idTohtx_user            task_completion[]                            @relation("task_completion_updated_by_idTohtx_user")
  tasks_annotationdraft                                              tasks_annotationdraft[]
  tasks_tasklock                                                     tasks_tasklock[]
  token_blacklist_outstandingtoken                                   token_blacklist_outstandingtoken[]
  users_userproducttour                                              users_userproducttour[]

  @@index([active_organization_id], map: "htx_user_active_organization_id_2e1bb565")
  @@index([date_joined], map: "htx_user_date_jo_3bd95e_idx")
  @@index([email], map: "htx_user_email_051c68_idx")
  @@index([email], map: "htx_user_email_9375607c_like")
  @@index([first_name], map: "htx_user_first_n_93c5de_idx")
  @@index([last_name], map: "htx_user_last_na_2ace53_idx")
  @@index([username], map: "htx_user_usernam_a41619_idx")
}

/// This model has constraints using non-default deferring rules and requires additional setup for migrations. Visit https://pris.ly/d/constraint-deferring for more info.
model htx_user_groups {
  id         Int        @id @default(autoincrement())
  user_id    Int
  group_id   Int
  auth_group auth_group @relation(fields: [group_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "htx_user_groups_group_id_d0fee99a_fk_auth_group_id")
  htx_user   htx_user   @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "htx_user_groups_user_id_620c9163_fk_htx_user_id")

  @@unique([user_id, group_id], map: "htx_user_groups_user_id_group_id_34da071d_uniq")
  @@index([group_id], map: "htx_user_groups_group_id_d0fee99a")
  @@index([user_id], map: "htx_user_groups_user_id_620c9163")
}

/// This model has constraints using non-default deferring rules and requires additional setup for migrations. Visit https://pris.ly/d/constraint-deferring for more info.
model htx_user_user_permissions {
  id              Int             @id @default(autoincrement())
  user_id         Int
  permission_id   Int
  auth_permission auth_permission @relation(fields: [permission_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "htx_user_user_permis_permission_id_edaf5db1_fk_auth_perm")
  htx_user        htx_user        @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "htx_user_user_permissions_user_id_a71f59ac_fk_htx_user_id")

  @@unique([user_id, permission_id], map: "htx_user_user_permissions_user_id_permission_id_12eb87f0_uniq")
  @@index([permission_id], map: "htx_user_user_permissions_permission_id_edaf5db1")
  @@index([user_id], map: "htx_user_user_permissions_user_id_a71f59ac")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model has constraints using non-default deferring rules and requires additional setup for migrations. Visit https://pris.ly/d/constraint-deferring for more info.
model io_storages_azureblobexportstorage {
  azureblobstoragemixin_ptr_id           Int                                      @id
  title                                  String?                                  @db.VarChar(256)
  description                            String?
  created_at                             DateTime                                 @db.Timestamptz(6)
  project_id                             Int
  last_sync                              DateTime?                                @db.Timestamptz(6)
  last_sync_count                        Int?
  can_delete_objects                     Boolean?
  last_sync_job                          String?                                  @db.VarChar(256)
  meta                                   Json?
  status                                 String                                   @db.VarChar(64)
  traceback                              String?
  synchronizable                         Boolean
  io_storages_azureblobstoragemixin      io_storages_azureblobstoragemixin        @relation(fields: [azureblobstoragemixin_ptr_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "io_storages_azureblo_azureblobstoragemixi_54a8d52d_fk_io_storag")
  project                                project                                  @relation(fields: [project_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "io_storages_azureblo_project_id_43222df5_fk_project_i")
  io_storages_azureblobexportstoragelink io_storages_azureblobexportstoragelink[]

  @@index([project_id], map: "io_storages_azureblobexportstorage_project_id_43222df5")
}

/// This model has constraints using non-default deferring rules and requires additional setup for migrations. Visit https://pris.ly/d/constraint-deferring for more info.
model io_storages_azureblobexportstoragelink {
  id                                 Int                                @id @default(autoincrement())
  object_exists                      Boolean
  created_at                         DateTime                           @db.Timestamptz(6)
  annotation_id                      Int                                @unique
  storage_id                         Int
  updated_at                         DateTime                           @db.Timestamptz(6)
  task_completion                    task_completion                    @relation(fields: [annotation_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "io_storages_azureblo_annotation_id_6cc15c83_fk_task_comp")
  io_storages_azureblobexportstorage io_storages_azureblobexportstorage @relation(fields: [storage_id], references: [azureblobstoragemixin_ptr_id], onDelete: NoAction, onUpdate: NoAction, map: "io_storages_azureblo_storage_id_1b260b1e_fk_io_storag")

  @@index([annotation_id], map: "io_storages_azureblobexportstoragelink_annotation_id_6cc15c83")
  @@index([storage_id], map: "io_storages_azureblobexportstoragelink_storage_id_1b260b1e")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model has constraints using non-default deferring rules and requires additional setup for migrations. Visit https://pris.ly/d/constraint-deferring for more info.
model io_storages_azureblobimportstorage {
  azureblobstoragemixin_ptr_id           Int                                      @id
  title                                  String?                                  @db.VarChar(256)
  description                            String?
  created_at                             DateTime                                 @db.Timestamptz(6)
  presign                                Boolean
  presign_ttl                            Int                                      @db.SmallInt
  project_id                             Int
  last_sync                              DateTime?                                @db.Timestamptz(6)
  last_sync_count                        Int?
  last_sync_job                          String?                                  @db.VarChar(256)
  meta                                   Json?
  status                                 String                                   @db.VarChar(64)
  traceback                              String?
  synchronizable                         Boolean
  recursive_scan                         Boolean?                                 @default(false)
  io_storages_azureblobstoragemixin      io_storages_azureblobstoragemixin        @relation(fields: [azureblobstoragemixin_ptr_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "io_storages_azureblo_azureblobstoragemixi_e6234dd9_fk_io_storag")
  project                                project                                  @relation(fields: [project_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "io_storages_azureblo_project_id_67a67313_fk_project_i")
  io_storages_azureblobimportstoragelink io_storages_azureblobimportstoragelink[]

  @@index([project_id], map: "io_storages_azureblobimportstorage_project_id_67a67313")
}

/// This model has constraints using non-default deferring rules and requires additional setup for migrations. Visit https://pris.ly/d/constraint-deferring for more info.
model io_storages_azureblobimportstoragelink {
  id                                 Int                                @id @default(autoincrement())
  key                                String
  object_exists                      Boolean
  created_at                         DateTime                           @db.Timestamptz(6)
  task_id                            Int                                @unique
  storage_id                         Int
  row_group                          Int?
  row_index                          Int?
  io_storages_azureblobimportstorage io_storages_azureblobimportstorage @relation(fields: [storage_id], references: [azureblobstoragemixin_ptr_id], onDelete: NoAction, onUpdate: NoAction, map: "io_storages_azureblo_storage_id_a08c3173_fk_io_storag")
  task                               task                               @relation(fields: [task_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "io_storages_azureblob_task_id_26c31809_fk_task_id")

  @@index([storage_id], map: "io_storages_azureblobimportstoragelink_storage_id_a08c3173")
}

model io_storages_azureblobstoragemixin {
  id                                 Int                                 @id @default(autoincrement())
  container                          String?
  prefix                             String?
  regex_filter                       String?
  use_blob_urls                      Boolean
  account_name                       String?
  account_key                        String?
  io_storages_azureblobexportstorage io_storages_azureblobexportstorage?
  io_storages_azureblobimportstorage io_storages_azureblobimportstorage?
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model has constraints using non-default deferring rules and requires additional setup for migrations. Visit https://pris.ly/d/constraint-deferring for more info.
model io_storages_gcsexportstorage {
  gcsstoragemixin_ptr_id           Int                                @id
  title                            String?                            @db.VarChar(256)
  description                      String?
  created_at                       DateTime                           @db.Timestamptz(6)
  project_id                       Int
  last_sync                        DateTime?                          @db.Timestamptz(6)
  last_sync_count                  Int?
  can_delete_objects               Boolean?
  last_sync_job                    String?                            @db.VarChar(256)
  meta                             Json?
  status                           String                             @db.VarChar(64)
  traceback                        String?
  synchronizable                   Boolean
  io_storages_gcsstoragemixin      io_storages_gcsstoragemixin        @relation(fields: [gcsstoragemixin_ptr_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "io_storages_gcsexpor_gcsstoragemixin_ptr__007e6803_fk_io_storag")
  project                          project                            @relation(fields: [project_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "io_storages_gcsexportstorage_project_id_c3141a14_fk_project_id")
  io_storages_gcsexportstoragelink io_storages_gcsexportstoragelink[]

  @@index([project_id], map: "io_storages_gcsexportstorage_project_id_c3141a14")
}

/// This model has constraints using non-default deferring rules and requires additional setup for migrations. Visit https://pris.ly/d/constraint-deferring for more info.
model io_storages_gcsexportstoragelink {
  id                           Int                          @id @default(autoincrement())
  object_exists                Boolean
  created_at                   DateTime                     @db.Timestamptz(6)
  annotation_id                Int                          @unique
  storage_id                   Int
  updated_at                   DateTime                     @db.Timestamptz(6)
  task_completion              task_completion              @relation(fields: [annotation_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "io_storages_gcsexpor_annotation_id_2df715a6_fk_task_comp")
  io_storages_gcsexportstorage io_storages_gcsexportstorage @relation(fields: [storage_id], references: [gcsstoragemixin_ptr_id], onDelete: NoAction, onUpdate: NoAction, map: "io_storages_gcsexpor_storage_id_e940a32d_fk_io_storag")

  @@index([annotation_id], map: "io_storages_gcsexportstoragelink_annotation_id_2df715a6")
  @@index([storage_id], map: "io_storages_gcsexportstoragelink_storage_id_e940a32d")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model has constraints using non-default deferring rules and requires additional setup for migrations. Visit https://pris.ly/d/constraint-deferring for more info.
model io_storages_gcsimportstorage {
  gcsstoragemixin_ptr_id           Int                                @id
  title                            String?                            @db.VarChar(256)
  description                      String?
  created_at                       DateTime                           @db.Timestamptz(6)
  presign                          Boolean
  presign_ttl                      Int                                @db.SmallInt
  project_id                       Int
  last_sync                        DateTime?                          @db.Timestamptz(6)
  last_sync_count                  Int?
  last_sync_job                    String?                            @db.VarChar(256)
  meta                             Json?
  status                           String                             @db.VarChar(64)
  traceback                        String?
  synchronizable                   Boolean
  recursive_scan                   Boolean?                           @default(false)
  io_storages_gcsstoragemixin      io_storages_gcsstoragemixin        @relation(fields: [gcsstoragemixin_ptr_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "io_storages_gcsimpor_gcsstoragemixin_ptr__10604ed3_fk_io_storag")
  project                          project                            @relation(fields: [project_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "io_storages_gcsimportstorage_project_id_dfb68296_fk_project_id")
  io_storages_gcsimportstoragelink io_storages_gcsimportstoragelink[]

  @@index([project_id], map: "io_storages_gcsimportstorage_project_id_dfb68296")
}

/// This model has constraints using non-default deferring rules and requires additional setup for migrations. Visit https://pris.ly/d/constraint-deferring for more info.
model io_storages_gcsimportstoragelink {
  id                           Int                          @id @default(autoincrement())
  key                          String
  object_exists                Boolean
  created_at                   DateTime                     @db.Timestamptz(6)
  task_id                      Int                          @unique
  storage_id                   Int
  row_group                    Int?
  row_index                    Int?
  io_storages_gcsimportstorage io_storages_gcsimportstorage @relation(fields: [storage_id], references: [gcsstoragemixin_ptr_id], onDelete: NoAction, onUpdate: NoAction, map: "io_storages_gcsimpor_storage_id_f3037a96_fk_io_storag")
  task                         task                         @relation(fields: [task_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "io_storages_gcsimportstoragelink_task_id_3bedcb9b_fk_task_id")

  @@index([storage_id], map: "io_storages_gcsimportstoragelink_storage_id_f3037a96")
}

model io_storages_gcsstoragemixin {
  id                             Int                           @id @default(autoincrement())
  bucket                         String?
  prefix                         String?
  regex_filter                   String?
  use_blob_urls                  Boolean
  google_application_credentials String?
  google_project_id              String?
  io_storages_gcsexportstorage   io_storages_gcsexportstorage?
  io_storages_gcsimportstorage   io_storages_gcsimportstorage?
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model has constraints using non-default deferring rules and requires additional setup for migrations. Visit https://pris.ly/d/constraint-deferring for more info.
model io_storages_localfilesexportstorage {
  localfilesmixin_ptr_id                  Int                                       @id
  title                                   String?                                   @db.VarChar(256)
  description                             String?
  created_at                              DateTime                                  @db.Timestamptz(6)
  last_sync                               DateTime?                                 @db.Timestamptz(6)
  last_sync_count                         Int?
  project_id                              Int
  can_delete_objects                      Boolean?
  last_sync_job                           String?                                   @db.VarChar(256)
  meta                                    Json?
  status                                  String                                    @db.VarChar(64)
  traceback                               String?
  synchronizable                          Boolean
  io_storages_localfilesmixin             io_storages_localfilesmixin               @relation(fields: [localfilesmixin_ptr_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "io_storages_localfil_localfilesmixin_ptr__f0b19499_fk_io_storag")
  project                                 project                                   @relation(fields: [project_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "io_storages_localfil_project_id_35dd9dc7_fk_project_i")
  io_storages_localfilesexportstoragelink io_storages_localfilesexportstoragelink[]

  @@index([project_id], map: "io_storages_localfilesexportstorage_project_id_35dd9dc7")
}

/// This model has constraints using non-default deferring rules and requires additional setup for migrations. Visit https://pris.ly/d/constraint-deferring for more info.
model io_storages_localfilesexportstoragelink {
  id                                  Int                                 @id @default(autoincrement())
  object_exists                       Boolean
  created_at                          DateTime                            @db.Timestamptz(6)
  annotation_id                       Int                                 @unique
  storage_id                          Int
  updated_at                          DateTime                            @db.Timestamptz(6)
  task_completion                     task_completion                     @relation(fields: [annotation_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "io_storages_localfil_annotation_id_fc4f9825_fk_task_comp")
  io_storages_localfilesexportstorage io_storages_localfilesexportstorage @relation(fields: [storage_id], references: [localfilesmixin_ptr_id], onDelete: NoAction, onUpdate: NoAction, map: "io_storages_localfil_storage_id_87392e7a_fk_io_storag")

  @@index([annotation_id], map: "io_storages_localfilesexportstoragelink_annotation_id_fc4f9825")
  @@index([storage_id], map: "io_storages_localfilesexportstoragelink_storage_id_87392e7a")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model has constraints using non-default deferring rules and requires additional setup for migrations. Visit https://pris.ly/d/constraint-deferring for more info.
model io_storages_localfilesimportstorage {
  localfilesmixin_ptr_id                  Int                                       @id
  title                                   String?                                   @db.VarChar(256)
  description                             String?
  created_at                              DateTime                                  @db.Timestamptz(6)
  last_sync                               DateTime?                                 @db.Timestamptz(6)
  last_sync_count                         Int?
  project_id                              Int
  last_sync_job                           String?                                   @db.VarChar(256)
  meta                                    Json?
  status                                  String                                    @db.VarChar(64)
  traceback                               String?
  synchronizable                          Boolean
  recursive_scan                          Boolean?                                  @default(false)
  io_storages_localfilesmixin             io_storages_localfilesmixin               @relation(fields: [localfilesmixin_ptr_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "io_storages_localfil_localfilesmixin_ptr__fb0a0be4_fk_io_storag")
  project                                 project                                   @relation(fields: [project_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "io_storages_localfil_project_id_9ae1d2c5_fk_project_i")
  io_storages_localfilesimportstoragelink io_storages_localfilesimportstoragelink[]

  @@index([project_id], map: "io_storages_localfilesimportstorage_project_id_9ae1d2c5")
}

/// This model has constraints using non-default deferring rules and requires additional setup for migrations. Visit https://pris.ly/d/constraint-deferring for more info.
model io_storages_localfilesimportstoragelink {
  id                                  Int                                 @id @default(autoincrement())
  key                                 String
  object_exists                       Boolean
  created_at                          DateTime                            @db.Timestamptz(6)
  task_id                             Int                                 @unique
  storage_id                          Int
  row_group                           Int?
  row_index                           Int?
  io_storages_localfilesimportstorage io_storages_localfilesimportstorage @relation(fields: [storage_id], references: [localfilesmixin_ptr_id], onDelete: NoAction, onUpdate: NoAction, map: "io_storages_localfil_storage_id_59a5663c_fk_io_storag")
  task                                task                                @relation(fields: [task_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "io_storages_localblob_task_id_d0e8315f_fk_task_id")

  @@index([storage_id], map: "io_storages_localfilesimportstoragelink_storage_id_59a5663c")
}

model io_storages_localfilesmixin {
  id                                  Int                                  @id @default(autoincrement())
  path                                String?
  regex_filter                        String?
  use_blob_urls                       Boolean
  io_storages_localfilesexportstorage io_storages_localfilesexportstorage?
  io_storages_localfilesimportstorage io_storages_localfilesimportstorage?
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model has constraints using non-default deferring rules and requires additional setup for migrations. Visit https://pris.ly/d/constraint-deferring for more info.
model io_storages_redisexportstorage {
  redisstoragemixin_ptr_id           Int                                  @id
  title                              String?                              @db.VarChar(256)
  description                        String?
  created_at                         DateTime                             @db.Timestamptz(6)
  db                                 Int                                  @db.SmallInt
  project_id                         Int
  last_sync                          DateTime?                            @db.Timestamptz(6)
  last_sync_count                    Int?
  can_delete_objects                 Boolean?
  last_sync_job                      String?                              @db.VarChar(256)
  meta                               Json?
  status                             String                               @db.VarChar(64)
  traceback                          String?
  synchronizable                     Boolean
  project                            project                              @relation(fields: [project_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "io_storages_redisexp_project_id_12a2546c_fk_project_i")
  io_storages_redisstoragemixin      io_storages_redisstoragemixin        @relation(fields: [redisstoragemixin_ptr_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "io_storages_redisexp_redisstoragemixin_pt_d1c2d337_fk_io_storag")
  io_storages_redisexportstoragelink io_storages_redisexportstoragelink[]

  @@index([project_id], map: "io_storages_redisexportstorage_project_id_12a2546c")
}

/// This model has constraints using non-default deferring rules and requires additional setup for migrations. Visit https://pris.ly/d/constraint-deferring for more info.
model io_storages_redisexportstoragelink {
  id                             Int                            @id @default(autoincrement())
  object_exists                  Boolean
  created_at                     DateTime                       @db.Timestamptz(6)
  annotation_id                  Int                            @unique
  storage_id                     Int
  updated_at                     DateTime                       @db.Timestamptz(6)
  task_completion                task_completion                @relation(fields: [annotation_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "io_storages_redisexp_annotation_id_8547e508_fk_task_comp")
  io_storages_redisexportstorage io_storages_redisexportstorage @relation(fields: [storage_id], references: [redisstoragemixin_ptr_id], onDelete: NoAction, onUpdate: NoAction, map: "io_storages_redisexp_storage_id_807898d8_fk_io_storag")

  @@index([annotation_id], map: "io_storages_redisexportstoragelink_annotation_id_8547e508")
  @@index([storage_id], map: "io_storages_redisexportstoragelink_storage_id_807898d8")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model has constraints using non-default deferring rules and requires additional setup for migrations. Visit https://pris.ly/d/constraint-deferring for more info.
model io_storages_redisimportstorage {
  redisstoragemixin_ptr_id           Int                                  @id
  title                              String?                              @db.VarChar(256)
  description                        String?
  created_at                         DateTime                             @db.Timestamptz(6)
  db                                 Int                                  @db.SmallInt
  project_id                         Int
  last_sync                          DateTime?                            @db.Timestamptz(6)
  last_sync_count                    Int?
  last_sync_job                      String?                              @db.VarChar(256)
  meta                               Json?
  status                             String                               @db.VarChar(64)
  traceback                          String?
  synchronizable                     Boolean
  project                            project                              @relation(fields: [project_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "io_storages_redisimp_project_id_c7b9adc0_fk_project_i")
  io_storages_redisstoragemixin      io_storages_redisstoragemixin        @relation(fields: [redisstoragemixin_ptr_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "io_storages_redisimp_redisstoragemixin_pt_73982db6_fk_io_storag")
  io_storages_redisimportstoragelink io_storages_redisimportstoragelink[]

  @@index([project_id], map: "io_storages_redisimportstorage_project_id_c7b9adc0")
}

/// This model has constraints using non-default deferring rules and requires additional setup for migrations. Visit https://pris.ly/d/constraint-deferring for more info.
model io_storages_redisimportstoragelink {
  id                             Int                            @id @default(autoincrement())
  key                            String
  object_exists                  Boolean
  created_at                     DateTime                       @db.Timestamptz(6)
  task_id                        Int                            @unique
  storage_id                     Int
  row_group                      Int?
  row_index                      Int?
  io_storages_redisimportstorage io_storages_redisimportstorage @relation(fields: [storage_id], references: [redisstoragemixin_ptr_id], onDelete: NoAction, onUpdate: NoAction, map: "io_storages_redisimp_storage_id_17124de8_fk_io_storag")
  task                           task                           @relation(fields: [task_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "io_storages_redisimportstoragelink_task_id_6730b8ad_fk_task_id")

  @@index([storage_id], map: "io_storages_redisimportstoragelink_storage_id_17124de8")
}

model io_storages_redisstoragemixin {
  id                             Int                             @id @default(autoincrement())
  path                           String?
  host                           String?
  port                           String?
  password                       String?
  regex_filter                   String?
  use_blob_urls                  Boolean
  io_storages_redisexportstorage io_storages_redisexportstorage?
  io_storages_redisimportstorage io_storages_redisimportstorage?
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model has constraints using non-default deferring rules and requires additional setup for migrations. Visit https://pris.ly/d/constraint-deferring for more info.
model io_storages_s3exportstorage {
  id                              Int                               @id @default(autoincrement())
  title                           String?                           @db.VarChar(256)
  description                     String?
  created_at                      DateTime                          @db.Timestamptz(6)
  bucket                          String?
  prefix                          String?
  regex_filter                    String?
  use_blob_urls                   Boolean
  aws_access_key_id               String?
  aws_secret_access_key           String?
  aws_session_token               String?
  region_name                     String?
  s3_endpoint                     String?
  project_id                      Int
  last_sync                       DateTime?                         @db.Timestamptz(6)
  last_sync_count                 Int?
  can_delete_objects              Boolean?
  last_sync_job                   String?                           @db.VarChar(256)
  meta                            Json?
  status                          String                            @db.VarChar(64)
  traceback                       String?
  synchronizable                  Boolean
  aws_sse_kms_key_id              String?
  project                         project                           @relation(fields: [project_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "io_storages_s3exportstorage_project_id_5e76add6_fk_project_id")
  io_storages_s3exportstoragelink io_storages_s3exportstoragelink[]

  @@index([project_id], map: "io_storages_s3exportstorage_project_id_5e76add6")
}

/// This model has constraints using non-default deferring rules and requires additional setup for migrations. Visit https://pris.ly/d/constraint-deferring for more info.
model io_storages_s3exportstoragelink {
  id                          Int                         @id @default(autoincrement())
  object_exists               Boolean
  created_at                  DateTime                    @db.Timestamptz(6)
  annotation_id               Int                         @unique
  storage_id                  Int
  updated_at                  DateTime                    @db.Timestamptz(6)
  task_completion             task_completion             @relation(fields: [annotation_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "io_storages_s3export_annotation_id_729994fe_fk_task_comp")
  io_storages_s3exportstorage io_storages_s3exportstorage @relation(fields: [storage_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "io_storages_s3export_storage_id_a4563d13_fk_io_storag")

  @@index([annotation_id], map: "io_storages_s3exportstoragelink_annotation_id_729994fe")
  @@index([storage_id], map: "io_storages_s3exportstoragelink_storage_id_a4563d13")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model has constraints using non-default deferring rules and requires additional setup for migrations. Visit https://pris.ly/d/constraint-deferring for more info.
model io_storages_s3importstorage {
  id                              Int                               @id @default(autoincrement())
  title                           String?                           @db.VarChar(256)
  description                     String?
  created_at                      DateTime                          @db.Timestamptz(6)
  bucket                          String?
  prefix                          String?
  regex_filter                    String?
  use_blob_urls                   Boolean
  aws_access_key_id               String?
  aws_secret_access_key           String?
  aws_session_token               String?
  region_name                     String?
  s3_endpoint                     String?
  presign                         Boolean
  presign_ttl                     Int                               @db.SmallInt
  project_id                      Int
  last_sync                       DateTime?                         @db.Timestamptz(6)
  last_sync_count                 Int?
  recursive_scan                  Boolean
  last_sync_job                   String?                           @db.VarChar(256)
  meta                            Json?
  status                          String                            @db.VarChar(64)
  traceback                       String?
  synchronizable                  Boolean
  aws_sse_kms_key_id              String?
  project                         project                           @relation(fields: [project_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "io_storages_s3importstorage_project_id_dee63a8d_fk_project_id")
  io_storages_s3importstoragelink io_storages_s3importstoragelink[]

  @@index([project_id], map: "io_storages_s3importstorage_project_id_dee63a8d")
}

/// This model has constraints using non-default deferring rules and requires additional setup for migrations. Visit https://pris.ly/d/constraint-deferring for more info.
model io_storages_s3importstoragelink {
  id                          Int                         @id @default(autoincrement())
  key                         String
  object_exists               Boolean
  created_at                  DateTime                    @db.Timestamptz(6)
  storage_id                  Int
  task_id                     Int                         @unique
  row_group                   Int?
  row_index                   Int?
  io_storages_s3importstorage io_storages_s3importstorage @relation(fields: [storage_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "io_storages_s3import_storage_id_50ca5bd8_fk_io_storag")
  task                        task                        @relation(fields: [task_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "io_storages_s3importstoragelink_task_id_126f4f82_fk_task_id")

  @@index([storage_id], map: "io_storages_s3importstoragelink_storage_id_50ca5bd8")
}

/// This model has constraints using non-default deferring rules and requires additional setup for migrations. Visit https://pris.ly/d/constraint-deferring for more info.
model jwt_auth_jwtsettings {
  organization_id           Int          @id
  api_tokens_enabled        Boolean
  api_token_ttl_days        Int
  legacy_api_tokens_enabled Boolean
  created_at                DateTime     @db.Timestamptz(6)
  updated_at                DateTime     @db.Timestamptz(6)
  organization              organization @relation(fields: [organization_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "jwt_auth_jwtsettings_organization_id_1e76aa12_fk_organizat")
}

/// This model has constraints using non-default deferring rules and requires additional setup for migrations. Visit https://pris.ly/d/constraint-deferring for more info.
model labels_manager_label {
  id                                                     Int                        @id @default(autoincrement())
  created_at                                             DateTime                   @db.Timestamptz(6)
  updated_at                                             DateTime                   @db.Timestamptz(6)
  value                                                  Json
  title                                                  String                     @db.VarChar(2048)
  description                                            String?
  approved                                               Boolean
  approved_by_id                                         Int?
  created_by_id                                          Int
  organization_id                                        Int
  htx_user_labels_manager_label_approved_by_idTohtx_user htx_user?                  @relation("labels_manager_label_approved_by_idTohtx_user", fields: [approved_by_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "labels_manager_label_approved_by_id_4b6a871f_fk_htx_user_id")
  htx_user_labels_manager_label_created_by_idTohtx_user  htx_user                   @relation("labels_manager_label_created_by_idTohtx_user", fields: [created_by_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "labels_manager_label_created_by_id_e3b3e785_fk_htx_user_id")
  organization                                           organization               @relation(fields: [organization_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "labels_manager_label_organization_id_5f714874_fk_organizat")
  labels_manager_labellink                               labels_manager_labellink[]

  @@unique([title, organization_id], map: "unique_title")
  @@index([approved_by_id], map: "labels_manager_label_approved_by_id_4b6a871f")
  @@index([created_by_id], map: "labels_manager_label_created_by_id_e3b3e785")
  @@index([organization_id], map: "labels_manager_label_organization_id_5f714874")
}

/// This model has constraints using non-default deferring rules and requires additional setup for migrations. Visit https://pris.ly/d/constraint-deferring for more info.
model labels_manager_labellink {
  id                   Int                  @id @default(autoincrement())
  from_name            String               @db.VarChar(2048)
  label_id             Int
  project_id           Int
  labels_manager_label labels_manager_label @relation(fields: [label_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "labels_manager_label_label_id_c8afbfa4_fk_labels_ma")
  project              project              @relation(fields: [project_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "labels_manager_labellink_project_id_e3d33738_fk_project_id")

  @@unique([project_id, label_id], map: "unique_label_project")
  @@index([label_id], map: "labels_manager_labellink_label_id_c8afbfa4")
  @@index([project_id], map: "labels_manager_labellink_project_id_e3d33738")
}

/// This model has constraints using non-default deferring rules and requires additional setup for migrations. Visit https://pris.ly/d/constraint-deferring for more info.
model ml_mlbackend {
  id                        Int                         @id @default(autoincrement())
  state                     String                      @db.VarChar(2)
  url                       String
  error_message             String?
  title                     String?
  description               String?
  model_version             String?
  created_at                DateTime                    @db.Timestamptz(6)
  updated_at                DateTime                    @db.Timestamptz(6)
  project_id                Int
  is_interactive            Boolean
  timeout                   Float
  auto_update               Boolean
  auth_method               String                      @db.VarChar(255)
  basic_auth_pass           String?
  basic_auth_user           String?
  extra_params              Json?
  project                   project                     @relation(fields: [project_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "ml_mlbackend_project_id_ca08142d_fk_project_id")
  ml_mlbackendpredictionjob ml_mlbackendpredictionjob[]
  ml_mlbackendtrainjob      ml_mlbackendtrainjob[]
  prediction                prediction[]
  tasks_failedprediction    tasks_failedprediction[]

  @@index([project_id], map: "ml_mlbackend_project_id_ca08142d")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model has constraints using non-default deferring rules and requires additional setup for migrations. Visit https://pris.ly/d/constraint-deferring for more info.
model ml_mlbackendpredictionjob {
  id            Int          @id @default(autoincrement())
  job_id        String       @db.VarChar(128)
  model_version String?
  batch_size    Int          @db.SmallInt
  created_at    DateTime     @db.Timestamptz(6)
  updated_at    DateTime     @db.Timestamptz(6)
  ml_backend_id Int
  ml_mlbackend  ml_mlbackend @relation(fields: [ml_backend_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "ml_mlbackendpredicti_ml_backend_id_c1aea4f1_fk_ml_mlback")

  @@index([ml_backend_id], map: "ml_mlbackendpredictionjob_ml_backend_id_c1aea4f1")
}

/// This model has constraints using non-default deferring rules and requires additional setup for migrations. Visit https://pris.ly/d/constraint-deferring for more info.
model ml_mlbackendtrainjob {
  id            Int          @id @default(autoincrement())
  job_id        String       @db.VarChar(128)
  model_version String?
  created_at    DateTime     @db.Timestamptz(6)
  updated_at    DateTime     @db.Timestamptz(6)
  ml_backend_id Int
  ml_mlbackend  ml_mlbackend @relation(fields: [ml_backend_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "ml_mlbackendtrainjob_ml_backend_id_3d40686e_fk_ml_mlbackend_id")

  @@index([ml_backend_id], map: "ml_mlbackendtrainjob_ml_backend_id_3d40686e")
}

/// This model has constraints using non-default deferring rules and requires additional setup for migrations. Visit https://pris.ly/d/constraint-deferring for more info.
model ml_model_providers_modelproviderconnection {
  id                               Int                                @id @default(autoincrement())
  provider                         String                             @db.VarChar(255)
  api_key                          String?
  scope                            String                             @db.VarChar(255)
  created_at                       DateTime                           @db.Timestamptz(6)
  updated_at                       DateTime                           @db.Timestamptz(6)
  created_by_id                    Int?
  organization_id                  Int?
  deployment_name                  String?                            @db.VarChar(512)
  endpoint                         String?                            @db.VarChar(512)
  cached_available_models          String?                            @db.VarChar(4096)
  auth_token                       String?
  budget_alert_threshold           Float?
  budget_last_reset_date           DateTime?                          @db.Timestamptz(6)
  budget_limit                     Float?
  budget_reset_period              String?                            @db.VarChar(20)
  budget_total_spent               Float?
  is_internal                      Boolean?
  google_application_credentials   String?
  google_location                  String?                            @db.VarChar(255)
  google_project_id                String?                            @db.VarChar(255)
  htx_user                         htx_user?                          @relation(fields: [created_by_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "ml_model_providers_m_created_by_id_2e24aab7_fk_htx_user_")
  organization                     organization?                      @relation(fields: [organization_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "ml_model_providers_m_organization_id_ef7f6136_fk_organizat")
  ml_models_thirdpartymodelversion ml_models_thirdpartymodelversion[]

  @@index([created_by_id], map: "ml_model_providers_modelpr_created_by_id_2e24aab7")
  @@index([organization_id], map: "ml_model_providers_modelpr_organization_id_ef7f6136")
}

/// This model has constraints using non-default deferring rules and requires additional setup for migrations. Visit https://pris.ly/d/constraint-deferring for more info.
model ml_models_modelinterface {
  id                                           Int                                            @id @default(autoincrement())
  title                                        String                                         @db.VarChar(500)
  description                                  String?
  created_at                                   DateTime                                       @db.Timestamptz(6)
  updated_at                                   DateTime                                       @db.Timestamptz(6)
  created_by_id                                Int?
  organization_id                              Int?
  input_fields                                 Json
  output_classes                               Json
  skill_name                                   String?                                        @db.VarChar(255)
  organization                                 organization?                                  @relation(fields: [organization_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "ml_models_modelinter_organization_id_d5688149_fk_organizat")
  htx_user                                     htx_user?                                      @relation(fields: [created_by_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "ml_models_modelinterface_created_by_id_8ba717c0_fk_htx_user_id")
  ml_models_modelinterface_associated_projects ml_models_modelinterface_associated_projects[]
  ml_models_thirdpartymodelversion             ml_models_thirdpartymodelversion[]

  @@index([created_by_id], map: "ml_models_modelinterface_created_by_id_8ba717c0")
  @@index([organization_id], map: "ml_models_modelinterface_organization_id_d5688149")
}

/// This model has constraints using non-default deferring rules and requires additional setup for migrations. Visit https://pris.ly/d/constraint-deferring for more info.
model ml_models_modelinterface_associated_projects {
  id                       Int                      @id @default(autoincrement())
  modelinterface_id        Int
  project_id               Int
  ml_models_modelinterface ml_models_modelinterface @relation(fields: [modelinterface_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "ml_models_modelinter_modelinterface_id_035df3df_fk_ml_models")
  project                  project                  @relation(fields: [project_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "ml_models_modelinter_project_id_76a17855_fk_project_i")

  @@unique([modelinterface_id, project_id], map: "ml_models_modelinterface_modelinterface_id_projec_4278f3da_uniq")
  @@index([modelinterface_id], map: "ml_models_modelinterface_a_modelinterface_id_035df3df")
  @@index([project_id], map: "ml_models_modelinterface_a_project_id_76a17855")
}

/// This model has constraints using non-default deferring rules and requires additional setup for migrations. Visit https://pris.ly/d/constraint-deferring for more info.
model ml_models_modelrun {
  id                               Int                              @id @default(autoincrement())
  project_subset                   String                           @db.VarChar(255)
  status                           String                           @db.VarChar(255)
  created_at                       DateTime                         @db.Timestamptz(6)
  triggered_at                     DateTime?                        @db.Timestamptz(6)
  completed_at                     DateTime?                        @db.Timestamptz(6)
  created_by_id                    Int?
  model_version_id                 Int
  organization_id                  Int?
  project_id                       Int
  job_id                           String?                          @db.VarChar(255)
  predictions_updated_at           DateTime?                        @db.Timestamptz(6)
  total_correct_predictions        Int
  total_predictions                Int
  total_tasks                      Int
  htx_user                         htx_user?                        @relation(fields: [created_by_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "ml_models_modelrun_created_by_id_1a302218_fk_htx_user_id")
  ml_models_thirdpartymodelversion ml_models_thirdpartymodelversion @relation(fields: [model_version_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "ml_models_modelrun_model_version_id_e15572eb_fk_ml_models")
  organization                     organization?                    @relation(fields: [organization_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "ml_models_modelrun_organization_id_1f7f8243_fk_organization_id")
  project                          project                          @relation(fields: [project_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "ml_models_modelrun_project_id_1b76ea76_fk_project_id")
  prediction                       prediction[]
  tasks_failedprediction           tasks_failedprediction[]

  @@index([created_by_id], map: "ml_models_modelrun_created_by_id_1a302218")
  @@index([model_version_id], map: "ml_models_modelrun_model_version_id_e15572eb")
  @@index([organization_id], map: "ml_models_modelrun_organization_id_1f7f8243")
  @@index([project_id], map: "ml_models_modelrun_project_id_1b76ea76")
}

/// This model has constraints using non-default deferring rules and requires additional setup for migrations. Visit https://pris.ly/d/constraint-deferring for more info.
model ml_models_thirdpartymodelversion {
  id                                         Int                                         @id @default(autoincrement())
  title                                      String                                      @db.VarChar(500)
  prompt                                     String
  provider                                   String                                      @db.VarChar(255)
  provider_model_id                          String                                      @db.VarChar(255)
  created_at                                 DateTime                                    @db.Timestamptz(6)
  updated_at                                 DateTime                                    @db.Timestamptz(6)
  created_by_id                              Int?
  organization_id                            Int?
  parent_model_id                            Int
  model_provider_connection_id               Int?
  ml_models_modelrun                         ml_models_modelrun[]
  htx_user                                   htx_user?                                   @relation(fields: [created_by_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "ml_models_thirdparty_created_by_id_b1fb2c2f_fk_htx_user_")
  ml_model_providers_modelproviderconnection ml_model_providers_modelproviderconnection? @relation(fields: [model_provider_connection_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "ml_models_thirdparty_model_provider_conne_b98c173f_fk_ml_model_")
  organization                               organization?                               @relation(fields: [organization_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "ml_models_thirdparty_organization_id_a4a5df4d_fk_organizat")
  ml_models_modelinterface                   ml_models_modelinterface                    @relation(fields: [parent_model_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "ml_models_thirdparty_parent_model_id_599e1869_fk_ml_models")

  @@index([model_provider_connection_id], map: "ml_models_thirdpartymodelv_model_provider_connection__b98c173f")
  @@index([created_by_id], map: "ml_models_thirdpartymodelversion_created_by_id_b1fb2c2f")
  @@index([organization_id], map: "ml_models_thirdpartymodelversion_organization_id_a4a5df4d")
  @@index([parent_model_id], map: "ml_models_thirdpartymodelversion_parent_model_id_599e1869")
}

/// This model has constraints using non-default deferring rules and requires additional setup for migrations. Visit https://pris.ly/d/constraint-deferring for more info.
model organization {
  id                                                     Int                                          @id @default(autoincrement())
  title                                                  String                                       @db.VarChar(1000)
  created_at                                             DateTime                                     @db.Timestamptz(6)
  updated_at                                             DateTime                                     @db.Timestamptz(6)
  created_by_id                                          Int?                                         @unique
  token                                                  String?                                      @unique @db.VarChar(256)
  contact_info                                           String?                                      @db.VarChar(254)
  data_export_convertedformat                            data_export_convertedformat[]
  htx_user_htx_user_active_organization_idToorganization htx_user[]                                   @relation("htx_user_active_organization_idToorganization")
  jwt_auth_jwtsettings                                   jwt_auth_jwtsettings?
  labels_manager_label                                   labels_manager_label[]
  ml_model_providers_modelproviderconnection             ml_model_providers_modelproviderconnection[]
  ml_models_modelinterface                               ml_models_modelinterface[]
  ml_models_modelrun                                     ml_models_modelrun[]
  ml_models_thirdpartymodelversion                       ml_models_thirdpartymodelversion[]
  htx_user_organization_created_by_idTohtx_user          htx_user?                                    @relation("organization_created_by_idTohtx_user", fields: [created_by_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "organization_created_by_id_35551e36_fk_htx_user_id")
  organizations_organizationmember                       organizations_organizationmember[]
  project                                                project[]
  session_policy_sessiontimeoutpolicy                    session_policy_sessiontimeoutpolicy?
  webhook                                                webhook[]

  @@index([token], map: "organization_token_5bd2529a_like")
}

/// This model has constraints using non-default deferring rules and requires additional setup for migrations. Visit https://pris.ly/d/constraint-deferring for more info.
model organizations_organizationmember {
  id              Int          @id @default(autoincrement())
  created_at      DateTime     @db.Timestamptz(6)
  updated_at      DateTime     @db.Timestamptz(6)
  organization_id Int
  user_id         Int
  deleted_at      DateTime?    @db.Timestamptz(6)
  organization    organization @relation(fields: [organization_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "organizations_organi_organization_id_f26cf71b_fk_organizat")
  htx_user        htx_user     @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "organizations_organi_user_id_f3845ee5_fk_htx_user_")

  @@index([deleted_at], map: "organizations_organizationmember_deleted_at_af2d5523")
  @@index([organization_id], map: "organizations_organizationmember_organization_id_f26cf71b")
  @@index([user_id], map: "organizations_organizationmember_user_id_f3845ee5")
}

/// This model has constraints using non-default deferring rules and requires additional setup for migrations. Visit https://pris.ly/d/constraint-deferring for more info.
/// This model contains an expression index which requires additional setup for migrations. Visit https://pris.ly/d/expression-indexes for more info.
model prediction {
  id                 Int                 @id @default(autoincrement())
  result             Json?
  score              Float?
  model_version      String?
  created_at         DateTime            @db.Timestamptz(6)
  updated_at         DateTime            @db.Timestamptz(6)
  task_id            Int
  cluster            Int?
  neighbors          Json?
  mislabeling        Float
  project_id         Int?
  model_run_id       Int?
  model_id           Int?
  ml_mlbackend       ml_mlbackend?       @relation(fields: [model_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "prediction_model_id_f9d54ad0_fk_ml_mlbackend_id")
  ml_models_modelrun ml_models_modelrun? @relation(fields: [model_run_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "prediction_model_run_id_9d95621b_fk_ml_models_modelrun_id")
  project            project?            @relation(fields: [project_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "prediction_project_id_ec1ad819_fk_project_id")
  task               task                @relation(fields: [task_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "prediction_task_id_4e4fb4d3_fk_task_id")
  prediction_meta    prediction_meta?
  task_completion    task_completion[]

  @@index([model_id], map: "prediction_model_id_f9d54ad0")
  @@index([model_run_id], map: "prediction_model_run_id_9d95621b")
  @@index([project_id], map: "prediction_project_id_ec1ad819")
  @@index([task_id], map: "prediction_task_id_4e4fb4d3")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model has constraints using non-default deferring rules and requires additional setup for migrations. Visit https://pris.ly/d/constraint-deferring for more info.
model prediction_meta {
  id                      Int                     @id @default(autoincrement())
  inference_time          Float?
  prompt_tokens_count     Int?
  completion_tokens_count Int?
  total_tokens_count      Int?
  prompt_cost             Float?
  completion_cost         Float?
  total_cost              Float?
  extra                   Json?
  failed_prediction_id    Int?                    @unique
  prediction_id           Int?                    @unique
  tasks_failedprediction  tasks_failedprediction? @relation(fields: [failed_prediction_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "prediction_meta_failed_prediction_id_082536d6_fk_tasks_fai")
  prediction              prediction?             @relation(fields: [prediction_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "prediction_meta_prediction_id_c33b5954_fk_prediction_id")
}

/// This model has constraints using non-default deferring rules and requires additional setup for migrations. Visit https://pris.ly/d/constraint-deferring for more info.
model project {
  id                                           Int                                            @id @default(autoincrement())
  title                                        String?                                        @db.VarChar(50)
  label_config                                 String?
  expert_instruction                           String?
  show_instruction                             Boolean
  maximum_annotations                          Int
  model_version                                String?
  data_types                                   Json?
  is_published                                 Boolean
  created_at                                   DateTime                                       @db.Timestamptz(6)
  updated_at                                   DateTime                                       @db.Timestamptz(6)
  created_by_id                                Int?
  show_skip_button                             Boolean
  enable_empty_annotation                      Boolean
  min_annotations_to_start_training            Int
  show_annotation_history                      Boolean
  show_collab_predictions                      Boolean
  show_ground_truth_first                      Boolean
  sampling                                     String?                                        @db.VarChar(100)
  task_data_login                              String?                                        @db.VarChar(256)
  task_data_password                           String?                                        @db.VarChar(256)
  overlap_cohort_percentage                    Int
  show_overlap_first                           Boolean
  control_weights                              Json?
  token                                        String?                                        @db.VarChar(256)
  result_count                                 Int
  organization_id                              Int?
  is_draft                                     Boolean
  description                                  String?
  color                                        String?                                        @db.VarChar(16)
  evaluate_predictions_automatically           Boolean
  reveal_preannotations_interactively          Boolean
  skip_queue                                   String?                                        @db.VarChar(100)
  parsed_label_config                          Json?
  pinned_at                                    DateTime?                                      @db.Timestamptz(6)
  label_config_hash                            BigInt?
  custom_task_lock_ttl                         Int?
  search_vector                                Unsupported("tsvector")?                       @default(dbgenerated("((setweight(to_tsvector('english'::regconfig, COALESCE((id)::text, ''::text)), 'A'::\"char\") || setweight(to_tsvector('english'::regconfig, (COALESCE(title, ''::character varying))::text), 'B'::\"char\")) || setweight(to_tsvector('english'::regconfig, COALESCE(\"substring\"(description, 1, 250000), ''::text)), 'C'::\"char\"))"))
  core_asyncmigrationstatus                    core_asyncmigrationstatus[]
  data_export_convertedformat                  data_export_convertedformat[]
  data_export_export                           data_export_export[]
  data_import_fileupload                       data_import_fileupload[]
  data_manager_view                            data_manager_view[]
  io_storages_azureblobexportstorage           io_storages_azureblobexportstorage[]
  io_storages_azureblobimportstorage           io_storages_azureblobimportstorage[]
  io_storages_gcsexportstorage                 io_storages_gcsexportstorage[]
  io_storages_gcsimportstorage                 io_storages_gcsimportstorage[]
  io_storages_localfilesexportstorage          io_storages_localfilesexportstorage[]
  io_storages_localfilesimportstorage          io_storages_localfilesimportstorage[]
  io_storages_redisexportstorage               io_storages_redisexportstorage[]
  io_storages_redisimportstorage               io_storages_redisimportstorage[]
  io_storages_s3exportstorage                  io_storages_s3exportstorage[]
  io_storages_s3importstorage                  io_storages_s3importstorage[]
  labels_manager_labellink                     labels_manager_labellink[]
  ml_mlbackend                                 ml_mlbackend[]
  ml_models_modelinterface_associated_projects ml_models_modelinterface_associated_projects[]
  ml_models_modelrun                           ml_models_modelrun[]
  prediction                                   prediction[]
  htx_user                                     htx_user?                                      @relation(fields: [created_by_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "project_created_by_id_6cc13408_fk_htx_user_id")
  organization                                 organization?                                  @relation(fields: [organization_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "project_organization_id_3c9f74fb_fk_organization_id")
  projects_labelstreamhistory                  projects_labelstreamhistory[]
  projects_projectimport                       projects_projectimport[]
  projects_projectmember                       projects_projectmember[]
  projects_projectonboarding                   projects_projectonboarding[]
  projects_projectreimport                     projects_projectreimport[]
  projects_projectsummary                      projects_projectsummary?
  task                                         task[]
  task_completion                              task_completion[]
  tasks_failedprediction                       tasks_failedprediction[]
  webhook                                      webhook[]

  @@index([created_by_id], map: "project_created_by_id_6cc13408")
  @@index([organization_id], map: "project_organization_id_3c9f74fb")
  @@index([pinned_at, created_at], map: "project_pinned__a39ccb_idx")
  @@index([search_vector], type: Gin)
}

/// This model has constraints using non-default deferring rules and requires additional setup for migrations. Visit https://pris.ly/d/constraint-deferring for more info.
model projects_labelstreamhistory {
  id         Int      @id @default(autoincrement())
  data       Json
  project_id Int
  user_id    Int
  project    project  @relation(fields: [project_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "projects_labelstreamhistory_project_id_906c91dd_fk_project_id")
  htx_user   htx_user @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "projects_labelstreamhistory_user_id_1b571ab9_fk_htx_user_id")

  @@unique([user_id, project_id], map: "unique_history")
  @@index([project_id], map: "projects_labelstreamhistory_project_id_906c91dd")
  @@index([user_id], map: "projects_labelstreamhistory_user_id_1b571ab9")
}

/// This model has constraints using non-default deferring rules and requires additional setup for migrations. Visit https://pris.ly/d/constraint-deferring for more info.
model projects_projectimport {
  id                       Int       @id @default(autoincrement())
  preannotated_from_fields Json?
  commit_to_project        Boolean
  return_task_ids          Boolean
  status                   String    @db.VarChar(64)
  url                      String?   @db.VarChar(2048)
  traceback                String?
  error                    String?
  created_at               DateTime? @db.Timestamptz(6)
  updated_at               DateTime? @db.Timestamptz(6)
  finished_at              DateTime? @db.Timestamptz(6)
  task_count               Int
  annotation_count         Int
  prediction_count         Int
  duration                 Int
  file_upload_ids          Json
  could_be_tasks_list      Boolean
  found_formats            Json
  data_columns             Json
  tasks                    Json?
  task_ids                 Json
  project_id               Int?
  project                  project?  @relation(fields: [project_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "projects_projectimport_project_id_619e3461_fk_project_id")

  @@index([project_id], map: "projects_projectimport_project_id_619e3461")
}

/// This model has constraints using non-default deferring rules and requires additional setup for migrations. Visit https://pris.ly/d/constraint-deferring for more info.
model projects_projectmember {
  id         Int      @id @default(autoincrement())
  enabled    Boolean
  created_at DateTime @db.Timestamptz(6)
  updated_at DateTime @db.Timestamptz(6)
  project_id Int
  user_id    Int
  project    project  @relation(fields: [project_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "projects_projectmember_project_id_e589ddea_fk_project_id")
  htx_user   htx_user @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "projects_projectmember_user_id_a475bbd8_fk_htx_user_id")

  @@index([project_id], map: "projects_projectmember_project_id_e589ddea")
  @@index([user_id], map: "projects_projectmember_user_id_a475bbd8")
}

/// This model has constraints using non-default deferring rules and requires additional setup for migrations. Visit https://pris.ly/d/constraint-deferring for more info.
model projects_projectonboarding {
  id                              Int                             @id @default(autoincrement())
  finished                        Boolean
  created_at                      DateTime                        @db.Timestamptz(6)
  updated_at                      DateTime                        @db.Timestamptz(6)
  project_id                      Int
  step_id                         Int
  projects_projectonboardingsteps projects_projectonboardingsteps @relation(fields: [step_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "projects_projectonbo_step_id_c232d94b_fk_projects_")
  project                         project                         @relation(fields: [project_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "projects_projectonboarding_project_id_120e4f53_fk_project_id")

  @@index([project_id], map: "projects_projectonboarding_project_id_120e4f53")
  @@index([step_id], map: "projects_projectonboarding_step_id_c232d94b")
}

model projects_projectonboardingsteps {
  id                         Int                          @id @default(autoincrement())
  code                       String?                      @db.VarChar(2)
  title                      String                       @db.VarChar(1000)
  description                String
  order                      Int
  created_at                 DateTime                     @db.Timestamptz(6)
  updated_at                 DateTime                     @db.Timestamptz(6)
  projects_projectonboarding projects_projectonboarding[]
}

/// This model has constraints using non-default deferring rules and requires additional setup for migrations. Visit https://pris.ly/d/constraint-deferring for more info.
model projects_projectreimport {
  id                  Int      @id @default(autoincrement())
  status              String   @db.VarChar(64)
  error               String?
  task_count          Int
  annotation_count    Int
  prediction_count    Int
  duration            Int
  file_upload_ids     Json
  files_as_tasks_list Boolean
  found_formats       Json
  data_columns        Json
  traceback           String?
  project_id          Int?
  project             project? @relation(fields: [project_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "projects_projectreimport_project_id_6bcffbed_fk_project_id")

  @@index([project_id], map: "projects_projectreimport_project_id_6bcffbed")
}

/// This model has constraints using non-default deferring rules and requires additional setup for migrations. Visit https://pris.ly/d/constraint-deferring for more info.
model projects_projectsummary {
  project_id            Int      @id
  created_at            DateTime @db.Timestamptz(6)
  all_data_columns      Json?
  common_data_columns   Json?
  created_annotations   Json?
  created_labels        Json?
  created_labels_drafts Json?
  project               project  @relation(fields: [project_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "projects_projectsummary_project_id_0d5aff36_fk_project_id")
}

/// This model has constraints using non-default deferring rules and requires additional setup for migrations. Visit https://pris.ly/d/constraint-deferring for more info.
model session_policy_sessiontimeoutpolicy {
  organization_id           Int          @id
  max_session_age           Int
  max_time_between_activity Int
  created_at                DateTime     @db.Timestamptz(6)
  updated_at                DateTime     @db.Timestamptz(6)
  organization              organization @relation(fields: [organization_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "session_policy_sessi_organization_id_c2feae9a_fk_organizat")
}

/// This model has constraints using non-default deferring rules and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model contains an expression index which requires additional setup for migrations. Visit https://pris.ly/d/expression-indexes for more info.
model task {
  id                                      Int                                      @id @default(autoincrement())
  data                                    Json
  created_at                              DateTime                                 @db.Timestamptz(6)
  updated_at                              DateTime                                 @db.Timestamptz(6)
  is_labeled                              Boolean
  project_id                              Int?
  meta                                    Json?
  overlap                                 Int
  file_upload_id                          Int?
  updated_by_id                           Int?
  inner_id                                BigInt?
  total_annotations                       Int
  cancelled_annotations                   Int
  total_predictions                       Int
  comment_count                           Int
  last_comment_updated_at                 DateTime?                                @db.Timestamptz(6)
  unresolved_comment_count                Int
  io_storages_azureblobimportstoragelink  io_storages_azureblobimportstoragelink?
  io_storages_gcsimportstoragelink        io_storages_gcsimportstoragelink?
  io_storages_localfilesimportstoragelink io_storages_localfilesimportstoragelink?
  io_storages_redisimportstoragelink      io_storages_redisimportstoragelink?
  io_storages_s3importstoragelink         io_storages_s3importstoragelink?
  prediction                              prediction[]
  data_import_fileupload                  data_import_fileupload?                  @relation(fields: [file_upload_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "task_file_upload_id_549188ed_fk_data_import_fileupload_id")
  project                                 project?                                 @relation(fields: [project_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "task_project_id_963d6354_fk_project_id")
  htx_user                                htx_user?                                @relation(fields: [updated_by_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "task_updated_by_id_c9d9ddfb_fk_htx_user_id")
  task_comment_authors                    task_comment_authors[]
  task_completion                         task_completion[]
  tasks_annotationdraft                   tasks_annotationdraft[]
  tasks_failedprediction                  tasks_failedprediction[]
  tasks_tasklock                          tasks_tasklock[]

  @@index([cancelled_annotations], map: "task_cancelled_annotations_60dfe3b9")
  @@index([comment_count], map: "task_comment_count_049355cc")
  @@index([file_upload_id], map: "task_file_upload_id_549188ed")
  @@index([id, overlap], map: "task_id_7a9aca_idx")
  @@index([id, project_id], map: "task_id_aef988_idx")
  @@index([last_comment_updated_at], map: "task_last_comment_updated_at_d1bc3403")
  @@index([overlap], map: "task_overlap_455a13f0")
  @@index([overlap], map: "task_overlap_6a196e_idx")
  @@index([project_id, inner_id], map: "task_project_499b59_idx")
  @@index([project_id, is_labeled], map: "task_project_6acf5f_idx")
  @@index([project_id, id], map: "task_project_7b1c80_idx")
  @@index([project_id], map: "task_project_id_963d6354")
  @@index([total_annotations], map: "task_total_annotations_e77e347b")
  @@index([total_predictions], map: "task_total_predictions_f1a6b218")
  @@index([unresolved_comment_count], map: "task_unresolved_comment_count_8707d0c7")
  @@index([updated_at], map: "task_updated_at_brin_idx", type: Brin)
  @@index([updated_by_id], map: "task_updated_by_id_c9d9ddfb")
}

/// This model has constraints using non-default deferring rules and requires additional setup for migrations. Visit https://pris.ly/d/constraint-deferring for more info.
model task_comment_authors {
  id       Int      @id @default(autoincrement())
  task_id  Int
  user_id  Int
  task     task     @relation(fields: [task_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "task_comment_authors_task_id_80618a4a_fk_task_id")
  htx_user htx_user @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "task_comment_authors_user_id_ff0b1cf0_fk_htx_user_id")

  @@unique([task_id, user_id], map: "task_comment_authors_task_id_user_id_f6f772c9_uniq")
  @@index([task_id], map: "task_comment_authors_task_id_80618a4a")
  @@index([user_id], map: "task_comment_authors_user_id_ff0b1cf0")
}

/// This model has constraints using non-default deferring rules and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model contains an expression index which requires additional setup for migrations. Visit https://pris.ly/d/expression-indexes for more info.
model task_completion {
  id                                                    Int                                      @id @default(autoincrement())
  result                                                Json?
  was_cancelled                                         Boolean
  ground_truth                                          Boolean
  created_at                                            DateTime                                 @db.Timestamptz(6)
  updated_at                                            DateTime                                 @db.Timestamptz(6)
  task_id                                               Int?
  prediction_result                                     Json?                                    @map("prediction")
  lead_time                                             Float?
  result_count                                          Int
  completed_by_id                                       Int?
  parent_prediction_id                                  Int?
  parent_annotation_id                                  Int?
  last_action                                           String?                                  @db.VarChar(128)
  last_created_by_id                                    Int?
  project_id                                            Int?
  updated_by_id                                         Int?
  unique_id                                             String?                                  @unique @db.Uuid
  draft_created_at                                      DateTime?                                @db.Timestamptz(6)
  import_id                                             BigInt?
  bulk_created                                          Boolean?                                 @default(false)
  io_storages_azureblobexportstoragelink                io_storages_azureblobexportstoragelink?
  io_storages_gcsexportstoragelink                      io_storages_gcsexportstoragelink?
  io_storages_localfilesexportstoragelink               io_storages_localfilesexportstoragelink?
  io_storages_redisexportstoragelink                    io_storages_redisexportstoragelink?
  io_storages_s3exportstoragelink                       io_storages_s3exportstoragelink?
  htx_user_task_completion_completed_by_idTohtx_user    htx_user?                                @relation("task_completion_completed_by_idTohtx_user", fields: [completed_by_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "task_completion_completed_by_id_3f3206b1_fk_htx_user_id")
  htx_user_task_completion_last_created_by_idTohtx_user htx_user?                                @relation("task_completion_last_created_by_idTohtx_user", fields: [last_created_by_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "task_completion_last_created_by_id_a04457d1_fk_htx_user_id")
  task_completion                                       task_completion?                         @relation("task_completionTotask_completion", fields: [parent_annotation_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "task_completion_parent_annotation_id_58398c37_fk_task_comp")
  other_task_completion                                 task_completion[]                        @relation("task_completionTotask_completion")
  prediction                                            prediction?                              @relation(fields: [parent_prediction_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "task_completion_parent_prediction_id_053d00d9_fk_prediction_id")
  project                                               project?                                 @relation(fields: [project_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "task_completion_project_id_94072c87_fk_project_id")
  task                                                  task?                                    @relation(fields: [task_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "task_completion_task_id_b9049fbc_fk_task_id")
  htx_user_task_completion_updated_by_idTohtx_user      htx_user?                                @relation("task_completion_updated_by_idTohtx_user", fields: [updated_by_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "task_completion_updated_by_id_1164a739_fk_htx_user_id")
  tasks_annotationdraft                                 tasks_annotationdraft[]

  @@index([created_at], map: "task_comple_created_f55e6f_idx")
  @@index([ground_truth], map: "task_comple_ground__088a1b_idx")
  @@index([id, task_id], map: "task_comple_id_653858_idx")
  @@index([last_action], map: "task_comple_last_ac_777e69_idx")
  @@index([project_id, completed_by_id], map: "task_comple_project_0bc0be_idx")
  @@index([project_id, ground_truth], map: "task_comple_project_2cbbfc_idx")
  @@index([project_id, was_cancelled], map: "task_comple_project_5c60f3_idx")
  @@index([project_id, id], map: "task_comple_project_c7e507_idx")
  @@index([task_id, was_cancelled], map: "task_comple_task_id_8072c3_idx")
  @@index([task_id, id], map: "task_comple_task_id_a6bdec_idx")
  @@index([task_id, completed_by_id], map: "task_comple_task_id_d49cd7_idx")
  @@index([task_id, ground_truth], map: "task_comple_task_id_e82920_idx")
  @@index([was_cancelled], map: "task_comple_was_can_f87d4e_idx")
  @@index([completed_by_id], map: "task_completion_completed_by_id_3f3206b1")
  @@index([import_id], map: "task_completion_import_id_e434c5af")
  @@index([last_created_by_id], map: "task_completion_last_created_by_id_a04457d1")
  @@index([parent_annotation_id], map: "task_completion_parent_annotation_id_58398c37")
  @@index([parent_prediction_id], map: "task_completion_parent_prediction_id_053d00d9")
  @@index([project_id], map: "task_completion_project_id_94072c87")
  @@index([task_id], map: "task_completion_task_id_b9049fbc")
  @@index([updated_by_id], map: "task_completion_updated_by_id_1164a739")
}

/// This model has constraints using non-default deferring rules and requires additional setup for migrations. Visit https://pris.ly/d/constraint-deferring for more info.
model tasks_annotationdraft {
  id              Int              @id(map: "tasks_taskcompletiondraft_pkey") @default(autoincrement())
  result          Json
  lead_time       Float?
  created_at      DateTime         @db.Timestamptz(6)
  updated_at      DateTime         @db.Timestamptz(6)
  annotation_id   Int?
  task_id         Int?
  user_id         Int
  was_postponed   Boolean
  import_id       BigInt?
  task_completion task_completion? @relation(fields: [annotation_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "tasks_annotationdraf_annotation_id_86db74e5_fk_task_comp")
  task            task?            @relation(fields: [task_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "tasks_taskcompletiondraft_task_id_e575af88_fk_task_id")
  htx_user        htx_user         @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "tasks_taskcompletiondraft_user_id_b4b84cef_fk_htx_user_id")

  @@index([import_id], map: "tasks_annotationdraft_import_id_29542ca8")
  @@index([was_postponed], map: "tasks_annotationdraft_was_postponed_6a1ee000")
  @@index([annotation_id], map: "tasks_taskcompletiondraft_completion_id_dc5dea99")
  @@index([task_id], map: "tasks_taskcompletiondraft_task_id_e575af88")
  @@index([user_id], map: "tasks_taskcompletiondraft_user_id_b4b84cef")
}

/// This model has constraints using non-default deferring rules and requires additional setup for migrations. Visit https://pris.ly/d/constraint-deferring for more info.
model tasks_failedprediction {
  id                  Int                 @id @default(autoincrement())
  message             String?
  error_type          String?             @db.VarChar(512)
  model_version       String?
  created_at          DateTime            @db.Timestamptz(6)
  ml_backend_model_id Int?
  model_run_id        Int?
  project_id          Int?
  task_id             Int
  prediction_meta     prediction_meta?
  ml_mlbackend        ml_mlbackend?       @relation(fields: [ml_backend_model_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "tasks_failedpredicti_ml_backend_model_id_5813a377_fk_ml_mlback")
  ml_models_modelrun  ml_models_modelrun? @relation(fields: [model_run_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "tasks_failedpredicti_model_run_id_eec73944_fk_ml_models")
  project             project?            @relation(fields: [project_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "tasks_failedprediction_project_id_6b803bbe_fk_project_id")
  task                task                @relation(fields: [task_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "tasks_failedprediction_task_id_ed2f3848_fk_task_id")

  @@index([ml_backend_model_id], map: "tasks_failedprediction_ml_backend_model_id_5813a377")
  @@index([model_run_id], map: "tasks_failedprediction_model_run_id_eec73944")
  @@index([project_id], map: "tasks_failedprediction_project_id_6b803bbe")
  @@index([task_id], map: "tasks_failedprediction_task_id_ed2f3848")
}

/// This model has constraints using non-default deferring rules and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model has constraints using non-default deferring rules and requires additional setup for migrations. Visit https://pris.ly/d/constraint-deferring for more info.
model tasks_tasklock {
  id         Int       @id @default(autoincrement())
  expire_at  DateTime  @db.Timestamptz(6)
  task_id    Int
  user_id    Int
  unique_id  String?   @unique @db.Uuid
  created_at DateTime? @db.Timestamptz(6)
  task       task      @relation(fields: [task_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "tasks_tasklock_task_id_6531a5ed_fk_task_id")
  htx_user   htx_user  @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "tasks_tasklock_user_id_748ae86f_fk_htx_user_id")

  @@index([task_id], map: "tasks_tasklock_task_id_6531a5ed")
  @@index([user_id], map: "tasks_tasklock_user_id_748ae86f")
}

/// This model has constraints using non-default deferring rules and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model has constraints using non-default deferring rules and requires additional setup for migrations. Visit https://pris.ly/d/constraint-deferring for more info.
model token_blacklist_blacklistedtoken {
  id                               BigInt                           @id @default(autoincrement())
  blacklisted_at                   DateTime                         @db.Timestamptz(6)
  token_id                         BigInt                           @unique
  token_blacklist_outstandingtoken token_blacklist_outstandingtoken @relation(fields: [token_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "token_blacklist_blacklistedtoken_token_id_3cc7fe56_fk")
}

/// This model has constraints using non-default deferring rules and requires additional setup for migrations. Visit https://pris.ly/d/constraint-deferring for more info.
model token_blacklist_outstandingtoken {
  id                               BigInt                            @id @default(autoincrement())
  token                            String
  created_at                       DateTime?                         @db.Timestamptz(6)
  expires_at                       DateTime                          @db.Timestamptz(6)
  user_id                          Int?
  jti                              String                            @unique(map: "token_blacklist_outstandingtoken_jti_hex_d9bdf6f7_uniq") @db.VarChar(255)
  token_blacklist_blacklistedtoken token_blacklist_blacklistedtoken?
  htx_user                         htx_user?                         @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "token_blacklist_outs_user_id_83bc629a_fk_htx_user_")

  @@index([jti], map: "token_blacklist_outstandingtoken_jti_hex_d9bdf6f7_like")
  @@index([user_id], map: "token_blacklist_outstandingtoken_user_id_83bc629a")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model user_insights {
  id              Int       @id @default(autoincrement())
  user_id         Int
  insight_type    String    @db.VarChar(50)
  insight_key     String    @db.VarChar(100)
  insight_value   Json?
  confidence      Decimal?  @default(0.5) @db.Decimal(5, 4)
  source          String?   @db.VarChar(50)
  extracted_at    DateTime? @default(now()) @db.Timestamp(6)
  created_at      DateTime? @default(now()) @db.Timestamp(6)
  updated_at      DateTime? @default(now()) @db.Timestamp(6)
  conversation_id String?   @db.VarChar(100)

  @@unique([user_id, insight_type, insight_key])
  @@index([insight_type], map: "idx_user_insights_type")
  @@index([user_id], map: "idx_user_insights_user")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model user_interactions {
  id               Int       @id @default(autoincrement())
  user_id          Int
  item_id          Int
  interaction_type String?   @db.VarChar(20)
  metadata         Json?
  created_at       DateTime? @default(now()) @db.Timestamp(6)

  @@index([item_id], map: "idx_user_interactions_item_id")
  @@index([interaction_type], map: "idx_user_interactions_type")
  @@index([user_id], map: "idx_user_interactions_user_id")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model user_profiles {
  id                          Int       @id @default(autoincrement())
  user_id                     Int       @unique
  phone                       String?   @unique @db.VarChar(20)
  dietary_type                String?   @db.VarChar(20)
  dietary_restrictions        String[]
  allergies                   String[]
  favorite_cuisines           Json?     @default("{}")
  disliked_ingredients        String[]
  avg_order_value             Decimal?  @db.Decimal(10, 2)
  order_frequency             String?   @db.VarChar(20)
  preferred_meal_times        Json?
  price_sensitivity           String?   @db.VarChar(20)
  communication_tone          String?   @db.VarChar(20)
  personality_traits          Json?     @default("{}")
  profile_completeness        Int?      @default(0)
  last_conversation_analyzed  DateTime? @db.Timestamp(6)
  last_profile_question_at    DateTime? @db.Timestamp(6)
  profile_questions_this_week Int?      @default(0)
  created_at                  DateTime? @default(now()) @db.Timestamp(6)
  updated_at                  DateTime? @default(now()) @db.Timestamp(6)
  total_searches              Int?      @default(0)
  food_preferences            Json?     @default("{}")
  favorite_items              Json?     @default("[]")
  favorite_categories         Json?     @default("[]")
  favorite_stores             Json?     @default("[]")
  //  New explicit columns for frequently queried profile fields
  spice_level                 String?   @db.VarChar(20)
  preferred_area              String?   @db.VarChar(100)
  language_preference         String?   @default("hinglish") @db.VarChar(10)
  family_size                 Int?
  occupation                  String?   @db.VarChar(50)
  age_group                   String?   @db.VarChar(20)

  @@index([phone], map: "idx_user_profiles_phone")
  @@index([user_id], map: "idx_user_profiles_user_id")
}

model orders_synced {
  id             Int       @id @default(autoincrement())
  orderId        Int       @unique @map("order_id")
  userId         Int       @map("user_id")
  storeId        Int       @map("store_id")
  storeName      String    @map("store_name") @db.VarChar(200)
  orderAmount    Decimal   @map("order_amount") @db.Decimal(10, 2)
  deliveryCharge Decimal?  @default(0) @map("delivery_charge") @db.Decimal(10, 2)
  items          Json?
  orderStatus    String    @map("order_status") @db.VarChar(50)
  paymentMethod  String?   @map("payment_method") @db.VarChar(50)
  orderedAt      DateTime  @map("ordered_at") @db.Timestamp(6)
  syncedAt       DateTime? @default(now()) @map("synced_at") @db.Timestamp(6)
  createdAt      DateTime? @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt      DateTime? @default(now()) @updatedAt @map("updated_at") @db.Timestamp(6)

  @@index([userId], map: "idx_orders_synced_user_id")
  @@index([userId, orderedAt(sort: Desc)], map: "idx_orders_synced_user_ordered")
  @@index([storeId], map: "idx_orders_synced_store")
  @@index([orderStatus], map: "idx_orders_synced_status")
  @@map("orders_synced")
}

/// Order Status History - Event Sourcing Pattern
/// Tracks all status changes for orders to prevent race conditions
/// and maintain audit trail
model order_status_history {
  id              Int       @id @default(autoincrement())
  orderId         Int       @map("order_id")
  status          String    @db.VarChar(50)
  previousStatus  String?   @map("previous_status") @db.VarChar(50)
  metadata        Json?     // Additional data like rider info, payment details, etc.
  source          String?   @default("system") @db.VarChar(50) // "webhook", "manual", "system", "php"
  changedBy       String?   @map("changed_by") @db.VarChar(100) // User/system identifier
  timestamp       DateTime  @default(now()) @db.Timestamp(6)
  createdAt       DateTime  @default(now()) @map("created_at") @db.Timestamp(6)

  @@index([orderId], map: "idx_order_status_history_order")
  @@index([orderId, timestamp(sort: Desc)], map: "idx_order_status_history_order_time")
  @@index([status], map: "idx_order_status_history_status")
  @@index([timestamp], map: "idx_order_status_history_timestamp")
  @@map("order_status_history")
}

/// Intent Routing Rules - Unified routing configuration
/// Consolidates hardcoded patterns from IntentRouterService into database
model intent_routing_rules {
  id                Int       @id @default(autoincrement())
  name              String    @db.VarChar(100)                // Rule name (e.g., "food_keywords", "cancel_command")
  ruleType          String    @map("rule_type") @db.VarChar(50) // "keyword", "pattern", "override", "command"
  priority          Int       @default(50)                     // Higher = checked first (commands=100, overrides=80, keywords=50)

  // Pattern matching
  keywords          String[]  @default([])                     // List of keywords to match
  regexPattern      String?   @map("regex_pattern")            // Regex pattern (optional)
  caseSensitive     Boolean   @default(false) @map("case_sensitive")

  // Action
  targetIntent      String?   @map("target_intent") @db.VarChar(100) // Intent to route to (e.g., "order_food", "cancel")
  targetFlow        String?   @map("target_flow") @db.VarChar(100)   // Flow ID to start (e.g., "food_order_v1")
  confidence        Float     @default(0.9)                    // Confidence score (0-1)

  // Override conditions
  appliesToIntents  String[]  @default([]) @map("applies_to_intents") // Only apply override if NLU returned these intents
  requiresContext   Json?     @map("requires_context")         // Context conditions (e.g., {"hasActiveFlow": false})

  // Metadata
  isActive          Boolean   @default(true) @map("is_active")
  description       String?
  createdBy         String?   @map("created_by") @db.VarChar(100)
  createdAt         DateTime  @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt         DateTime  @default(now()) @updatedAt @map("updated_at") @db.Timestamp(6)

  @@index([ruleType, priority(sort: Desc)], map: "idx_routing_rules_type_priority")
  @@index([isActive], map: "idx_routing_rules_active")
  @@index([priority(sort: Desc)], map: "idx_routing_rules_priority")
  @@map("intent_routing_rules")
}

/// Active Learning Feedback - User corrections for NLU predictions
/// Enables continuous model improvement through user feedback
model nlu_prediction_feedback {
  id                Int       @id @default(autoincrement())
  sessionId         String    @map("session_id") @db.VarChar(255)
  userId            Int?      @map("user_id")

  // User message
  userMessage       String    @map("user_message")
  language          String?   @default("hi") @db.VarChar(10)

  // NLU prediction
  predictedIntent   String    @map("predicted_intent") @db.VarChar(100)
  intentConfidence  Float     @map("intent_confidence")
  predictedEntities Json      @map("predicted_entities") // {food_reference: ["pizza"], quantity: ["2"]}
  modelVersion      String?   @map("model_version") @db.VarChar(50)

  // User feedback
  feedbackType      String    @map("feedback_type") @db.VarChar(50) // "correct", "incorrect", "partial"
  correctedIntent   String?   @map("corrected_intent") @db.VarChar(100)
  correctedEntities Json?     @map("corrected_entities")
  userComment       String?   @map("user_comment")

  // Metadata
  feedbackTimestamp DateTime  @default(now()) @map("feedback_timestamp") @db.Timestamp(6)
  predictionTimestamp DateTime @default(now()) @map("prediction_timestamp") @db.Timestamp(6)
  isUsedForTraining Boolean   @default(false) @map("is_used_for_training")
  channel           String?   @db.VarChar(50) // "web", "whatsapp", "voice"

  @@index([sessionId], map: "idx_feedback_session")
  @@index([predictedIntent, feedbackType], map: "idx_feedback_intent_type")
  @@index([intentConfidence], map: "idx_feedback_confidence")
  @@index([feedbackTimestamp], map: "idx_feedback_timestamp")
  @@index([isUsedForTraining], map: "idx_feedback_training")
  @@map("nlu_prediction_feedback")
}

model bot_config {
  id          Int       @id @default(autoincrement())
  configKey   String    @unique @map("config_key") @db.VarChar(100)
  configValue String    @map("config_value")
  configType  String?   @default("string") @map("config_type") @db.VarChar(50)
  category    String?   @default("general") @db.VarChar(50)
  description String?
  updatedBy   Int?      @map("updated_by")
  createdAt   DateTime? @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt   DateTime? @default(now()) @updatedAt @map("updated_at") @db.Timestamp(6)

  @@index([category], map: "idx_bot_config_category")
  @@index([configKey], map: "idx_bot_config_key")
  @@map("bot_config")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model user_search_patterns {
  id                Int       @id @default(autoincrement())
  user_id           Int
  query_text        String?
  query_normalized  String?
  module            String?   @default("food") @db.VarChar(20)
  search_count      Int?      @default(1)
  total_clicks      Int?      @default(0)
  total_conversions Int?      @default(0)
  first_searched_at DateTime? @default(now()) @db.Timestamp(6)
  last_searched_at  DateTime? @default(now()) @db.Timestamp(6)
  created_at        DateTime? @default(now()) @db.Timestamp(6)

  @@unique([user_id, query_normalized, module])
  @@index([last_searched_at], map: "idx_usp_last")
  @@index([user_id], map: "idx_usp_user_id")
}

/// This model has constraints using non-default deferring rules and requires additional setup for migrations. Visit https://pris.ly/d/constraint-deferring for more info.
model users_userproducttour {
  id               Int      @id @default(autoincrement())
  name             String   @db.VarChar(256)
  state            String   @db.VarChar(32)
  interaction_data Json
  created_at       DateTime @db.Timestamptz(6)
  updated_at       DateTime @db.Timestamptz(6)
  user_id          Int
  htx_user         htx_user @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "users_userproducttour_user_id_64e8adfc_fk_htx_user_id")

  @@index([user_id], map: "users_userproducttour_user_id_64e8adfc")
}

/// This model has constraints using non-default deferring rules and requires additional setup for migrations. Visit https://pris.ly/d/constraint-deferring for more info.
model webhook {
  id                   Int              @id @default(autoincrement())
  url                  String           @db.VarChar(2048)
  send_payload         Boolean
  send_for_all_actions Boolean
  headers              Json
  is_active            Boolean
  created_at           DateTime         @db.Timestamptz(6)
  updated_at           DateTime         @db.Timestamptz(6)
  organization_id      Int
  project_id           Int?
  organization         organization     @relation(fields: [organization_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "webhook_organization_id_b5440e9a_fk_organization_id")
  project              project?         @relation(fields: [project_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "webhook_project_id_e686d00c_fk_project_id")
  webhook_action       webhook_action[]

  @@index([created_at], map: "webhook_created_at_b2a71ea5")
  @@index([organization_id], map: "webhook_organization_id_b5440e9a")
  @@index([project_id], map: "webhook_project_id_e686d00c")
  @@index([updated_at], map: "webhook_updated_at_695b4e7f")
}

/// This model has constraints using non-default deferring rules and requires additional setup for migrations. Visit https://pris.ly/d/constraint-deferring for more info.
model webhook_action {
  id         Int     @id @default(autoincrement())
  action     String  @db.VarChar(128)
  webhook_id Int
  webhook    webhook @relation(fields: [webhook_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "webhook_action_webhook_id_4eb6213f_fk_webhook_id")

  @@unique([webhook_id, action], map: "webhook_action_webhook_id_action_11842b15_uniq")
  @@index([action], map: "webhook_action_action_4398909e")
  @@index([action], map: "webhook_action_action_4398909e_like")
  @@index([webhook_id], map: "webhook_action_webhook_id_4eb6213f")
}

model ConversationMessage {
  id           String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  sessionId    String   @map("session_id")
  userId       String?  @map("user_id")
  phoneNumber  String?  @map("phone_number")
  role         String?
  content      String?
  intent       String?
  confidence   Float?
  turnNumber   Int?     @map("turn_number")
  metadata     Json?
  createdAt    DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  sender       String?
  message      String?
  phone        String?
  messageType  String?  @map("message_type")
  messageText  String?  @map("message_text")
  flowId       String?  @map("flow_id")
  stepId       String?  @map("step_id")
  variables    Json?
  platform     String?
  entities     Json?    @default("{}")
  message_hash String?  @db.VarChar(64)

  @@index([createdAt], map: "idx_conversation_created")
  @@index([intent], map: "idx_conversation_intent")
  @@index([phoneNumber], map: "idx_conversation_phone")
  @@index([sessionId], map: "idx_conversation_session")
  @@index([userId], map: "idx_conversation_user")
  @@map("conversation_messages")
}

model IntentDefinition {
  id          String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name        String    @unique @db.VarChar(255)
  description String?
  examples    String[]  @default([])
  slots       Json?     @default("{}")
  createdAt   DateTime? @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt   DateTime? @default(now()) @updatedAt @map("updated_at") @db.Timestamp(6)

  @@map("intent_definitions")
}

model NluTrainingData {
  id               String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  text             String    @unique
  intent           String
  entities         Json      @default("{}")
  tone             String?
  sentiment        String?
  confidence       Float
  source           String
  reviewStatus     String    @default("pending") @map("review_status")
  userId           String?   @map("user_id")
  sessionId        String?   @map("session_id")
  language         String    @default("en")
  createdAt        DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)
  status           String?   @default("pending")
  auto_approved_at DateTime? @db.Timestamptz(6)
  priority         Int?      @default(0)
  conversation_id  String?
  approved_by      String?
  approved_at      DateTime? @db.Timestamptz(6)
  rejected_by      String?
  rejected_at      DateTime? @db.Timestamptz(6)
  rejection_reason String?

  @@index([intent], map: "idx_training_data_intent")
  @@index([source], map: "idx_training_data_source")
  @@index([reviewStatus], map: "idx_training_data_status")
  @@map("nlu_training_data")
}

model VoiceCharacter {
  id                  String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name                String    @unique @db.VarChar(50)
  displayName         String    @map("display_name") @db.VarChar(100)
  isActive            Boolean?  @default(true) @map("is_active")
  createdAt           DateTime? @default(now()) @map("created_at") @db.Timestamp(6)
  description         String?
  avatar              String?   @db.VarChar(512)
  personality         Json?     @default("{}")
  traits              String[]  @default([])
  defaultLanguage     String?   @default("hi") @map("default_language") @db.VarChar(10)
  defaultExaggeration Decimal?  @default(0.5) @map("default_exaggeration") @db.Decimal(3, 2)
  defaultCfgWeight    Decimal?  @default(0.5) @map("default_cfg_weight") @db.Decimal(3, 2)
  defaultSpeed        Decimal?  @default(1.0) @map("default_speed") @db.Decimal(3, 2)
  defaultPitch        Decimal?  @default(1.0) @map("default_pitch") @db.Decimal(3, 2)
  voiceReferenceUrl   String?   @map("voice_reference_url") @db.VarChar(512)
  voiceReferenceText  String?   @map("voice_reference_text")
  ttsEngine           String?   @default("chatterbox") @map("tts_engine") @db.VarChar(50)
  ttsConfig           Json?     @default("{}") @map("tts_config")
  isDefault           Boolean?  @default(false) @map("is_default")
  sortOrder           Int?      @default(0) @map("sort_order")
  updatedAt           DateTime? @default(now()) @updatedAt @map("updated_at") @db.Timestamp(6)
  createdBy           String?   @map("created_by") @db.VarChar(100)

  @@map("voice_characters")
}

model search_logs {
  id                String    @id @db.Uuid
  query             String
  search_type       String?   @db.VarChar(50)
  filters           Json?
  results_count     Int?
  execution_time_ms Int?
  session_id        String?   @db.VarChar(100)
  user_id           String?   @db.VarChar(100)
  platform          String?   @db.VarChar(20)
  created_at        DateTime? @default(now()) @db.Timestamp(6)

  @@index([created_at], map: "idx_search_logs_created_at")
  @@index([query], map: "idx_search_logs_query")
  @@index([platform], map: "idx_search_logs_platform")
}

model ABTest {
  id                String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  testId            String    @unique @map("test_id") @db.VarChar(100)
  name              String    @db.VarChar(255)
  description       String?
  hypothesis        String?
  enabled           Boolean?  @default(true)
  controlGroup      String    @map("control_group") @db.VarChar(100)
  variantGroup      String    @map("variant_group") @db.VarChar(100)
  trafficAllocation Int?      @default(50) @map("traffic_allocation")
  successMetric     String    @map("success_metric") @db.VarChar(50)
  targetImprovement Float     @map("target_improvement")
  startDate         DateTime  @map("start_date") @db.Timestamp(6)
  endDate           DateTime  @map("end_date") @db.Timestamp(6)
  createdAt         DateTime? @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt         DateTime? @default(now()) @updatedAt @map("updated_at") @db.Timestamp(6)

  @@index([testId], map: "idx_abtest_test_id")
  @@index([enabled], map: "idx_abtest_enabled")
  @@map("ab_tests")
}

model ABTestAssignment {
  id         String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId     String    @map("user_id") @db.VarChar(100)
  testId     String    @map("test_id") @db.VarChar(100)
  variant    String    @db.VarChar(50)
  assignedAt DateTime? @default(now()) @map("assigned_at") @db.Timestamp(6)

  @@unique([userId, testId])
  @@index([testId], map: "idx_abtest_assignment_test_id")
  @@index([variant], map: "idx_abtest_assignment_variant")
  @@map("ab_test_assignments")
}

model ABTestMetric {
  id             String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId         String    @map("user_id") @db.VarChar(100)
  testId         String    @map("test_id") @db.VarChar(100)
  variant        String    @db.VarChar(50)
  metricName     String    @map("metric_name") @db.VarChar(100)
  metricValue    Float     @map("metric_value")
  additionalData Json?     @default("{}") @map("additional_data")
  recordedAt     DateTime? @default(now()) @map("recorded_at") @db.Timestamp(6)

  @@index([testId], map: "idx_abtest_metric_test_id")
  @@index([variant], map: "idx_abtest_metric_variant")
  @@index([metricName], map: "idx_abtest_metric_name")
  @@index([recordedAt], map: "idx_abtest_metric_recorded")
  @@map("ab_test_metrics")
}

model TrainingDataPoint {
  id                      String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  message                 String
  questionType            String    @map("question_type") @db.VarChar(100)
  actualClassification    Boolean   @map("actual_classification")
  predictedClassification Boolean   @map("predicted_classification")
  confidence              Float?    @default(0.0)
  flowContext             String?   @map("flow_context") @db.VarChar(100)
  language                String?   @default("en") @db.VarChar(20)
  userId                  String?   @map("user_id") @db.VarChar(100)
  isError                 Boolean?  @default(false) @map("is_error")
  sessionId               String?   @map("session_id") @db.VarChar(100)
  timestamp               DateTime? @default(now()) @db.Timestamp(6)
  createdAt               DateTime? @default(now()) @map("created_at") @db.Timestamp(6)

  @@index([language], map: "idx_training_language")
  @@index([questionType], map: "idx_training_question_type")
  @@index([isError], map: "idx_training_is_error")
  @@index([timestamp], map: "idx_training_timestamp")
  @@index([createdAt], map: "idx_training_created")
  @@map("training_data_points")
}

model conversation_mistakes {
  id               String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  session_id       String
  user_id          String?
  phone_number     String?
  mistake_type     String
  original_text    String
  corrected_text   String?
  confidence       Float?
  source           String?
  created_at       DateTime  @default(now()) @db.Timestamptz(6)
  message_hash     String?
  user_message     String?
  predicted_intent String?
  actual_intent    String?
  is_resolved      Boolean?  @default(false)
  resolved_at      DateTime? @db.Timestamptz(6)
  message_id       String?

  @@index([session_id], map: "idx_mistakes_session")
  @@index([mistake_type], map: "idx_mistakes_type")
}

model data_source_fetch_log {
  id                   Int       @id @default(autoincrement())
  data_source_id       Int?
  fetch_started_at     DateTime? @default(now()) @db.Timestamptz(6)
  fetch_completed_at   DateTime? @db.Timestamptz(6)
  duration_ms          Int?
  success              Boolean?
  http_status          Int?
  error_message        String?
  response_size_bytes  Int?
  items_fetched        Int?
  triggered_by         String?   @db.VarChar(50)
  triggered_by_user_id Int?
  created_at           DateTime? @default(now()) @db.Timestamptz(6)

  @@index([data_source_id], map: "idx_fetch_log_source")
  @@index([fetch_started_at(sort: Desc)], map: "idx_fetch_log_time")
}

model data_source_usage_log {
  id              Int       @id @default(autoincrement())
  data_source_id  Int?
  conversation_id String?   @db.VarChar(100)
  session_id      String?   @db.VarChar(100)
  user_phone      String?   @db.VarChar(20)
  bot_type        String?   @db.VarChar(50)
  intent          String?   @db.VarChar(100)
  data_used       Json?
  used_at         DateTime? @default(now()) @db.Timestamptz(6)

  @@index([data_source_id], map: "idx_usage_log_source")
  @@index([used_at(sort: Desc)], map: "idx_usage_log_time")
}

model data_sources {
  id                     Int       @id @default(autoincrement())
  name                   String    @db.VarChar(255)
  description            String?
  data_type              String    @db.VarChar(50)
  api_endpoint           String?   @db.VarChar(500)
  api_method             String?   @default("GET") @db.VarChar(10)
  api_headers            Json?     @default("{}")
  api_body_template      String?
  api_key_header         String?   @db.VarChar(100)
  api_key_encrypted      String?
  response_path          String?   @db.VarChar(255)
  response_mapping       Json?
  llm_prompt_template    String?
  llm_context_injection  Boolean?  @default(false)
  llm_summary_enabled    Boolean?  @default(false)
  fetch_interval_minutes Int?      @default(60)
  last_fetched_at        DateTime? @db.Timestamptz(6)
  next_fetch_at          DateTime? @db.Timestamptz(6)
  cache_ttl_seconds      Int?      @default(3600)
  cached_data            Json?
  cached_at              DateTime? @db.Timestamptz(6)
  is_active              Boolean?  @default(true)
  priority               Int?      @default(5)
  usage_count            Int?      @default(0)
  avg_response_time_ms   Int?      @default(0)
  error_count            Int?      @default(0)
  last_error             String?
  last_error_at          DateTime? @db.Timestamptz(6)
  health_status          String?   @default("unknown") @db.VarChar(20)
  last_success_at        DateTime? @db.Timestamptz(6)
  assigned_bots          String[]  @default([])
  assigned_intents       String[]  @default([])
  created_by             Int?
  updated_by             Int?
  created_at             DateTime? @default(now()) @db.Timestamptz(6)
  updated_at             DateTime? @default(now()) @db.Timestamptz(6)

  @@index([is_active], map: "idx_data_sources_active")
  @@index([assigned_bots], map: "idx_data_sources_bots", type: Gin)
  @@index([assigned_intents], map: "idx_data_sources_intents", type: Gin)
  @@index([data_type], map: "idx_data_sources_type")
}

model flow_definitions {
  id               String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name             String    @unique
  description      String?
  trigger_intents  String[]  @default([])
  trigger_keywords String[]  @default([])
  flow_json        Json      @default("{}")
  is_active        Boolean?  @default(true)
  priority         Int?      @default(0)
  created_at       DateTime? @default(now()) @db.Timestamptz(6)
  updated_at       DateTime? @default(now()) @db.Timestamptz(6)
}

/// The underlying table does not contain a valid unique identifier and can therefore currently not be handled by Prisma Client.
model foo_test {
  x Int?

  @@ignore
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains an expression index which requires additional setup for migrations. Visit https://pris.ly/d/expression-indexes for more info.
model item_review_intelligence {
  item_id                String    @id @db.VarChar(100)
  store_id               String    @db.VarChar(100)
  overall_sentiment      Json      @default("{\"label\": \"neutral\", \"score\": 0, \"magnitude\": 0}")
  aspects                Json      @default("{}")
  top_praises            String[]  @default([])
  top_complaints         String[]  @default([])
  warnings               Json      @default("{\"oilyWarning\": false, \"lateDelivery\": false, \"spicyWarning\": false, \"quantityIssue\": false}")
  total_reviews_analyzed Int?      @default(0)
  positive_review_count  Int?      @default(0)
  negative_review_count  Int?      @default(0)
  neutral_review_count   Int?      @default(0)
  last_analyzed_at       DateTime? @default(now()) @db.Timestamp(6)
  created_at             DateTime? @default(now()) @db.Timestamp(6)
  updated_at             DateTime? @default(now()) @db.Timestamp(6)

  @@index([store_id], map: "idx_review_intel_store")
  @@index([warnings], map: "idx_review_intel_warnings", type: Gin)
}

model nlu_corrections {
  id               Int       @id @default(autoincrement())
  original_text    String
  predicted_intent String
  actual_action    String
  confidence       Float?
  session_id       String?
  user_id          String?
  occurrence_count Int?      @default(1)
  is_pattern       Boolean?  @default(false)
  created_at       DateTime? @default(now()) @db.Timestamptz(6)
  updated_at       DateTime? @default(now()) @db.Timestamptz(6)
}

model performance_hourly {
  id                  String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  service             String   @db.VarChar(50)
  hour                DateTime @db.Timestamp(6)
  request_count       Int?     @default(0)
  avg_response_ms     Int?     @default(0)
  p50_response_ms     Int?     @default(0)
  p90_response_ms     Int?     @default(0)
  p99_response_ms     Int?     @default(0)
  error_count         Int?     @default(0)
  total_request_size  BigInt?  @default(0)
  total_response_size BigInt?  @default(0)

  @@unique([service, hour])
  @@index([hour], map: "idx_perf_hourly_hour")
  @@index([service], map: "idx_perf_hourly_service")
}

model performance_metrics {
  id               String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  service          String    @db.VarChar(50)
  endpoint         String?   @db.VarChar(200)
  method           String?   @db.VarChar(10)
  response_time_ms Int
  status_code      Int?
  is_error         Boolean?  @default(false)
  tenant_id        Int?
  user_id          String?   @db.VarChar(100)
  request_size     Int?
  response_size    Int?
  created_at       DateTime? @default(now()) @db.Timestamp(6)

  @@index([created_at], map: "idx_perf_created")
  @@index([service], map: "idx_perf_service")
  @@index([tenant_id], map: "idx_perf_tenant")
}

model product_similarities {
  id               String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  product_id_1     String    @db.VarChar(100)
  product_id_2     String    @db.VarChar(100)
  similarity_score Float
  similarity_type  String?   @default("content") @db.VarChar(50)
  updated_at       DateTime? @default(now()) @db.Timestamp(6)

  @@unique([product_id_1, product_id_2, similarity_type])
  @@index([product_id_1], map: "idx_similarities_product1")
}

model recommendation_feedback {
  id                  String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id             String?   @db.VarChar(100)
  session_id          String?   @db.VarChar(100)
  product_id          String    @db.VarChar(100)
  recommendation_type String    @db.VarChar(50)
  action              String    @db.VarChar(50)
  position            Int?
  created_at          DateTime? @default(now()) @db.Timestamp(6)

  @@index([user_id], map: "idx_feedback_user")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model review_aspect_keywords {
  id                  Int       @id @default(autoincrement())
  aspect_name         String    @unique @db.VarChar(50)
  keywords_en         String[]  @default([])
  keywords_hi         String[]  @default([])
  keywords_hinglish   String[]  @default([])
  positive_indicators String[]  @default([])
  negative_indicators String[]  @default([])
  importance_weight   Decimal?  @default(1.0) @db.Decimal(3, 2)
  is_active           Boolean?  @default(true)
  created_at          DateTime? @default(now()) @db.Timestamp(6)
  updated_at          DateTime? @default(now()) @db.Timestamp(6)
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model review_sync_log {
  id                Int       @id @default(autoincrement())
  php_review_id     Int       @unique
  item_id           String?   @db.VarChar(100)
  store_id          String?   @db.VarChar(100)
  customer_name     String?   @db.VarChar(255)
  rating            Int?
  comment           String?
  review_date       DateTime? @db.Timestamp(6)
  sentiment_score   Decimal?  @db.Decimal(4, 3)
  sentiment_label   String?   @db.VarChar(20)
  extracted_aspects Json?     @default("{}")
  language_detected String?   @db.VarChar(20)
  is_analyzed       Boolean?  @default(false)
  analysis_method   String?   @db.VarChar(20)
  analyzed_at       DateTime? @db.Timestamp(6)
  synced_at         DateTime? @default(now()) @db.Timestamp(6)
  created_at        DateTime? @default(now()) @db.Timestamp(6)

  @@index([is_analyzed], map: "idx_sync_log_analyzed")
  @@index([item_id], map: "idx_sync_log_item")
  @@index([store_id], map: "idx_sync_log_store")
}

model search_suggestions_cache {
  id               String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  prefix           String    @db.VarChar(100)
  suggestion       String    @db.VarChar(255)
  suggestion_type  String?   @default("query") @db.VarChar(50)
  score            Float?    @default(1.0)
  click_count      Int?      @default(0)
  conversion_count Int?      @default(0)
  last_used        DateTime? @default(now()) @db.Timestamp(6)
  created_at       DateTime? @default(now()) @db.Timestamp(6)

  @@unique([prefix, suggestion])
  @@index([prefix], map: "idx_suggestions_prefix")
  @@index([score(sort: Desc)], map: "idx_suggestions_score")
}

model service_health {
  id                   String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  service_name         String    @unique @db.VarChar(50)
  status               String?   @default("healthy") @db.VarChar(20)
  last_check           DateTime? @default(now()) @db.Timestamp(6)
  last_response_ms     Int?
  consecutive_failures Int?      @default(0)
  uptime_24h           Float?    @default(100.0)
  errors_24h           Int?      @default(0)
  metadata             Json?     @default("{}")
}

model sla_definitions {
  id              String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id       Int?
  service         String   @db.VarChar(50)
  max_response_ms Int?     @default(2000)
  max_error_rate  Float?   @default(0.01)
  uptime_target   Float?   @default(99.9)
  is_active       Boolean? @default(true)

  @@unique([tenant_id, service])
}

model sla_violations {
  id               String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id        Int?
  service          String    @db.VarChar(50)
  violation_type   String?   @db.VarChar(50)
  actual_value     Float?
  threshold_value  Float?
  duration_minutes Int?
  created_at       DateTime? @default(now()) @db.Timestamp(6)

  @@index([tenant_id], map: "idx_sla_violations_tenant")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model store_review_intelligence {
  store_id               String    @id @db.VarChar(100)
  store_name             String?   @db.VarChar(255)
  overall_sentiment      Json      @default("{\"label\": \"neutral\", \"score\": 0}")
  category_ratings       Json      @default("{\"packaging\": null, \"food_quality\": null, \"delivery_speed\": null, \"value_for_money\": null, \"customer_service\": null}")
  top_rated_items        Json?     @default("[]")
  problem_items          Json?     @default("[]")
  common_praises         String[]  @default([])
  common_complaints      String[]  @default([])
  delivery_time_insights Json?     @default("{}")
  total_reviews          Int?      @default(0)
  avg_rating             Decimal?  @default(0) @db.Decimal(3, 2)
  last_analyzed_at       DateTime? @default(now()) @db.Timestamp(6)
  created_at             DateTime? @default(now()) @db.Timestamp(6)
  updated_at             DateTime? @default(now()) @db.Timestamp(6)
}

model user_product_interactions {
  id                String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id           String    @db.VarChar(100)
  product_id        String    @db.VarChar(100)
  interaction_type  String    @db.VarChar(50)
  interaction_score Float?    @default(1.0)
  session_id        String?   @db.VarChar(100)
  created_at        DateTime? @default(now()) @db.Timestamp(6)

  @@unique([user_id, product_id, interaction_type])
  @@index([product_id], map: "idx_interactions_product")
  @@index([interaction_type], map: "idx_interactions_type")
  @@index([user_id], map: "idx_interactions_user")
}

model visitor_sessions {
  session_id       String    @id @db.VarChar(100)
  visitor_id       String    @db.VarChar(50)
  channel          String?   @db.VarChar(20)
  started_at       DateTime? @default(now()) @db.Timestamp(6)
  last_activity_at DateTime? @default(now()) @db.Timestamp(6)
  messages_count   Int?      @default(0)
  is_authenticated Boolean?  @default(false)
  metadata         Json?     @default("{}")

  @@index([visitor_id], map: "idx_visitor_sessions_visitor")
}

model visitors {
  id                 String    @id @db.VarChar(50)
  phone              String?   @db.VarChar(50)
  user_id            Int?
  first_seen_at      DateTime? @default(now()) @db.Timestamp(6)
  last_seen_at       DateTime? @default(now()) @db.Timestamp(6)
  first_channel      String?   @db.VarChar(20)
  device_fingerprint String?   @db.VarChar(255)
  user_agent         String?
  total_sessions     Int?      @default(1)
  total_messages     Int?      @default(0)
  is_anonymous       Boolean?  @default(true)
  merged_visitor_ids String[]
  metadata           Json?     @default("{}")
  created_at         DateTime? @default(now()) @db.Timestamp(6)
  updated_at         DateTime? @default(now()) @db.Timestamp(6)

  @@index([is_anonymous], map: "idx_visitors_anonymous")
  @@index([last_seen_at], map: "idx_visitors_last_seen")
}

model conversation_insights {
  id               Int       @id @default(autoincrement())
  user_id          Int
  session_id       String?   @db.VarChar(100)
  insight_type     String    @db.VarChar(50)
  insight_category String?   @db.VarChar(50)
  text_excerpt     String?
  extracted_value  Json?
  confidence       Decimal?  @default(0.5) @db.Decimal(5, 4)
  analyzed_by      String?   @default("rule_based") @db.VarChar(20)
  created_at       DateTime? @default(now()) @db.Timestamp(6)

  @@index([session_id], map: "idx_ci_session")
  @@index([insight_type], map: "idx_ci_type")
  @@index([user_id], map: "idx_ci_user_id")
}

model conversation_memory {
  id                     Int       @id @default(autoincrement())
  user_id                Int
  memory_type            String    @db.VarChar(30)
  category               String?   @db.VarChar(50)
  memory_text            String?
  memory_data            Json?
  importance             Int?      @default(50)
  recency_score          Decimal?  @default(1.0) @db.Decimal(5, 4)
  extracted_from_session String?   @db.VarChar(100)
  created_at             DateTime? @default(now()) @db.Timestamp(6)
  updated_at             DateTime? @default(now()) @db.Timestamp(6)

  @@index([user_id, importance(sort: Desc)], map: "idx_cm_importance")
  @@index([memory_type], map: "idx_cm_type")
  @@index([user_id], map: "idx_cm_user_id")
}

model user_item_interactions {
  id                   Int       @id @default(autoincrement())
  user_id              Int
  item_id              Int
  module               String?   @default("food") @db.VarChar(20)
  viewed_count         Int?      @default(0)
  clicked_count        Int?      @default(0)
  ordered_count        Int?      @default(0)
  saved_count          Int?      @default(0)
  first_viewed_at      DateTime? @default(now()) @db.Timestamp(6)
  last_viewed_at       DateTime? @db.Timestamp(6)
  last_ordered_at      DateTime? @db.Timestamp(6)
  typical_search_query String?
  created_at           DateTime? @default(now()) @db.Timestamp(6)
  updated_at           DateTime? @default(now()) @db.Timestamp(6)

  @@unique([user_id, item_id, module])
  @@index([item_id], map: "idx_uii_item_id")
  @@index([user_id, ordered_count(sort: Desc)], map: "idx_uii_ordered")
  @@index([user_id], map: "idx_uii_user_id")
}

// ===================================
// Missing models  added 2026-02-19
// ===================================

model Model {
  id          Int      @id @default(autoincrement())
  name        String   @unique @db.VarChar(255)
  modelType   String   @map("model_type") @db.VarChar(50)
  provider    String   @db.VarChar(50)
  status      String   @default("inactive") @db.VarChar(50)
  isLocal     Boolean  @default(false) @map("is_local")
  config      Json     @default("{}")
  description String?
  version     String?  @db.VarChar(50)
  createdAt   DateTime @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt   DateTime @updatedAt @map("updated_at") @db.Timestamp(6)

  @@index([modelType], map: "idx_model_type")
  @@index([status], map: "idx_model_status")
  @@map("models")
}

model SystemSettings {
  id          Int      @id @default(autoincrement())
  key         String   @unique @db.VarChar(255)
  value       String
  type        String   @default("string") @db.VarChar(50)
  description String?
  category    String?  @db.VarChar(100)
  isSecret    Boolean  @default(false) @map("is_secret")
  createdAt   DateTime @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt   DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamp(6)

  @@index([category], map: "idx_system_settings_category")
  @@map("system_settings")
}

model Secret {
  id             Int       @id @default(autoincrement())
  name           String    @unique @db.VarChar(255)
  encryptedValue String    @map("encrypted_value")
  description    String?
  category       String    @default("api_key") @db.VarChar(100)
  isActive       Boolean   @default(true) @map("is_active")
  lastRotated    DateTime? @map("last_rotated") @db.Timestamp(6)
  expiresAt      DateTime? @map("expires_at") @db.Timestamp(6)
  createdAt      DateTime  @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt      DateTime  @updatedAt @map("updated_at") @db.Timestamp(6)

  @@index([isActive], map: "idx_secret_active")
  @@index([category], map: "idx_secret_category")
  @@map("secrets")
}

model GameQuestion {
  id              Int      @id @default(autoincrement())
  gameType        String   @map("game_type") @db.VarChar(100)
  questionText    String   @map("question_text")
  correctAnswer   String   @map("correct_answer") @db.VarChar(255)
  answerOptions   String[] @default([]) @map("answer_options")
  difficulty      String   @default("medium") @db.VarChar(50)
  rewardAmount    Int      @default(10) @map("reward_amount")
  tags            String[] @default([])
  contextRequired Boolean  @default(false) @map("context_required")
  questionContext String?  @map("question_context") @db.VarChar(255)
  usageCount      Int      @default(0) @map("usage_count")
  enabled         Boolean  @default(true)
  createdAt       DateTime @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt       DateTime @updatedAt @map("updated_at") @db.Timestamp(6)

  @@index([gameType], map: "idx_game_question_type")
  @@index([enabled], map: "idx_game_question_enabled")
  @@index([difficulty], map: "idx_game_question_difficulty")
  @@map("game_questions")
}

model GameSession {
  id          Int       @id @default(autoincrement())
  sessionId   String    @unique @map("session_id") @db.VarChar(255)
  userId      Int       @map("user_id")
  gameType    String    @map("game_type") @db.VarChar(100)
  difficulty  String    @default("medium") @db.VarChar(50)
  language    String    @default("en") @db.VarChar(50)
  status      String    @default("active") @db.VarChar(50)
  score       Int       @default(0)
  missionData Json      @default("{}") @map("mission_data")
  startedAt   DateTime  @default(now()) @map("started_at") @db.Timestamp(6)
  completedAt DateTime? @map("completed_at") @db.Timestamp(6)
  createdAt   DateTime  @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt   DateTime  @updatedAt @map("updated_at") @db.Timestamp(6)

  @@index([userId], map: "idx_game_session_user")
  @@index([gameType], map: "idx_game_session_type")
  @@index([status], map: "idx_game_session_status")
  @@map("game_sessions_v2")
}

model GamificationSettings {
  id          Int      @id @default(autoincrement())
  key         String   @unique @db.VarChar(255)
  value       String
  type        String   @default("string") @db.VarChar(50)
  category    String?  @db.VarChar(100)
  description String?
  updatedBy   String?  @map("updated_by") @db.VarChar(255)
  createdAt   DateTime @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt   DateTime @updatedAt @map("updated_at") @db.Timestamp(6)

  @@index([category], map: "idx_gamification_settings_category")
  @@map("gamification_settings")
}

model ResponseTemplate {
  id        Int      @id @default(autoincrement())
  name      String   @db.VarChar(255)
  intent    String   @db.VarChar(100)
  language  String   @default("hi-en") @db.VarChar(50)
  template  String
  variables String[] @default([])
  priority  Int      @default(0)
  isActive  Boolean  @default(true) @map("is_active")
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamp(6)

  @@unique([intent, language, priority], map: "idx_response_template_unique")
  @@index([intent], map: "idx_response_template_intent")
  @@index([isActive], map: "idx_response_template_active")
  @@map("response_templates")
}

model PromptExperiment {
  id               Int       @id @default(autoincrement())
  name             String    @db.VarChar(255)
  description      String?
  targetPromptName String    @map("target_prompt_name") @db.VarChar(255)
  trafficPercent   Int       @default(10) @map("traffic_percent")
  sampleSizeTarget Int       @default(1000) @map("sample_size_target")
  confidenceLevel  Decimal   @default(0.95) @map("confidence_level") @db.Decimal(3, 2)
  status           String    @default("draft") @db.VarChar(50)
  tenantId         Int       @default(1) @map("tenant_id")
  createdBy        String?   @map("created_by") @db.VarChar(255)
  startDate        DateTime? @map("start_date") @db.Timestamp(6)
  endDate          DateTime? @map("end_date") @db.Timestamp(6)
  createdAt        DateTime  @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt        DateTime  @updatedAt @map("updated_at") @db.Timestamp(6)

  variants PromptVariant[]
  results  PromptExperimentResult[]

  @@index([targetPromptName], map: "idx_prompt_experiment_target")
  @@index([status], map: "idx_prompt_experiment_status")
  @@map("prompt_experiments")
}

model PromptVariant {
  id              Int      @id @default(autoincrement())
  experimentId    Int      @map("experiment_id")
  name            String   @db.VarChar(255)
  template        String
  temperature     Decimal  @default(0.7) @db.Decimal(3, 2)
  maxTokens       Int      @default(500) @map("max_tokens")
  modelPreference String?  @map("model_preference") @db.VarChar(255)
  weight          Int      @default(50)
  isControl       Boolean  @default(false) @map("is_control")
  totalSamples    Int      @default(0) @map("total_samples")
  avgResponseTime Int      @default(0) @map("avg_response_time")
  avgTokens       Int      @default(0) @map("avg_tokens")
  avgUserRating   Decimal? @map("avg_user_rating") @db.Decimal(3, 2)
  conversionRate  Decimal? @map("conversion_rate") @db.Decimal(5, 4)
  createdAt       DateTime @default(now()) @map("created_at") @db.Timestamp(6)

  experiment PromptExperiment @relation(fields: [experimentId], references: [id], onDelete: Cascade)

  @@index([experimentId], map: "idx_prompt_variant_experiment")
  @@map("prompt_variants")
}

model PromptExperimentResult {
  id             Int      @id @default(autoincrement())
  experimentId   Int      @map("experiment_id")
  variantId      Int      @map("variant_id")
  sessionId      String   @map("session_id") @db.VarChar(255)
  userMessage    String   @map("user_message")
  intentDetected String?  @map("intent_detected") @db.VarChar(255)
  responseText   String   @map("response_text")
  responseTimeMs Int      @map("response_time_ms")
  tokenCount     Int      @map("token_count")
  userRating     Int?     @map("user_rating")
  wasEscalated   Boolean  @default(false) @map("was_escalated")
  goalCompleted  Boolean? @map("goal_completed")
  createdAt      DateTime @default(now()) @map("created_at") @db.Timestamp(6)

  experiment PromptExperiment @relation(fields: [experimentId], references: [id], onDelete: Cascade)

  @@index([experimentId], map: "idx_prompt_result_experiment")
  @@index([variantId], map: "idx_prompt_result_variant")
  @@index([sessionId], map: "idx_prompt_result_session")
  @@map("prompt_experiment_results")
}

model Order {
  id                  Int       @id @default(autoincrement())
  crnNumber           String?   @unique @map("crn_number") @db.VarChar(255)
  orderId             String?   @map("order_id") @db.VarChar(255)
  userId              Int?      @map("user_id")
  storeId             Int?      @map("store_id")
  customerPhone       String?   @map("customer_phone") @db.VarChar(50)
  customerName        String?   @map("customer_name") @db.VarChar(255)
  storeName           String?   @map("store_name") @db.VarChar(255)
  deliveryAddress     Json?     @map("delivery_address")
  status              String    @default("pending") @db.VarChar(100)
  paymentMethod       String?   @map("payment_method") @db.VarChar(50)
  paymentId           String?   @map("payment_id") @db.VarChar(255)
  totalAmount         Decimal?  @map("total_amount") @db.Decimal(10, 2)
  orderAmount         Decimal?  @map("order_amount") @db.Decimal(10, 2)
  deliveryCharge      Decimal?  @map("delivery_charge") @db.Decimal(10, 2)
  riderId             Int?      @map("rider_id")
  riderName           String?   @map("rider_name") @db.VarChar(255)
  riderPhone          String?   @map("rider_phone") @db.VarChar(50)
  items               Json?     @default("[]")
  metadata            Json?     @default("{}")
  cancelledBy         String?   @map("cancelled_by") @db.VarChar(100)
  cancellationReason  String?   @map("cancellation_reason") @db.VarChar(255)
  createdAt           DateTime  @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt           DateTime  @default(now()) @updatedAt @map("updated_at") @db.Timestamp(6)

  @@index([status], map: "idx_order_status")
  @@index([customerPhone], map: "idx_order_customer_phone")
  @@index([userId], map: "idx_order_user_id")
  @@index([createdAt], map: "idx_order_created")
  @@map("orders")
}
